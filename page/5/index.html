<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.bigbrosci.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"right","width":240,"display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="Learn VASP The Hard Way">
<meta property="og:url" content="http://www.bigbrosci.com/page/5/index.html">
<meta property="og:site_name" content="Learn VASP The Hard Way">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="By BigBro(a)s">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.bigbrosci.com/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Learn VASP The Hard Way</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Learn VASP The Hard Way</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">The 2nd edition</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">By BigBro(a)s</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">162</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2018/02/05/ex36/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/05/ex36/" class="post-title-link" itemprop="url">Ex36 晶格参数的确定（直接优化晶格常数）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-05 02:06:48" itemprop="dateCreated datePublished" datetime="2018-02-05T02:06:48-05:00">2018-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2018/02/05/ex36/" class="post-meta-item leancloud_visitors" data-flag-title="Ex36 晶格参数的确定（直接优化晶格常数）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/02/05/ex36/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/05/ex36/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面一节我们学习了如何通过提交一系列不同晶格常数的单点计算以及拟合BM方程获取稳定结构的方法，此外，我们还学习了BM方程拟合的一个python脚本以及分析了脚本的工作流程。</p>
<p>师兄，算个晶格常数这也太麻烦了吧？有没有简单点的，一步到位的方法？</p>
<p>有！！！前面我们提到说可以通过两个方法： BM方程拟合是一个，现在大家已经掌握了。今天我们学习第二个方法。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ISIF = <span class="number">3</span></span><br><span class="line">ENCUT = XXX</span><br></pre></td></tr></table></figure>
<h2 id="1-ISIF-参数"><a href="#1-ISIF-参数" class="headerlink" title="1  ISIF 参数"></a>1  ISIF 参数</h2><p>在学习ISIF = 3 前，我们先总结一下，之前不论是单点计算，结构优化，还是频率分析，我们都没有讲过这个参数。因此使用的是默认值。</p>
<p><img src="/2018/02/05/ex36/ex36-1.png" alt=""></p>
<p>查找VASP官网说明书，默认值是ISIF= 2 。是的，前面我们都是用的 ISIF = 2 。（废话，等于白说！）你还会发现有一堆其他的ISIF参数，从1 - 7，看的眼花缭乱。</p>
<p><img src="/2018/02/05/ex36/ex36-2.png" alt=""></p>
<p>坚持一下，你会发现它们有各自的特点，原子坐标是否变化，晶胞形状是否改变，以及晶胞体系是够变化。不同的参数大家根据自己研究体系的性质进行选取。</p>
<p>本文主要介绍ISIF = 3 时对晶胞的优化。其他的取值比如加压计算等，为避免对大家造成误解，在这里不做进一步地说明。因为本人计算的时候，只用到过2 和 3 的情况。</p>
<p>ISIF = 3 的时候，晶胞中原子的坐标，晶胞形状，以及体系都随着优化的过程发生变化。 回到Fe单胞的计算，我们先看一下INCAR的输入，然后再详细解释其中的内容。</p>
<p><img src="/2018/02/05/ex36/ex36-3.png" alt=""></p>
<p>对比下，前面单点计算的INCAR，你会发现有几个不同：</p>
<p>1） ENCUT = 600 设置的比之前的450大。</p>
<p>2） EDIFFG = -0.015 结构优化的收敛标准</p>
<p>3） NSW = 100 结构优化，肯定不是一步！</p>
<p>4） ISIF = 3 （讲的就是ISF =3 ，肯定要加上）</p>
<p>5） 此外， ISMEAR，SIGMA, ISPIN以及 MAGMOM大家自己主动回顾一下</p>
<p>PS： 很多人在单点计算的时候，除了NSW = 0， 还画蛇添足地设置了ISIF = 0。虽然对计算结果没有影响，但我还是想问一句：大哥，脑子去哪里了？单点计算就是原子不动弹，设置NSW = 0 或者 1， 或者 IBRION = -1，其他的按照之前的即可。</p>
<p>POSCAR，KPOINTS，POTCAR直接将前面单点计算目录（1.00）下的复制过来。</p>
<h2 id="2-ENCUT-取值"><a href="#2-ENCUT-取值" class="headerlink" title="2 ENCUT 取值"></a>2 ENCUT 取值</h2><p>师兄，Fe的ENCUT 默认值是：ENMAX  =  267.882 eV， 前面单点计算设置的 450 eV。这里为什么设置成600 eV ？ </p>
<p>如果你仔细看VASP官网的说明书，在底部有这么一段话：</p>
<p><img src="/2018/02/05/ex36/ex36-4.png" alt=""></p>
<p>红色的链接如下：</p>
<p><a target="_blank" rel="noopener" href="http://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html">http://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html</a>   </p>
<p>最后一句，如果计算时体积发生了变化，我们需要增加ENCUT的值，比如说：ENCUT = 1.3 * max(ENMAX) ， max(ENMAX) 的意思是，如果有N个元素，取最大元素的ENMAX值。</p>
<p>这么做的原因是为了尽可能地消除 Pulay stress 对计算的影响。那么什么是Pulay Stress 呢？</p>
<h3 id="3-Pulay-Stress"><a href="#3-Pulay-Stress" class="headerlink" title="3 Pulay Stress"></a>3 Pulay Stress</h3><p><img src="/2018/02/05/ex36/ex36-5.png" alt=""></p>
<p>通过查看红色的链接内容，字面上的理解就是，当晶胞体积发生变化时，由于计算时的平面波基组不全（设置的ENCUT不够大）使得计算时的收敛不是绝对的，进而导致应力张量不对，最终导致体系的形状，体积以及能量不正确。（这个我不是很懂，字面上直译过来的。）维基百科的描述如下，链接：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pulay_Stress">https://en.wikipedia.org/wiki/Pulay_Stress</a></p>
<p><img src="/2018/02/05/ex36/ex36-6.png" alt=""></p>
<p>A plane wave basis set is created for thehexagonal lattice (left), using the reciprocal lattice vectors inside the redcircle. Then the lattice relaxes into a cubic symmetry (right). Keeping the redcircle basis constant results in lattice vectors taken from an ellipsoidinstead of a spherical area (compare to the blue circle).</p>
<p>深层次的俺也不懂，但是PulayStess 有2个办法可以减小： </p>
<p>A)  体积不变，采用一系列的晶格常数计算，然后拟合得到准确的晶格常数；（你已经知道怎么去做了，这么做是为了避免计算时晶格体积发生变化！）；</p>
<p>注意： </p>
<p>1） 在LVASPTHW的拟合流程中，拟合出来的是BM方程， BM方程的最高次数是3，也就是x的三次方。此时：x = (1/a$^2$)  ，具体见Ex32-35的详细说明。</p>
<p>2) 如果直接用晶格常数去拟合，则是6次方的关系。</p>
<p><img src="/2018/02/05/ex36/ex36-8.png" alt=""></p>
<p>3) 如果你用体积去拟合BM方程的话，最高次数是2：</p>
<p><img src="/2018/02/05/ex36/ex36-9.png" alt=""></p>
<p>B)  既然是因为ENCUT不够导致的，那么我就使劲增加ENCUT来消除（上图中unless后面的那句）。借用维基百科的一句话：Pulay stress can be reduced by increasing the energy cutoff. 所以，当有人用ISIF= 3计算，而不去设置ENCUT的时候，尽情地去嘲笑他傻X吧！！！感觉不过瘾，还可以继续吓唬他说后面的计算也有问题。</p>
<h2 id="4-ENCUT-取值"><a href="#4-ENCUT-取值" class="headerlink" title="4 ENCUT 取值"></a>4 ENCUT 取值</h2><p>官网说设置到130% * max(ENMAX)，一般来说就可以了。但很多人还是不放心，那我们就继续疯狂一些，设置到600 或者700。本人一般习惯用600。</p>
<p>师兄，前面你不是讲到增加ENCUT会增加计算量么？而且要保持计算中使用同一个计算的参数？</p>
<p>是的，这些你说的都是正确的。但是，我们使用ISIF = 3 的目的是获取稳定的晶格常数，但为了避免Pulay stress导致的误差，就必须要增加ENCUT（No Choice！！！）。一旦我们计算完成晶格常数的计算后，可以在此结果基础上，统一使用其他的ENCUT值进行计算。也就是只有确定晶格常数的这一步是个例外，其他情况还是用原来的值。</p>
<p><img src="/2018/02/05/ex36/ex36-10.jpeg" alt=""></p>
<p>举个不恰当的例子，这就好比当初你追女朋友的时候，为讨人家欢心，疯狂地买买买，什么要求都答应。等追到手了，结婚了，新鲜劲过去了，就原形毕露，不再这么大手大脚地去疯狂了。 </p>
<p><img src="/2018/02/05/ex36/ex36-11.jpeg" alt=""></p>
<p>讲到这里，使用ISIF = 3 时，你脑子第一反应就是疯狂地增加ENCUT，600不够，上700， 700感觉不够，上800，在计算承受的范围之内，越大越好！ 因此ISIF = 3 和 ENCUT两个参数必须同时出现。</p>
<h2 id="5-计算结果"><a href="#5-计算结果" class="headerlink" title="5  计算结果"></a>5  计算结果</h2><p>设置完后，提交任务：计算出来的Fe晶格参数为： 2.8318 Å，对比下前面拟合出来的结果： 2.8332 Å，两者相差：0.0014 / 2.8332 = 0.019 %， 这么点误差，完全可以忽略掉了。如果不放心，将ISIF =3 的结果，使用前面的设置，算个单点，然后跟BM拟合结果对比下，两者能量相差甚微，完全可以忽略。 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Methods</th>
<th>Lattice Constant</th>
<th style="text-align:left">Energy</th>
</tr>
</thead>
<tbody>
<tr>
<td>BM拟合</td>
<td>2.8332 $\AA$</td>
<td style="text-align:left">-16.47179683 eV</td>
</tr>
<tr>
<td>直接优化（ISIF=3，ENCUT=600）</td>
<td>2.8318 $\AA $</td>
<td style="text-align:left">-16.47181669 eV</td>
</tr>
</tbody>
</table>
</div>
<h2 id="6-总结："><a href="#6-总结：" class="headerlink" title="6 总结："></a>6 总结：</h2><p>学习完本节，怎么计算晶格常数的两个方法你应该都掌握了，希望大家能学到的东西有以下几个：</p>
<p>1 什么是BM方程？</p>
<p>2 BM方程拟合的方法（最小二乘法，脚本以及运行）；</p>
<p>3 BM方程获取晶格常数的原理；</p>
<p>4 ISIF = 3 和 ENCUT 必须同时设置；</p>
<p>5 Pulay Stress 是什么，如何避免； </p>
<p>6 （ISPIN，MAGMOM）：什么时候加，怎么设置；</p>
<p>7 （ISMEAR，SIMGA）：什么体系用什么值，怎么设置；</p>
<p>8 （IBRION，POTIM，NSW）：根据初始结构好坏进行设置；</p>
<p>9 （EDIFF，EDIFFG）：怎么决定收敛的；</p>
<p>10  KPOINTS的取值：经验方法（k * a）， 以及脚本；</p>
<p>11  POTCAR的生成： 手动方法以及脚本。</p>
<p>12  以及怎么追女朋友，如何防止被追？</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2018/02/04/ex35/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/04/ex35/" class="post-title-link" itemprop="url">Ex35 晶格参数的确定（Birch-Murnaghan状态方程-3）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-04 02:06:48" itemprop="dateCreated datePublished" datetime="2018-02-04T02:06:48-05:00">2018-02-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2018/02/04/ex35/" class="post-meta-item leancloud_visitors" data-flag-title="Ex35 晶格参数的确定（Birch-Murnaghan状态方程-3）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/02/04/ex35/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/04/ex35/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>通过上一节（Ex34）的脚本，我们可以拟合出稳定晶体结构的晶格参数，但是，这个脚本是怎么运行的呢？大家在浏览之后，有没有什么疑问？本节我们重点介绍一下：这个脚本的运行原理。</p>
<h2 id="1-数据"><a href="#1-数据" class="headerlink" title="1  数据"></a>1  数据</h2><p>首先我们看下读取的data文件：</p>
<p><img src="/2018/02/04/ex35/ex35-1.png" alt=""></p>
<p>A) 共两列，两列之间用<code>tab</code>分开；</p>
<p>B) 第一列为缩放系数，第二列为对应结构的能量。</p>
<p>C) 在本文例子中，晶格参数等于= <code>缩放系数</code> * <code>2.8664</code> $\AA$ （记住这个公式）</p>
<p>2  脚本内容： 浏览一遍即可，详解在下面： </p>
<p><img src="/2018/02/04/ex35/ex35-2.png" alt=""></p>
<p>详解：</p>
<p><strong>2.1  1-15行：准备部分</strong></p>
<p><img src="/2018/02/04/ex35/ex35-3.png" alt=""></p>
<p>A) 1-4 行为脚本的一些基本说明，为养成一个良好的写脚本习惯，以及避免后期不必要的麻烦，第一行必须要放进去。如果你用bash写的话，把python替换为bash即可，其他部分不用动，例如： #!/usr/bin/env bash。</p>
<p>B）2-3行注释，解释了一下脚本干什么用的，谁写的，怎么用。</p>
<p>C)  6-7 行调用python库中的math 和 numpy 模块，见下面两个链接：</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/2/library/math.html">https://docs.python.org/2/library/math.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.numpy.org/">http://www.numpy.org/</a></p>
<p>D）9-15行：通过使用 print 命令输出一个警告，因为本文用的是缩放系数，很多人测试的时候保持缩放系数不变，直接采用不同的晶格参数。</p>
<p><strong>2.2  读取data信息，准备拟合</strong></p>
<p><img src="/2018/02/04/ex35/ex35-4.png" alt=""></p>
<p>A)  16-18行为脚本的注释说明，</p>
<p>B)  第20行中，我们使用 <code>np.loadtxt</code>读取data文件的内容，</p>
<p>注意：</p>
<p>1)  <code>data</code> 用单引号括起来，表明我们要读以<code>data</code>命名的文件。 </p>
<p>2)   <code>usecols=(0,1)</code> 代表我们要读取第一列和第二列的内容。Python中的第一个用0表示，所以这里我们用的（0,1）来表示读取第1和第2列的内容；</p>
<p>3)   <code>delimiter=&#39;\t&#39;</code>，意思是第一列和第二列之间用tab（’\t’）分开；</p>
<p>4)  <code>unpack=True</code> 意思是把读取的数据生成一个数列，并分配给a 和 E，具体见链接：</p>
<p><a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html</a></p>
<p>通过第20行，我们可以获得两个数列，第一个是 a 包含了data文件中的缩放系数， 第二个是E，包含了data文件中的能量信息</p>
<p>C) 第22-28行，把缩放系数转换为晶格常数(a<em>2.8664)，然后平方取倒数（*</em>(-2)），用来得到我们前面讲解的x。这是因为：当我们把BM方程写成： $y(x) = c_0 + c_1x + c_2x^2+c_3x^3 $ 的形式时，前提是令 (1/a)$^2$ = x。不懂的具体见Ex33中的内容。截止到现在，我们有了三个数列： a, E 和 x</p>
<p><strong>2.3 第29-40行：拟合多项式方程</strong>： </p>
<p><img src="/2018/02/04/ex35/ex35-5.png" alt=""></p>
<p>A) 最小二乘法拟合 $y(x) = c_0 + c_1x + c_2x^2+c_3x^3 $这个方程，得到常数系列c，这里我们调用了<code>numpy</code> 的<code>polyfit</code>这个模块来进行拟合。具体见：</p>
<p><a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html</a></p>
<p>B) 第31行：本脚本的核心：<code>p = np.polyfit(x, E, 3)</code></p>
<p>1) np.polyfit 读取x和 E的数值，拟合一个$y(x) = c_0 + c_1x + c_2x^2+c_3x^3 $，</p>
<p>注意：这里拟合的时候，用的数值是x和E，(1/a)$^2$ = x， 所以，在进行拟合之前，务必确保你已经得到了正确的x数列。具体根据data文件的内容进行修改设置第24行的公式。</p>
<p>2) 括号中的3代表的是多项式方程中最大的那个次数。</p>
<p>扩展：如果你想拟合一个$ y = c_4x^4 +c_3x^4  …$的方程，把3改成4 即可。</p>
<p>3)拟合的结果输出到数列 p 中，数列p中共有4个常数（p[0],  p[1]，p[2]，p[3]），按照次数从高到底的顺序排列，对应着我们Ex33中的（c3，c2, c1, 和 c0 ）</p>
<p>4) 33-36行, 我们将p 中的数值分别分配给c3，c2, c1, 和 c0。</p>
<p><strong>2.4   38-40行，获取晶格参数</strong>：</p>
<p>到目前位置，多项式方程的常数我们已经获得了，下面就是求解问题了。</p>
<p><img src="/2018/02/04/ex35/ex35-6.png" alt=""></p>
<p>A)  第42行为下图中公式的代码描述，获取方程的解x，因为前面我们已经有了一个x变量了，这里方程的解用x1表示，</p>
<script type="math/tex; mode=display">
x x = \frac{-2c_2 + \sqrt{(2c_2)^2 - 4\times3C_3\times C_1}}{2\times3C_3}</script><p>B) 第43行获取晶格常数，公式为： (1/a)$^2$= x</p>
<p>C) 第45行，输出晶格常数的数值。</p>
<h2 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h2><p>3.1 根据解释，重新浏览脚本，知道每一行代表的含义。</p>
<p>3.2 本脚本使用的时候，需要自己根据data数列中的内容，设置更改一下获取 x 数列的公式（第24行）；</p>
<p>3.3 阅读Ex32-本节的所有内容，整个流程不要再存在什么疑问。</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><p>本节我们详细讲解了BM方程拟合脚本，相信大家应该了解的差不多了，拟合的办法有很多，但BM方程只有一个。请务必掌握至少一个拟合的方法。后面的这句话本来想删掉，因为本人已经早就毕业了。暂且留下来吧，权当本书的一个时间证据。</p>
<hr>
<p>此外，本人马上就要毕业答辩了，后面更新会有所放缓，努力争取保证每周一篇的速度。如果你有什么科研心得，欢迎分享。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2018/02/03/ex34/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/03/ex34/" class="post-title-link" itemprop="url">Ex34 晶格参数的确定（Birch-Murnaghan状态方程-2）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-03 02:06:48" itemprop="dateCreated datePublished" datetime="2018-02-03T02:06:48-05:00">2018-02-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2018/02/03/ex34/" class="post-meta-item leancloud_visitors" data-flag-title="Ex34 晶格参数的确定（Birch-Murnaghan状态方程-2）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/02/03/ex34/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/03/ex34/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面一节，我们通过批量操作，获得了拟合BM方程的数据。这一节，我们通过这些数据，使用脚本进行拟合并获取Fe单胞的晶格参数。 本节的脚本和读取的数据文件，可在QQ群文件和百度网盘中下载，见底部。 </p>
<h2 id="1-脚本使用方法："><a href="#1-脚本使用方法：" class="headerlink" title="1 脚本使用方法："></a>1 脚本使用方法：</h2><p>在介绍脚本之前，先介绍一下脚本的使用方法：</p>
<p>首先：将前面一节得到的 data 文件和脚本放在一个目录下</p>
<p>其次：进入该目录，运行脚本的命令为（见下图）： </p>
<p>python   bm0.py </p>
<p>注意： bm0.py 为脚本名，你也可以随意写成 birch,  birch.py等。</p>
<p><img src="/2018/02/03/ex34/ex34-1.jpeg" alt=""></p>
<p>通过脚本，我们可以得到Fe单胞的晶格参数为： 2.8332 Å</p>
<h2 id="2-脚本的内容-1："><a href="#2-脚本的内容-1：" class="headerlink" title="2 脚本的内容-1："></a>2 脚本的内容-1：</h2><p>我们看一下bm0.py 这个脚本的内容：只有几行而已。大家先自己根据前面介绍的通过BM方程获得晶格参数的原理，阅读以下该脚本，看不懂不要紧，多看几遍。大体上了解是怎么回事。</p>
<p><img src="/2018/02/03/ex34/ex34-2.jpeg" alt=""></p>
<h2 id="3-脚本的内容-2："><a href="#3-脚本的内容-2：" class="headerlink" title="3 脚本的内容-2："></a>3 脚本的内容-2：</h2><p>前面的脚本没有任何的说明，阅读起来很是费力，大师兄把注释加上去了，并命名为: bm.py。大家再阅读一遍，看看有没有新的收获。</p>
<p><img src="/2018/02/03/ex34/ex34-3.jpeg" alt=""></p>
<p>图中的链接为：(左下角查看原文)</p>
<p><a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html</a></p>
<p>该脚本运行效果如下图：</p>
<p><img src="/2018/02/03/ex34/ex34-4.jpeg" alt=""></p>
<p>脚本的工作原理下一节介绍，本节中大家只看脚本，分析里面的内容，自己结合前面一节琢磨是怎么回事。脚本和读取的data文件可以在QQ群中下载，也可以通过百度网盘，链接： <a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o8cCdBG">http://pan.baidu.com/s/1o8cCdBG</a> </p>
<h2 id="4-扩展练习"><a href="#4-扩展练习" class="headerlink" title="4 扩展练习"></a>4 扩展练习</h2><p>4.1 查找文献，获取Fe的晶格常数的实验数据，与脚本获取的结果进行对比；</p>
<p>4.2 Windows用户使用notepad++或者其他文本编辑软件，自己将bm0.py脚本重新写一遍，然后运行，如果出错了，请与图中对比并修改，直至完美匹配为止！！！</p>
<p>4.3 Linux用户，使用vim或者其他文本编辑软件，进行4.2中的操作；</p>
<p>4.4 结合Ex33的介绍，初步了解本脚本的运行原理。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2018/02/02/ex33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/02/ex33/" class="post-title-link" itemprop="url">Ex33 晶格参数的确定（Birch-Murnaghan状态方程-1）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-02 02:06:48" itemprop="dateCreated datePublished" datetime="2018-02-02T02:06:48-05:00">2018-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2018/02/02/ex33/" class="post-meta-item leancloud_visitors" data-flag-title="Ex33 晶格参数的确定（Birch-Murnaghan状态方程-1）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/02/02/ex33/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/02/ex33/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>O$_2$分子的计算中，我们知道了，单纯从数据库中获取的结构，只能作为一个合理的初始值，与计算所得到的理论结构还有一定的差距，因此我们需要对该结构进行优化才可以获取稳定的晶格参数信息。有两个方法可以实现：</p>
<ul>
<li>1 Birch-Murnaghan状态方程拟合, </li>
<li>2 VASP计算中通过调节ISIF参数直接优化Bulk。</li>
</ul>
<p>下面两节我们先讨论一下第一个方法：BM方程拟合。</p>
<h2 id="1-什么是Birch-Murnaghan方程？"><a href="#1-什么是Birch-Murnaghan方程？" class="headerlink" title="1 什么是Birch-Murnaghan方程？"></a>1 什么是Birch-Murnaghan方程？</h2><p>BM方程为块体材料的体积随着外压变化的状态方程。大师兄参考了维基百科的说明，大家下载维基百科导出的PDF文件参考。在学习下面的内容前，请务必阅读这个文件，了解什么是Birch-Murnaghan方程。下载：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1bUSYbs">http://pan.baidu.com/s/1bUSYbs</a> </p>
<p><img src="/2018/02/02/ex33/ex33-1.jpeg" alt=""></p>
<p><img src="/2018/02/02/ex33/ex33-2.jpeg" alt=""></p>
<h2 id="2-如何通过BM方程获取晶格参数？"><a href="#2-如何通过BM方程获取晶格参数？" class="headerlink" title="2 如何通过BM方程获取晶格参数？"></a>2 如何通过BM方程获取晶格参数？</h2><p>首先，我们将BM方程中的体积转化为晶格参数（a）的函数：</p>
<p><img src="/2018/02/02/ex33/ex33-3.jpeg" alt=""></p>
<p>其中E(a)和E$_0$是晶格参数为a和a$_0$时bulk的能量，B$_0$，B$_0$’和V$_0$这些见BM方程的维基百科介绍。令$(1/a)^2 = x$，上图中的BM方程可以写成：</p>
<p> $y(x) = c_0 + c_1x + c_2x^2+c_3x^3 $ 的形式，</p>
<p>E$_0$, B$_0$,B$_0$’和V$_0$等写进c$_0$,c$_1$,c$_2$,和c$_3$这些常数里面，它们的具体形式此时并不重要，我们需要做的就是拟合这样的曲线去寻找使y(x)为最小值时的x取值。对y(x)这个方程求导数，dy(x)/dx = 0 的时候，便可以获取能量最低时的x值了，再由$(1/a)^2 = x$ 获得晶格参数。</p>
<p> dy(x)/dx = c$_1$+ 2c$_2$x + 3c$_3$x$^2$</p>
<p>令：dy(x)/dx = 0，即 c$_1$+ 2c$_2$x + 3c$_3$x$^2$ = 0</p>
<p>这是一个典型的二项式方程，求解很容易。</p>
<script type="math/tex; mode=display">
x = \frac{-2c_2\pm\sqrt{(2c_2)^2 - 4\times3C_3\times C_1}}{2\times3C_3}</script><p>x有两个值，其中负值被舍弃掉，最终：</p>
<script type="math/tex; mode=display">
x = \frac{-2c_2 + \sqrt{(2c_2)^2 - 4\times3C_3\times C_1}}{2\times3C_3}</script><h2 id="3-获取拟合的数据："><a href="#3-获取拟合的数据：" class="headerlink" title="3 获取拟合的数据："></a>3 获取拟合的数据：</h2><p>经过前面的分析，我们需要的就是获得的c$_1$，c$_2$ 和c$_3$值。可以设置一系列不同的晶格常数进行计算，得到对应的能量，然后将这些数据带入下面的方程中：$y(x) = c_0 + c_1x + c_2x^2+c_3x^3 $进行拟合。本节我们主要讨论一下如何进行该计算。看到这里，你第一反应是我们之前测试K点或者SIGMA值时的那些Linux批量操作。是的，我们也需要进行一个批量操作的计算。</p>
<p>3.1 分数坐标</p>
<p>如果我们改变了晶格常数，那么Fe原子的坐标也要发生相应的变化。此时，用分数坐标更加方便，VESTA中在cif转VASP格式的时候，会提醒你选择哪个形式的坐标，我们选择分数坐标：</p>
<p><img src="/2018/02/02/ex33/ex33-6.jpeg" alt=""></p>
<p>POSCAR如下图：</p>
<p><img src="/2018/02/02/ex33/ex33-7.jpeg" alt=""></p>
<p>注意：</p>
<p> 如果前面练习中，导出的为笛卡尔坐标形式的，你有两个选择：</p>
<p>A）重新按照前面的步骤，用VESTA导出为分数坐标形式；</p>
<p>B）将单点计算的结果直接复制过来（<code>cp  CONTCAR  POSCAR</code>），因为VASP的输出坐标为分数坐标形式，单点计算中，晶胞原子都没有动，CONTCAR可以直接使用。复制过来的POSCAR如下：</p>
<p><img src="/2018/02/02/ex33/ex33-8.jpeg" alt=""></p>
<p>3.2 获得分数坐标的POSCAR后，我们可以批量对晶格常数a,b,c进行批量操作，也可以对缩放系数进行批量操作，而原子的坐标不用去管。</p>
<p>3.3 本练习对缩放系数进行批量操作</p>
<p>我们取10个点，将1.0 替换成0.95, 0.96, 0.97, 0.98, 0.99, 1.01, 1.02, 1.03, 1.04, 1.05。此时，晶格常数为：<code>缩放系数</code>*<code>2.8664</code>.（记住，下一节用得到）</p>
<p>a) 准备缩放系数为1.0 的计算文件夹，命名为1.00，里面包含我们前面一节已经讲过的Bulk单点计算相关文件；</p>
<p>b) </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 0.95 0.96 0.97 0.98 0.99 1.01 1.02 1.03 1.04 1.05; <span class="keyword">do</span> cp 1.00 <span class="variable">$i</span> ; sed -i <span class="string">&quot;2s/1.0/<span class="variable">$i</span>/g&quot;</span> <span class="variable">$i</span>/POSCAR ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>注意：这里大师兄在自己电脑的<code>~/.bashrc</code>文件里面设置了：<code>alias cp=&#39;cp -r&#39;</code></p>
<p>思考： sed 命令后面用的是双引号（为什么？）如果这里看不懂的话，建议从Ex00开始学习。</p>
<p>d.) 批量提交命令： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span> <span class="built_in">cd</span> <span class="variable">$i</span>; qsub sub4; <span class="built_in">cd</span> <span class="variable">$OLDPWD</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>其中，qsub sub4 是大师兄提交单个任务的命令。</p>
<p>3.4 数据提取：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span> <span class="built_in">echo</span> -e <span class="variable">$i</span> <span class="string">&quot;\t&quot;</span> $(grep <span class="string">&#x27;  without&#x27;</span> <span class="variable">$i</span>/OUTCAR | tail -n 1| awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>);  <span class="keyword">done</span> &gt; data</span><br></pre></td></tr></table></figure>
<p><img src="/2018/02/02/ex33/ex33-9.jpeg" alt=""></p>
<p>3.5 以上计算文件以及相关的命令已经上传到QQ群文件和百度网盘了，大家对比下计算结果。 <a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1dEJr9rb">http://pan.baidu.com/s/1dEJr9rb</a> </p>
<h2 id="4-扩展练习"><a href="#4-扩展练习" class="headerlink" title="4 扩展练习"></a>4 扩展练习</h2><p>4.1 完成本练习中的相关操作，并学习VASP官网批量操作的例子：</p>
<p><a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/Fcc_Si">https://cms.mpi.univie.ac.at/wiki/index.php/Fcc_Si</a></p>
<p>注意：FCC Si的例子用的原胞，并且该网址最后图中曲线不是二次方程！！！虽然用二次方程拟合出来的结果差不多。</p>
<p>4.2 探索学习曲线拟合的方法；</p>
<p>4.3 学习并了解BM方程以及如何拟合，如何通过BM方程获取稳定的晶格参数；</p>
<p>4.4 对晶格参数进行批量操作，并计算。</p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><p>本节从BM方程开始，简单介绍了什么是BM方程，如何通过BM方程获取稳定晶胞对应的晶格参数，最后，又复习了一下本书前面几节的批量操作，下一节我们讲解一下如何通过python脚本对BM方程拟合。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2018/02/01/ex32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/02/01/ex32/" class="post-title-link" itemprop="url">Ex32 Bulk的单点计算（Fe 单胞）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-01 02:06:48" itemprop="dateCreated datePublished" datetime="2018-02-01T02:06:48-05:00">2018-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2018/02/01/ex32/" class="post-meta-item leancloud_visitors" data-flag-title="Ex32 Bulk的单点计算（Fe 单胞）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/02/01/ex32/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/01/ex32/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我们学习完了气相分子的相关计算后，下一步就是块体计算了，这也是VASP的强项所在，但块体的计算与气体分子的非常类似，如果前面掌握好了，后面的计算对你来说也就是轻而易举的事情了。</p>
<p>本着从简入繁的原则，我们先学习Bulk的单点计算（以Fe的单胞为例），姑且称之为本书中级篇的开始。大家需要学习并初步了解Material Studio和VESTA这两款软件。</p>
<ul>
<li><p>Material Studio下载链接：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1i5or3ZR">http://pan.baidu.com/s/1i5or3ZR</a>   对于这款软件怎么安装，大师兄就不指导了，网上全是相关的资料。本节默认大家已经安装好MS软件，并且可以打开界面。</p>
</li>
<li><p>VESTA下载官网：<a target="_blank" rel="noopener" href="http://jp-minerals.org/vesta/en/download.html">http://jp-minerals.org/vesta/en/download.html</a> 只在官网下载，网上乱七八糟的版本不要去管！VESTA 下载后解压，直接打开就可以用了。注意：很多人问VESTA的使用说明，官网有，网上也有很多相关资料！大家耐着性子多练一天就能摸索个差不多了。</p>
</li>
</ul>
<h2 id="1-模型"><a href="#1-模型" class="headerlink" title="1 模型"></a>1 模型</h2><p> 1.1 课题的第一个难点</p>
<p>模型的选择，计算的准确性，以及结果分析的合理性，是一个课题是否成功的三个最主要的因素。Bulk的计算很简单，难点在于Bulk模型的获取。这也是一个课题最难的部分之一。很多人在计算的时候，模型不对，基本上这个课题就被一棍子打死了。这里大师兄提醒大家的是：模型，模型，模型！！！在进入计算的时候，一定要确保模型的合理性与正确性。这是计算中的第一个坎！</p>
<p>1.2 MS搭建Fe单胞的模型</p>
<p>A) 左上角<code>file</code>—&gt; <code>newproject</code>，输入Fe，点OK;</p>
<p>B) <code>file</code>—&gt; <code>import</code>—&gt; <code>Structures</code>—&gt;<code>metals</code>—&gt;<code>pure-metals</code>—&gt;找到Fe，选择打开即可;</p>
<p>C) <code>file</code>—&gt;<code>export</code>—&gt;选择cif格式 （此时导出的是Fe的单胞，conventional cell）</p>
<p>1.3 MS导出Fe原胞的模型：</p>
<p>A)和B)步骤与前面一样，</p>
<p>C) <code>Build</code> —&gt; <code>Symmetry</code>—&gt; <code>选择primitive cell</code></p>
<p>D) <code>file</code>—&gt;<code>export</code>—&gt;选择cif格式 （此时导出的是Fe的原胞，primitive cell）</p>
<p>1.4 VESTA 转换成VASP的格式</p>
<p>a) 打开VESTA软件，<code>file</code>—&gt;<code>open</code>—&gt;选择之前保存的cif文件</p>
<p>b) <code>file</code>—&gt; <code>export data</code> —&gt;保存类型选择VASP</p>
<p>c) 将保存的文件重新命名成<code>POSCAR</code>即可</p>
<p>1.5 需要掌握的知识：</p>
<p>a) 晶体学相关的基本知识，什么是primitive cell，什么是conventional cell?</p>
<p>b) MS和VESTA的基本操作</p>
<p>1.6 需要注意的部分（其他转换方法）：</p>
<p>a）可以使用<code>openbabel</code>转换：<a target="_blank" rel="noopener" href="http://openbabel.org/wiki/Main_Page">http://openbabel.org/wiki/Main_Page</a></p>
<p>b）可以使用MS生成的.cell文件转化，可以根据POSCAR的格式手动复制，也可以通过脚本。</p>
<p>c）或者通过其他脚本进行转化,例如：<a target="_blank" rel="noopener" href="http://theory.cm.utexas.edu/vasp/scripts.html">VTST</a>中的cif2pos.pl。<a target="_blank" rel="noopener" href="http://theory.cm.utexas.edu/vasp/scripts.html">http://theory.cm.utexas.edu/vasp/scripts.html</a></p>
<p>d) 使用<a target="_blank" rel="noopener" href="https://wiki.fysik.dtu.dk/ase/">ASE</a>: Atomic Simulation Environment的缩写。</p>
<h2 id="2-VASP计算文件的准备"><a href="#2-VASP计算文件的准备" class="headerlink" title="2 VASP计算文件的准备"></a>2 VASP计算文件的准备</h2><p> <strong>2.1 准备好INCAR文件：</strong></p>
<p>A）Fe带有磁性，ISPIN和MAGMOM需要设置</p>
<p>B）Fe是金属， ISMEAR=1， SIGMA=0.1</p>
<p>C）ENCUT=450， 统一起来，后面可能还需要计算其他元素，450是一个很安全的选择。</p>
<p>D）EDIFF控制电子步收敛的精度</p>
<p><img src="/2018/02/01/ex32/ex32-1.jpeg" alt=""></p>
<p><strong>2.2 准备KPOINTS文件：</strong></p>
<p>以单胞为例： a=b=c=2.8664 $\AA$，根据前面的经验，我们可以设置$11\times11\times11$的KPOINTS（Gamma）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">K-POINTS</span><br><span class="line"> 0</span><br><span class="line">Gamma</span><br><span class="line">  11 11 11</span><br><span class="line">  0 0 0</span><br></pre></td></tr></table></figure>
<p> <img src="/2018/02/01/ex32/ex32-2.jpeg" alt=""></p>
<p>2.3 准备好与POSCAR对应的POTCAR文件，提交任务的脚本</p>
<h2 id="3-提交任务"><a href="#3-提交任务" class="headerlink" title="3 提交任务"></a>3 提交任务</h2><p>3.1 提交任务之前，再次检查一遍我们的所有输入文件，确保无误；</p>
<p>3.2 提交任务进行计算；</p>
<p>3.3 大师兄的计算已经压缩放到百度网盘了，大家计算完毕后，与大师兄的进行对比。</p>
<p>链接：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1eRQHaX8">http://pan.baidu.com/s/1eRQHaX8</a></p>
<h2 id="4-扩展练习"><a href="#4-扩展练习" class="headerlink" title="4 扩展练习"></a>4 扩展练习</h2><p>4.1 分析Fe体相的磁矩，并查找实验值；</p>
<p>4.2 复习之前O$_2$分子的相关计算，分析实验结果；</p>
<p>4.3 怎么在OUTCAR中查看磁矩等相关信息； （VASP 哪一个参数？）</p>
<p>4.4 复习晶体学的相关知识；</p>
<p>4.5 学会MS，VESTA的基本练习；</p>
<p>4.6 掌握2种以上通过MS获取POSCAR的方法。</p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><p>本节的计算我们需要掌握一定的晶体学基础知识，基本的MS和VESTA操作，计算过程和O$_2$分子的例子极为相似，大家在学习的时候，可以将这两部分相互结合。本节我们采用的Fe单胞的例子，计算本身不难。难点在于自己课题中模型的选取。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/22/A06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/22/A06/" class="post-title-link" itemprop="url">VASP计算遇到错误怎么办？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-22 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-22T02:06:48-05:00">2017-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW%E9%99%84%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW附录</span></a>
        </span>
    </span>

  
    <span id="/2017/12/22/A06/" class="post-meta-item leancloud_visitors" data-flag-title="VASP计算遇到错误怎么办？" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/22/A06/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/22/A06/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>搞科研，总会遇到各种各样的问题需要解决，同样VASP计算也不例外，本文大师兄列举了一些解决问题的步骤和方法，只提供大体的方向，没有具体事例，大家结合自己的计算研究亲自去实践体会，写本文的目的是告诉大家：自己亲自解决问题才是你快速成长的加速器。 </p>
<p><img src="/2017/12/22/A06/A06-1.jpg" alt=""></p>
<h3 id="第1阶段："><a href="#第1阶段：" class="headerlink" title="第1阶段："></a>第1阶段：</h3><p> 靠自己（最重要的！） </p>
<p>1.1 凭自己的经验解决；</p>
<p>1.2 按照VASP的输出错误，进行修改解决；</p>
<p>1.3 查找VASP官网的相关参数；</p>
<p>1.4 平时多阅读VASP手册；</p>
<p>1.5 不懂的参数不要往INCAR里面放。</p>
<p><img src="/2017/12/22/A06/A06-2.jpg" alt=""></p>
<h3 id="第2阶段："><a href="#第2阶段：" class="headerlink" title="第2阶段："></a>第2阶段：</h3><p><strong>主动搜索（也是靠自己）</strong> </p>
<p>2.1 将错误信息复制到百度里面搜索，一般会得到一堆论坛或者博客的相关指导说明，按照里面的内容修改自己的输入文件，然后解决问题。</p>
<p><img src="/2017/12/22/A06/A06-3.jpg" alt=""></p>
<p>2.2  将错误信息复制到Google里面搜索，一般会得到VASP官网的论坛一节其他国外网址的相关错误示例，这时候，就要耐着性子把其中的内容读完，然后修改输入文件进行解决；一般来说，进行到这一步，至少60% 左右的问题可以解决!!! </p>
<h3 id="第3阶段："><a href="#第3阶段：" class="headerlink" title="第3阶段："></a>第3阶段：</h3><p><strong>靠师兄师姐，师弟师妹，老板</strong></p>
<p>如果时间过去2天，还没有解决。可以将自己的错误信息以及尝试的方法总结。</p>
<p>分享给组里的师兄弟，师姐妹们，寻求求助办法。如果还未解决，就要报告给自己的老师，求助指导！！！此时，解决的成功率应该能达到70-100% </p>
<p><strong>大师兄的建议</strong>：自己主动去解决是关键，这需要培养主动解决问题的能力。老板是辅助的策略，除了指导课题的方向，在学生遇到问题时能出马解决，这也是他或者她为什么是老板的原因之一。</p>
<h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h3 id="第4阶段（I）"><a href="#第4阶段（I）" class="headerlink" title="第4阶段（I）"></a>第4阶段（I）</h3><p><strong>论坛求助</strong></p>
<p>如果老板不给力（很多做实验的老板要求学生去做计算，大师兄本人极度鄙视这样的老板，完全就是对学生的不负责任！），可以去尝试论坛求助：这里大师兄推荐：</p>
<p><img src="/2017/12/22/A06/A06-5.jpg" alt=""></p>
<p>将问题复制到百度里面，你就会发现这个问题会在很多论坛里面出现。不过论坛求助有一点需要注意：发帖的人水平参差不齐，要抱着怀疑的态度去接受所有人的答复（<strong>记住，是所有人！！！</strong>），别人的回复只能当作参考。</p>
<p><strong>第4阶段（II）QQ群求助：</strong></p>
<p>这里大师兄列举了三个管理员认真负责的QQ群：</p>
<p>​                                                                               <strong>遇见大师兄</strong></p>
<p><img src="/2017/12/22/A06/A06-7.jpg" alt=""></p>
<p>​                                                                             <strong>第一性原理之家</strong></p>
<p><img src="/2017/12/22/A06/A06-8.jpg" alt=""></p>
<p>​                                                                                         <strong>物理化学材料互助群</strong></p>
<p><img src="/2017/12/22/A06/A06-9.jpg" alt=""></p>
<p>进行到这一步，基本上95%的问题可以解决了。 </p>
<p><strong>第5阶段：VASP官方论坛发帖</strong></p>
<p>以上都解决不了的话（极少的情况了），可以去VASP官网发帖求助，等待VASP的其他用户或者管理员解决。不过需要注册！</p>
<p><img src="/2017/12/22/A06/A06-10.jpg" alt=""></p>
<h3 id="第-6-阶段"><a href="#第-6-阶段" class="headerlink" title="第 6 阶段"></a>第 6 阶段</h3><p><strong>QQ群求助：</strong></p>
<p><strong>6.1 尊重别人的时间</strong></p>
<p>A）QQ群求助的时候，提供的信息要全面：</p>
<p>1）  算的什么体系</p>
<p>2） 算的什么内容</p>
<p>3）INCAR长什么样子</p>
<p>4）错误信息</p>
<p>5）KPOINTS以及POSCAR 很多人把图片一截，或者拿手机拍张照片就直接在群里求助了，这是对大家时间的极度不尊重。而且被应助的概率很低！！！你不尊重大家的时间，大家也不会浪费时间在你身上。 </p>
<p>B）可以将计算结果压缩，上传到QQ群文件进行求助（但不要把CHG，CHGCAR和WAVECAR等压缩到里面，因为它们太大，大家都懒得去下载！如果你上传了一个100M的求助文件，基本没人帮你！）</p>
<p>C）不要多群求助 有很多人加了很多群，把遇到的问题在所有的群里面都发了一遍！这样的行为简直就是在浪费大家的宝贵时间，本人见到这种情况，一般都不会去帮助。</p>
<p><strong>6.2</strong> <strong>把你得小心眼收起来！！！</strong> </p>
<p>A) 除了涉密的一些计算，其他情况没有必要给大家隐瞒什么，大家也不会坏到去抢你的课题去算！心胸狭隘的人也不配得到帮助！</p>
<p>B) 要虚心接受别人的批评，也就是心眼要大。大师兄也遇到很多奇葩，在群里求助，没人回答，就直接退群了。被别人批评了几句，也退群了。只能说这些没心胸的人也不值得去帮助。</p>
<p><strong>6.3</strong> <strong>互相帮助</strong></p>
<p>别人遇到的问题，如果你知道怎么解决，不要有所隐瞒。请认真帮助解决，用俺奶奶经常挂在嘴边的那句话：将心比心。这样大家的计算水平才可以得以普遍地提高。 请认真按照这个流程来解决问题，不要一出现问题，脑子不假思索就去论坛或者QQ群求助!!! 请记住，你的问题也代表了你的老板的水平。一般来说，不负责任的老板带出来的学生总会有各种各样的低级问题。 以上仅代表本人观点，不喜勿喷！祝大家踏踏实实做计算，多发实实在在的文章！</p>
<p>最后，新手的话，请认真学习Learn Vasp The Hard Way 这本书(www.bigbrosci.com) 按照大师兄写的内容，从头认真学习VASP（本书只作为参考，关键是去浏览官网！！！）；如果在学习中遇到问题，也可以把问题准备好，发送邮件给大师兄解决：lqcata@gmaill.com 最好不要直接QQ找我（拜托！）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/21/A04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/21/A04/" class="post-title-link" itemprop="url">自动生成KPOINTS的脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-21 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-21T02:06:48-05:00">2017-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW%E9%99%84%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW附录</span></a>
        </span>
    </span>

  
    <span id="/2017/12/21/A04/" class="post-meta-item leancloud_visitors" data-flag-title="自动生成KPOINTS的脚本" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/21/A04/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/21/A04/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面学习了cd的一些用法，本节我们简单介绍下如何写自动生成KPOINTS文件的脚本。提到脚本，对于做计算的我们并不陌生，提交命令，分析数据，处理结果都会用到，脚本的存在使得一些繁重的工作极大地得到简化，节约了我们的时间和精力。但脚本怎么写出来的？怎么写脚本？很多人就望而却步了。</p>
<p><strong>1</strong> <strong>什么是脚本？</strong> </p>
<p>对于脚本的解释，大家可以浏览一下网上的解释，这里大师兄主要说一下自己的理解：</p>
<p>1）  脚本是一个文本文件；我们可以用文本编辑器打开，查看，和修改。知道了这一点，当你从某处获得一个脚本时，就可以阅读里面的内容了，进而知道该脚本是怎么运行的，有哪些地方值得注意，为了实现另一个结果我们需要修改什么参数等；</p>
<p>2）  脚本中的内容为程序语言；脚本中我们需要把我们期望的工作分解并转化为程序语言；所以你的选择有很多，bash， perl， python， java….， C++ 等等；</p>
<p>4）  脚本可以执行；通过执行脚本，实现我们的目的，这里主要是给大家强调一下，在今后的学习中，仔细观察脚本的执行流程！</p>
<p><strong>2 生成KPOINTS的脚本</strong></p>
<p>这里说的KPOINTS文件指的是自动生成网格的KPOINTS文件，能带计算由于比较特殊，最好手动输入。编辑器用的是vim，还可以使用 notepad++或者其他文本编辑器进行练习。</p>
<p>2.1  <code>kpoints.sh</code>版本1 </p>
<p>A）终端里面输入： <code>vi kpoints.sh</code></p>
<p>B）在vi 界面里面输入下面几行内容：</p>
<p><img src="/2017/12/21/A04/A04-1.jpg" alt=""></p>
<p>输入完毕后保存 。</p>
<p>C）脚本讲解：图中的除了第4行，所有命令都可以复制到 Terminal里面自己运行，然后查看结果。</p>
<p>C.1）前面我们学习了如何手动制作KPOINTS文件， 并知道KPOINTS文件每一行所代表的内容。因此该脚本就是帮助我们自动生成每一行的内容。忘记的同学请复习Ex01的内容。 </p>
<p>C.2）第一行： <code>echo  K-POINTS  &gt;  KPOINTS</code> （注意空格）</p>
<p><code>echo</code> 在bash语言中，代表输出打印的意思，<code>&gt;</code> 代表把前面的内容保存到后面的<code>KPOINTS</code>文件中； 如果目录下不存在<code>KPOINTS</code>文件，那么会自动创建；</p>
<p>如果存在，<code>KPOINTS</code>文件之前的内容会被 当前命令中 <code>&gt;</code> 前面的内容替换。也就是<code>KPOINTS</code>文件以前的内容被清理掉，并换成了最新的内容。</p>
<p>因此，运行这一行命令，我们会创建一个<code>KPOINTS</code>文件，里面只有一行文字： <code>K-POINTS</code></p>
<p>我们知道第一行的内容为说明，对计算不会产生影响，你也可以把 K-POINTS换成男朋友或者女朋友的名字….</p>
<p>C.3）第二行：</p>
<p>继续使用<code>echo</code>命令，将数字 <code>0</code> 保存到<code>KPOINTS</code>文件中。</p>
<p>这里 <code>&gt;&gt;</code> 两个箭头代表：将 <code>&gt;&gt;</code> 前面的内容保存到<code>KPOINTS</code>文件的最后一行。因此， 使用 <code>&gt;&gt;</code> 不会将<code>KPOINTS</code>之前的内容替换掉。如果目录下没有<code>KPOINTS</code>文件，使用<code>&gt;&gt;</code>也会和<code>&gt;</code>一样，创建一个。</p>
<p>这里的 <code>0</code> 代表自动生成网格：automatic generation scheme </p>
<p>C.4) 第三行：将 Gamma-centered 输出到<code>KPOINTS</code>的第三行里面，你需要知道G代表的是什么意思。如果你想用Monkhorst-Pack Grids，echo后面怎么写你要知道。建议一直用Gamma-centered。</p>
<p>C.5) 第4行：将<code>$1 $2 $3</code>输出到<code>KPOINTS</code>的第四行里面。</p>
<p>在这里，<code>$1 $2 $3</code>称为：arguments</p>
<p>代表的是我们运行脚本命令的时候，加入的三个方向上KPOINTS的数目。通过<code>$1 $2 $3</code>传递给 echo 命令。</p>
<p>如果不理解的话，跳过，等运行命令的时候就明白了。</p>
<p>C.6）第5行：Kpoints网格在三个方向的移动。一般来说0 0 0 即可。</p>
<p><strong>2.2 脚本运行：</strong> </p>
<p>A)     调用bash运行脚本：</p>
<p><img src="/2017/12/21/A04/A04-2.jpg" alt=""></p>
<p>图中我们运行脚本的时候命令为：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash kpoints.sh 3 3 1</span><br></pre></td></tr></table></figure><br>bash 意思是我们调用bash来执行该脚本；</p>
<p>kpoints.sh 为脚本的名称, 当然啦，名字可以任意换， .sh也可以不用加；</p>
<p>3 3 1 为脚本后面的参数，第一个3 对应脚本里面的<code>$1</code>, 第二个3 为<code>$2</code>,  1 为脚本里面的<code>$3</code></p>
<p>B）赋予脚本可执行权限： </p>
<p><img src="/2017/12/21/A04/A04-3.jpg" alt=""></p>
<p>赋予权限：<code>chmod  u+x  kpoint.sh</code></p>
<p>取消权限：<code>chmod u-x kpoint.sh</code></p>
<p>你会发现之前白色的脚本变成绿色的了，这说明本脚本可以执行了。不同电脑可能显示的颜色不容，有些甚至都不显示，大家不要纠结。但图中直接输入<code>kpoints.sh  3 3 1</code> 的时候失败了，我们必须用<code>./ kpoints.sh 3 3 1</code> 来执行。原因是系统不知道我们把脚本放在这里了。</p>
<p>怎么样才可以直接使用这个命令呢？ 将脚本转移到<code>~/bin</code> 文件夹中即可，如果你的系统中没有<code>~/bin</code> 这个文件夹，<code>mkdir ~/bin</code> 创建一下就完事。</p>
<p><img src="/2017/12/21/A04/A04-4.jpg" alt=""></p>
<p>OK，现在大功告成。我们可以根据之前的经验规则设置<code>KPOINTS</code>文件了。 </p>
<p><strong>2.3 脚本升级： 版本2</strong> </p>
<p>前面的脚本实现了我们所期望的功能，这里我们所说的升级，无非就是在前面的基础上再增添点东西，使得脚本看起来更加高大上，具有可读性或者更加智能化。这里我们主要介绍一下使用# 注释自己的脚本，使其可以被广大吃瓜群众所理解和接受。 </p>
<p><img src="/2017/12/21/A04/A04-5.jpg" alt=""></p>
<p>a）加入第一行，<code>#!</code>称为shebang （就是拼音，没错！）表示执行该脚本时会调用后面的程序；自行百度shebang的用途；</p>
<p>b）   3-5行中用 <code>#</code> 注释下，简单介绍本脚本的功能， 作者，使用方法；</p>
<p>c）   7-11 行用 <code>#</code> 注释下每一行命令中的作用。</p>
<p>d）由于每个人写脚本的方式和风格不同，脚本的注释对于方便大家理解非常有用。有时候即使自己写的脚本，一年半载之后也会忘记里面的内容，加上注释，会让我们快速掌握脚本里面的内容，在后期的维护或者升级中也发挥着重大的作用。</p>
<p><strong>2.4 其他升级：</strong></p>
<p>除了注释外，可以将脚本写的更加智能化，通过调控 <code>$1 $2 $3</code> 等脚本后面的参数, 加入一些<code>if</code>语句等，来实现<code>KPOINTS</code>文件中所有行均可以通过命令进行修改。比如：<code>kpoints.sh G 3 3 1</code> 和 <code>kpoints.sh M 3 3 1</code> 分别生成Gamma centered 和正常的MP 网格。</p>
<p>Linux下面还可以使用其他的方式来生成脚本，总之选择的方法很多。</p>
<p><strong>3  扩展练习：</strong> </p>
<p>3.1）重复本节所有操作，写人生中的第一个脚本；</p>
<p>3.2）网上搜索bash资料，认真练习。</p>
<p>3.3）<code>bash</code>在linux下处理日常工作非常有用，但数据分析的时候能力就有所欠缺了，建议大家学习<code>python</code>。Python有2.X和3.X的版本，2.X开始逐渐被抛弃，建议大家直接学习3.X的。</p>
<p><strong>4</strong> <strong>总结：</strong></p>
<p>看完本节，你会初步了解脚本是怎么写出来的，它是怎么执行的以及对战胜了对写脚本的恐慌心理。当你获得一个脚本的时候，尝试着打开它，将其中的语言分解成若干命令执行，查看该脚本的工作流程。勤学苦练，就可以流利地写属于自己的脚本了。在这方面多花一分钟，以后节省的就不是一分钟的事情了，当然也有可能会多花几分钟。但多学习点东西总归是好的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/21/A05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/21/A05/" class="post-title-link" itemprop="url">自动生成POTCAR的脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-21 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-21T02:06:48-05:00">2017-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW%E9%99%84%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW附录</span></a>
        </span>
    </span>

  
    <span id="/2017/12/21/A05/" class="post-meta-item leancloud_visitors" data-flag-title="自动生成POTCAR的脚本" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/21/A05/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/21/A05/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面我们介绍了KPOINTS的小脚本的写法，本节我们主要讲解一下生成POTCAR的脚本。学习完本节，脚本的神秘色彩基本烟消云散，大家都可以尝试写自己的脚本了。再强调说明三点：</p>
<p>1）Windows用户不要用记事本写脚本;</p>
<p>2）Windows用户写完脚本后，在服务器上先运行：<code>dos2unix XXX</code>  (<code>XXX</code> 是你的脚本名)</p>
<p>3）Windows用户，如果计算出错，第一个要排除的是自己提交任务前有没有运行：<code>dos2unix</code>.</p>
<p><strong>1</strong> <strong>手动示例：</strong></p>
<p>比如我们POSCAR中包含有Cu C H O 四种种元素，那么我们就需要按照顺序生成一个对应的POTCAR。首先回顾一下前面介绍的POTCAR的制备方法：</p>
<p>1.1）获取这四个元素各自的POTCAR：并命名成<code>POTCAR_Cu</code>,<code>POTCAR_C</code>,<code>POTCAR_H</code>,<code>POTCAR_O</code></p>
<p>1.2）使用cat 命令将这四个POTCAR合并在一起：<code>cat POTCAR_Cu  POTCAR_C POTCAR_H POTCAR_O &gt; POTCAR</code></p>
<p>前面我们学过了 <code>&gt;</code> 的使用。分步练习：第一步将这些元素的POTCAR全部打印出来：</p>
<p><code>cat  POTCAR_Cu  POTCAR_C POTCAR_H POTCAR_O</code></p>
<p>第二步：将打印出来的内容通过 <code>&gt;</code>  保存到最终的POTCAR里面。</p>
<p><strong>脚本目的：</strong></p>
<p>自动从赝势库中提取所需元素的POTCAR并将它们合并在一起。我们赝势库的目录为：<code>/THFS/home/iciq-lq/bin/pot</code> 这个pot文件夹（我自己随便命名的）就包含了VASP的所有元素的POTCAR，最好放在一个不经常变动的地方，这里我们放到了<code>~/bin</code>目录里面。</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/bin/pot$ ls</span><br><span class="line">Ac At_sv_GW  Bi_sv_GW  C_GW  C_s ....</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/bin/pot$ ls B*</span><br><span class="line">B:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Ba_sv:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Ba_sv_GW:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Be:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Be_GW:</span><br><span class="line">POTCAR  PSCTR</span><br></pre></td></tr></table></figure>
<p>所以我们可以使用下面的命令生成POTCAR：(不将这几个POTCAR先保存到当前目录下，直接调用赝势库中的POTCAR)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ cat /THFS/home/iciq-lq/bin/pot/Cu/POTCAR  /THFS/home/iciq-lq/bin/pot/C/POTCAR /THFS/home/iciq-lq/bin/pot/H/POTCAR  /THFS/home/iciq-lq/bin/pot/O/POTCAR  &gt; POTCAR</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ grep TIT POTCAR</span><br><span class="line">   TITEL  = PAW_PBE Cu 22Jun2005</span><br><span class="line">   TITEL  = PAW_PBE C 08Apr2002</span><br><span class="line">   TITEL  = PAW_PBE H 15Jun2001</span><br><span class="line">   TITEL  = PAW_PBE O 08Apr2002</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但这样子也很麻烦。</p>
<p><strong>2</strong> <strong>脚本预览：</strong></p>
<p>首先看下自动生成POTCAR的脚本，大家尽量先不看下面的解释，自己理解一下脚本的整个框架和运行的流程;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># Create a GGA_PAW POTCAR file</span></span><br><span class="line"><span class="comment"># by BigBro  </span></span><br><span class="line"><span class="comment"># To Use it： potcar.sh Cu C H O</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define local potpaw_GGA pseudopotentialrepository:</span></span><br><span class="line">repo=<span class="string">&quot;/THFS/home/iciq-lq/bin/pot&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if older version of POTCAR ispresent</span></span><br><span class="line"><span class="keyword">if</span> [ -f POTCAR ] ; <span class="keyword">then</span></span><br><span class="line"> mv -f POTCAR old-POTCAR</span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot; ** Warning: old POTCAR file found and renamed to &#x27;old-POTCAR&#x27;.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main loop - concatenate the appropriatePOTCARs (or archives)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"> <span class="keyword">if</span> <span class="built_in">test</span> -f <span class="variable">$repo</span>/<span class="variable">$i</span>/POTCAR ; <span class="keyword">then</span></span><br><span class="line">  cat <span class="variable">$repo</span>/<span class="variable">$i</span>/POTCAR&gt;&gt; POTCAR</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot; ** Warning: No suitable POTCAR for element &#x27;<span class="variable">$i</span>&#x27; found!! Skipped thiselement.&quot;</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>讲解，这个脚本里面：</p>
<p>1）首先我们先设定赝势库的目录;<code>repo=&quot;/THFS/home/iciq-lq/bin/pot&quot;</code> <strong>等号前后不能有空格</strong>！！！</p>
<p>2）然后我们检查一下当前目录下是否存在POTCAR，如果存在的话，将其重命名为：<code>POTCAR-old</code>, 并输出警告信息。这里我们学到的是 <code>if</code> 句型：<code>if [ ] ; then; fi</code> 。<code>[]</code> 中间是if判断的条件，如果成立，则继续执行<code>then</code>后面的动作。</p>
<p><strong>if [ -f POTCAR ]; then</strong>  意思是如果存在POTCAR这个文件，那么… <strong>注意：</strong></p>
<p>a）<code>[ ]</code> 和里面的内容 <strong>–f POTCAR</strong> 要通过空格分开。所以：</p>
<ul>
<li><p><code>if [-f POTCAR ]</code>（<code>[</code> 和<code>-f</code>之间没有空格）</p>
</li>
<li><p><code>if [ -f POTCAR]</code> (<code>POTCAR</code> 和<code>]</code> 之间没有空格)</p>
</li>
<li><p><code>if [-f POTCAR]</code>（<code>-f</code>，<code>POTCAR</code>和 <code>[]</code> 之间都没有空格）</p>
</li>
</ul>
<p>这三种写法都是错误的;<strong>if [  -f POTCAR  ]</strong> 是正确的</p>
<p>b）<code>then</code> 后面如果另起一行的话，分号 （<strong>;</strong>） 可加可不加<code>;</code></p>
<p>c）<code>then</code> 后面的内容如果和then 在同一行，必须加上分号（<strong>;</strong>） ，前后有无空格均可，建议加上，这样语言会很清晰;</p>
<p>d）<code>then</code> 后面的命令执行完毕后，要加上 <code>fi</code> 结束。同理，如果<code>fi</code> 另起一行，则前面可以不加<code>;</code>如果<code>fi</code> 和 <code>then</code> 后面执行的命令在一行，前面需要加上分号（<strong>;</strong>）。</p>
<p>3）生成新的POTCAR文件; 这里我们用到的是一个<code>for</code>循环：</p>
<p>a)  <code>for i in $*</code></p>
<p>这一行的意思是，对于命令后面的所有参数（arguments），前面一节我们已经学过了<code>$1 $2 ...</code> 的含义，这里用的<code>$*</code> 可以让我们在命令后面加任意数目的参数<code>;</code>因为另起了一行，后面加不加分号（<code>;</code>）不重要。</p>
<p>b） <code>do</code>  执行的意思</p>
<p>c）<code>do</code>后面有个<code>if</code> 语句，如果目录下面是POTCAR的话，那么使用<code>cat</code> 命令将所有<code>$*</code>对应的POTCAR输出到最新的POTCAR中，注意，这里我们用到的是<code>&gt;&gt;</code>; 因为<code>for</code>循环是对于后面的参数挨个执行的。</p>
<p>d) 有两个<code>elif</code>，判断目录下的另外两个POTCAR文件的格式，如果是POTCAR.Z 文件的话，则使用<code>zcat</code> 将其输出到最新的POTCAR<code>;</code>如果是POTCAR.gz 文件的话，则使用gunzip –c 命令。</p>
<p>e）<code>else</code> 指的是除了前面三种以外的情况，如果POTCAR，POTCAR.Z或者POTCAR.gz都不存在，那么使用<code>echo</code>命令，输出警告，提醒用户检查。</p>
<p>f）使用<code>fi</code> 结束<code>if</code> 语句</p>
<p>g）使用 <code>done</code> 结束 <code>for</code> 循环。</p>
<p><strong>3</strong> <strong>运行脚本：</strong> </p>
<p>3.1）赋予脚本可执行权限，然后将其转移到主目录下的bin文件夹中，前面几节已经讲过了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x potcar.sh</span><br><span class="line">mv potcar.sh ~/bin</span><br></pre></td></tr></table></figure>
<p>3.2 运行实例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ ls</span><br><span class="line">bin  LVASPTHW  old-POTCAR  POTCAR  potcar.sh  test_jobs</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ potcar.sh Cu C H O</span><br><span class="line"> ** Warning: old POTCAR file found and renamed to <span class="string">&#x27;old-POTCAR&#x27;</span>.</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ ls</span><br><span class="line">bin  LVASPTHW  old-POTCAR  POTCAR  potcar.sh  test_jobs</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ grep TIT POTCAR</span><br><span class="line">   TITEL  = PAW_PBE Cu 22Jun2005</span><br><span class="line">   TITEL  = PAW_PBE C 08Apr2002</span><br><span class="line">   TITEL  = PAW_PBE H 15Jun2001</span><br><span class="line">   TITEL  = PAW_PBE O 08Apr2002</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ potcar.sh BigBro</span><br><span class="line"> ** Warning: old POTCAR file found and renamed to <span class="string">&#x27;old-POTCAR&#x27;</span>.</span><br><span class="line"> ** Warning: No suitable POTCAR <span class="keyword">for</span> element <span class="string">&#x27;BigBro&#x27;</span> found!! Skipped thiselement.</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当前目录下存在POTCAR，脚本会给出警告，将其重命名为old-POTCAR，然后生成新的POTCAR文件，包含Cu C H O 这四种元素。如果有一个元素不存在（上面实例总的BigBro），potcar库里找不到，则输出错误提示。</p>
<p><strong>注意！注意！注意！</strong></p>
<p>上面例子中的错误，还可能是因为：</p>
<ul>
<li><p>1） 你的POSCAR的格式有问题（Windows用户常见的问题），如果发现这个错误，先运行下：<code>dos2unix POSCAR</code> 这个命令排除是Windows的格式问题。</p>
</li>
<li><p>2） 如果还不能解决，去你的POTCAR库里面找找，是不是真的没有这个元素的POTCAR文件。</p>
</li>
</ul>
<p><strong>4</strong> <strong>脚本分析：</strong> </p>
<p>4.1）生成一些特殊的POTCAR文件：</p>
<p>我们知道，每一个元素存在好几个不同的POTCAR，如图：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/bin/pot$ ls Cu*</span><br><span class="line">Cu:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Cu_GW:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Cu_pv:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line"></span><br><span class="line">Cu_sv_GW:</span><br><span class="line">POTCAR  PSCTR</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/bin/pot$ ls H</span><br><span class="line">H/        H1<span class="number">.33</span>/    H1<span class="number">.66</span>/    H<span class="number">.25</span>/     H<span class="number">.42</span>/     H<span class="number">.58</span>/     H<span class="number">.75</span>/     He/       He_GW/    Hf_pv/    Hf_sv_GW/ Hg_sv_GW/ H_h/      Ho/       H_s/</span><br><span class="line">H1<span class="number">.25</span>/    H1<span class="number">.5</span>/     H1<span class="number">.75</span>/    H<span class="number">.33</span>/     H<span class="number">.5</span>/      H<span class="number">.66</span>/     H_AE/     He_AE/    Hf/       Hf_sv/    Hg/       H_GW/     H_h_GW/   Ho_3/</span><br></pre></td></tr></table></figure>
<p>当我们需要使用 Cu_pv, C，H1.25，和O对应的POTCAR时，我们需要这样执行命令： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ ls</span><br><span class="line">bin  LVASPTHW  test_jobs</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ potcar.sh Cu_pv C H1.25 O</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ ls</span><br><span class="line">bin  LVASPTHW  POTCAR  test_jobs</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$ grep TIT POTCAR</span><br><span class="line">   TITEL  = PAW_PBE Cu_pv 06Sep2000</span><br><span class="line">   TITEL  = PAW_PBE C 08Apr2002</span><br><span class="line">   TITEL  = PAW_PBE H1.25 07Sep2000</span><br><span class="line">   TITEL  = PAW_PBE O 08Apr2002</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq$</span><br></pre></td></tr></table></figure>
<p>因此，如果我们使用脚本的时候直接输入元素符号，默认读取的是与该元素符号相对应文件下的POTCAR。 </p>
<p><strong>5 读取POSCAR，自动生成POTCAR （防止出错的一个秘诀）</strong> </p>
<p>在我们的计算中，可以通过读取POSCAR中的元素信息，生成对应的POTCAR文件，这样可以避免POSCAR中元素和POTCAR中不一致的情况。那么我们需要怎么做呢？</p>
<p>5.1 首先我们要获取POSCAR中的元素信息： 查看一下POSCAR文件,发现元素信息在第6行，因此加了一个tail命令提取出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ ls</span><br><span class="line">POSCAR</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ head -n 6 POSCAR</span><br><span class="line">Ru   H</span><br><span class="line">   1.00000000000000</span><br><span class="line">   8.1377999784000004   0.0000000000000000   0.0000000000000000</span><br><span class="line">   4.0688999892000002   7.0475415119999996   0.0000000000000000</span><br><span class="line">   0.0000000000000000   0.0000000000000000  21.5631999968999999</span><br><span class="line">Ru   H</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ head -n 6 POSCAR  | tail -n 1</span><br><span class="line">Ru   H</span><br></pre></td></tr></table></figure>
<p>5.2 使用我们刚刚写出来的脚本，通过使用<code>$()</code>调用前面命令的结果: （将获取的元素信息作为脚本命令的参数） </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$  potcar.sh  $(head -n 6  POSCAR | tail -n 1)</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ grep TIT POTCAR</span><br><span class="line">   TITEL  = PAW_PBE Ru 04Feb2005</span><br><span class="line">   TITEL  = PAW_PBE H 15Jun2001</span><br></pre></td></tr></table></figure>
<p><strong>大功告成！！！！</strong> </p>
<p>5.3 不想每次输入这么长的命令：可以将其写进 ~/.bashrc文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias pos2pot=&quot;potcar.sh  $(head -n 6 POSCAR  | tail -n 1)&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ ls</span><br><span class="line">POSCAR  POTCAR</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ vi ~/.bashrc</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ . ~/.bashrc</span><br><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ pos2pot</span><br><span class="line"> ** Warning: old POTCAR file found and renamed to &#x27;old-POTCAR&#x27;.</span><br></pre></td></tr></table></figure>
<p>5.4 看完上面的部分，相信大家已经可以掌握很多内容了，额外福利，大师兄本人并没有使用<code>head -n 6 POSCAR  | tail -n 1</code> 来获取POSCAR中的元素信息。而是使用的sed命令： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iciq-lq@ln3:/THFS/home/iciq-lq/LVASPTHW/potcar$ sed -n 6p POSCAR</span><br><span class="line">Ru   H</span><br></pre></td></tr></table></figure>
<p><strong>6</strong> <strong>扩展练习：</strong> </p>
<p>6.1）手动将这个脚本打一遍，理解里面的内容，如果出错了，对比我的脚本，进行改正，直至可以正确运行为止;</p>
<p>6.2）去官网查看POTCAR相关的内容，了解每一个元素不同的POTCAR之间的区别，例如：Cu 和 Cu_pv</p>
<p>6.3) 复习<code>alias</code>，学习本文第5节的方法，思考一下，如何通过操控脚本，避免计算中的一些失误，有了自己的想法后，通过脚本付诸实践。</p>
<p><strong>7</strong> <strong>总结：</strong></p>
<p>写到这里，相信大家对于Linux系统下的一些基本操作已经熟练掌握了，脚本的怎么写，怎么去运行，心里也有了一个大致的了解，至少不会感觉写脚本是多么牛逼的工作了。这些内容都是我们保证计算准确，高效的很重要的一个因素。希望大家可以熟练掌握，最关键的是，要硬着头皮去练习，脚本看起来简单，等你写的时候就会出现各种各样的错误，只有不断练习，才能写出漂亮的脚本，提高自己的工作效率。 脚本已经上传至QQ群文件，也可百度网盘下载：链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1eqeVVOo5nzGJsfPgClNJDg">https://pan.baidu.com/s/1eqeVVOo5nzGJsfPgClNJDg</a>  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/20/A03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/20/A03/" class="post-title-link" itemprop="url">Linux命令之cd使用心得</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-20 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-20T02:06:48-05:00">2017-12-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW%E9%99%84%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW附录</span></a>
        </span>
    </span>

  
    <span id="/2017/12/20/A03/" class="post-meta-item leancloud_visitors" data-flag-title="Linux命令之cd使用心得" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/20/A03/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/20/A03/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="科研狗必备技能"><a href="#科研狗必备技能" class="headerlink" title="科研狗必备技能"></a>科研狗必备技能</h1><p>前面27节，我们已经通过气相分子的例子，带领大家顺利度过了菜鸟这一关。如果你掌握了其中的思想，勤加操练，看官网，认真阅读看大师兄推荐的参考书，相信你的能力足以甩出那些整天只知道搜集VASP学习资料，搜集DFT阅读书籍，而不去行动的人好几条街了。科研忌讳的就是眼高手低，你学到的知识和你下载的书成反比。</p>
<p>在菜鸟篇结束之后，大师兄需要把自己日常工作的一些小技巧展示给大家。一是作为大家摆脱菜鸟身份的奖励，二来为大家的进阶篇做好准备。今天我们主要讲解一下cd命令。 </p>
<p>在Linux系统下，cd是必不可少的一个命令: cd 可以实现进入文件夹，返回上一级文件夹等操作等，日常操作中一些简单的做法可以极大的简化我们的工作方式，减轻手指的负担，有效避免键盘手的形成。大师兄结合自己多年来理论计算化学的操作实践，简单列举了一些组合使用 cd 命令的方法，希望大家可以熟练使用。 </p>
<p><strong>注意：</strong> 本节没有大师兄的截图操作，大家需要认真练习，思考这些命令是怎么运行的。希望大家阅读完本文后，按照内容练习一番，至少要达到高级篇的水平。此外，本节内容和前面的密切相关，如果前面没有掌握的话，在具体的应用部分中阅读起来会有些吃力。此时，建议从头学习。</p>
<p><strong>1  菜鸟篇：</strong> 正常使用 cd 命令 </p>
<p>进入文件夹： <code>cd  xxx/xxx/xxx</code></p>
<p>返回上一级： <code>cd ..</code></p>
<p>返回上二级：<code>cd ../..</code></p>
<p><strong>2  初出茅庐：</strong> 懂得如何快速返回原来的文件夹目录</p>
<p>1)：<code>cd  -</code></p>
<p>2)：<code>cd  $OLDPWD</code></p>
<p>两者效果是一样的，区别是前者会在屏幕显示上一级的目录。</p>
<p>具体使用参见本书前面几节关于VASP批量操作的相关内容，<strong>尤其是在批量提交任务中的应用</strong>。这个命令一定一定一定要掌掌掌掌…握！！！</p>
<p><strong>3 进阶篇：</strong> 知道如何结合 cd 与 alias</p>
<p>试想一下，如果你的文件系统下，一层套一层，好东西藏的很深（大师兄内心荡漾着邪恶清脆的笑声），问题是，当你进入这个文件夹，后退时需要不停地敲击：<code>cd ../../../../../../../..</code>   </p>
<p>为避免这样的麻烦，可以这么做:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias ..=&#x27;cd ../../&#x27;</span><br><span class="line">alias ...=&#x27;cd ../../../&#x27;</span><br><span class="line">alias ....=&#x27;cd ../../../..&#x27;</span><br></pre></td></tr></table></figure><br>每个点代表向上返1级目录，后面自己补上，大师兄手指头不想继续写了。</p>
<p><strong>注意：</strong></p>
<p>1）：不要设置  <code>alias **.**=&#39;cd ../&#39;</code>  因为 <code>**.**</code> 在linux里面等于 <code>source</code> 命令。</p>
<p>2）：等号左右没有空格。</p>
<p>3）：等号右侧命令需要用单引号或者双引号括起来， 最好是用单引号。</p>
<p>不会的请自己查找前面关于<code>alias</code>的介绍章节。 </p>
<p><strong>4 高级篇：</strong> <code>cd</code> 与 <code>alias</code>、<code>&amp;</code> 、<code>ls</code>的结合</p>
<p>大师兄linux走火入魔，养成了一个进入文件夹就敲击 <code>ls</code> 命令的习惯，但是也舍不得折磨我那双精细的老手，于是，就组合了<code>cd</code>、<code>alias</code>、<code>&amp;</code>、和<code>ls</code> 命令，如下<code>alias ....=&#39;cd ../../../.. &amp;&amp; ls&#39;</code></p>
<p>这样你敲击4个点 <code>....</code>  返回上面4级目录的时候， 自动显示当前目录下的所有东西，避免再一次敲击<code>ls</code> 命令了。</p>
<p>在这里我们用到的是 <code>&amp;&amp;</code> 这个命令，它表示如果前面的命令成功了就进行 <code>&amp;&amp;</code> 的命令。</p>
<p>无聊的师弟师妹们可以这样玩一下：<code>cd ../../../.. &amp;&amp; cd -</code></p>
<p>但是如果 <code>&amp;&amp;</code> 前面的命令失败了，直接退出，后面的便不会运行，这种情况下你就需要用到  <strong>双排管</strong> 这个命令了。</p>
<p>什么是双排管？　答：　<strong>||</strong>　（中间没有空格，大师兄给起的名字）</p>
<p>师兄，这玩意怎么使用？ 看下面的例子就明白了：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ../abc &amp;&amp; ls</span><br></pre></td></tr></table></figure><br>上一级目录没有abc文件夹，<code>&amp;&amp;</code> 前面命令的失败了，<code>ls</code> 不会运行。</p>
<p><code>cd ../abc || ls</code>  上一级目录没有abc文件夹， <code>||</code>  前面命令的失败了，<code>ls</code>依然会运行。</p>
<p>此外，还有单管 <code>|</code>  （pipe）这个 命令，后面一般跟着前面一步结束的进一步操作。比如：</p>
<p>1）  <code>head –n 10 POSCAR | tail –n 1</code></p>
<p>2）  <code>grep &#39;  without&#39;  OUTCAR | tail  -n 1</code></p>
<p>3）  <code>grep &#39;  without&#39;  OUTCAR | awk &#39;&#123;print $4&#125;&#39;</code></p>
<p>4）  前面获取零点能的就是一个很好的例子</p>
<p>5）  ……（大家自由发挥） </p>
<p><strong>5  cd 私人定制篇</strong></p>
<p>如果你的一个课题的计算都在一个文件夹里面，可以这么设置，下次敲击命令时直接进入这个文件夹<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias xxx=&#x27;cd ~/bigbro/a/b/c/d/e/f/g/h/i/k&#x27; </span><br></pre></td></tr></table></figure><br>藏得这么深（师弟们懂的！），肯定是好东西，不拿出来分享愧对大师兄谆谆教诲！学会了这个命令，就避免了用鼠标乱点进入目录了。还可以避免文件找不到…. </p>
<p><strong>6 cd 整蛊篇</strong></p>
<p>如果你闲的蛋疼，还可以尝试着在办公室其他人的Linux终端下这样设置alias。二选一即可。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias cd=&#x27;cd ~&#x27;</span><br><span class="line">alias cd=&#x27;echo &quot;you are a dumbass&quot; &#x27;</span><br></pre></td></tr></table></figure></p>
<p>大家好好练习这些关于cd的基本命令，等手指头熟悉了cd的味道，大师兄下一节就会继续传授给大家其他的高级操作，进一步减轻手指头的负担。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/18/ex27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/18/ex27/" class="post-title-link" itemprop="url">Ex27 乙醇分子的振动频率计算(五)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-18 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-18T02:06:48-05:00">2017-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/18/ex27/" class="post-meta-item leancloud_visitors" data-flag-title="Ex27 乙醇分子的振动频率计算(五)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/18/ex27/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/18/ex27/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>通过前面读者的反馈，本节前面主要讲述一下零点能相关的注意事项以及频率计算的时间成本相关的知识。</p>
<h2 id="1-参考书籍："><a href="#1-参考书籍：" class="headerlink" title="1 参考书籍："></a>1 参考书籍：</h2><p>以下所提到的书籍都可以在<strong>QQ群文件</strong>和<strong>百度网盘</strong>里面下载：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1bKHMjG">http://pan.baidu.com/s/1bKHMjG</a></p>
<h3 id="1-1-Density-Functional-Theory：A-Practical-Introduction"><a href="#1-1-Density-Functional-Theory：A-Practical-Introduction" class="headerlink" title="1.1 Density Functional Theory：A Practical Introduction"></a>1.1 Density Functional Theory：A Practical Introduction</h3><p>大师兄极力推荐的菜鸟入门书！！！</p>
<p>1）不要网上随便下载（很多都是野鸡版，公式符号不全）</p>
<p>2）不要看中文版的；去看原汁原味的，困了就歇会，慢慢坚持看；</p>
<p>3）大师兄QQ群下载或者点击百度网盘链接；</p>
<p>4）第5章专门讨论的频率相关的问题！！！</p>
<p><img src="/2017/12/18/ex27/ex27-1.jpeg" alt=""></p>
<h3 id="1-2-Atkins的物理化学第9版"><a href="#1-2-Atkins的物理化学第9版" class="headerlink" title="1.2  Atkins的物理化学第9版"></a>1.2  Atkins的物理化学第9版</h3><p>前面几节我们都是用的这一部分作为参考，忘了的童鞋们返回继续重修；这本书网上已经可以下载第十版的pdf文件了。</p>
<p><img src="/2017/12/18/ex27/ex27-2.jpeg" alt=""></p>
<h3 id="1-3-Jens-K-Norskov-的-Fundamental-Concepts-in-Heterogeneous-Catalysis"><a href="#1-3-Jens-K-Norskov-的-Fundamental-Concepts-in-Heterogeneous-Catalysis" class="headerlink" title="1.3 Jens. K. Norskov 的 Fundamental Concepts in Heterogeneous Catalysis"></a>1.3 Jens. K. Norskov 的 Fundamental Concepts in Heterogeneous Catalysis</h3><p><img src="/2017/12/18/ex27/ex27-3.jpeg" alt=""></p>
<h2 id="2-频率计算的细节问题"><a href="#2-频率计算的细节问题" class="headerlink" title="2 频率计算的细节问题"></a>2 频率计算的细节问题</h2><p>当你阅读完前面推荐书中的频率部分后，应该会明白很多。本节的第二部分我们主要讨论下频率计算的一些大家有顾虑的细节问题：</p>
<h3 id="2-1-怎么进行零点能校正？"><a href="#2-1-怎么进行零点能校正？" class="headerlink" title="2.1 怎么进行零点能校正？"></a>2.1 怎么进行零点能校正？</h3><p>以乙醇的计算为例：</p>
<p>A）首先结构优化完毕后我们会得到分子的能量：$E_{0}$  （OSZICAR中的E0）</p>
<p>B）频率计算后我们会得到分子的零点能：$ZPE$</p>
<p>C）零点能校正之后的乙醇分子能量为： $E_{ZPE} =  E_0 + ZPE$</p>
<p>D）A 和 B 得出的结果直接相加即可，不要想太多。</p>
<h3 id="2-2-怎么计算过渡态和反应热的零点能校正？（菜鸟暂且跳过）"><a href="#2-2-怎么计算过渡态和反应热的零点能校正？（菜鸟暂且跳过）" class="headerlink" title="2.2 怎么计算过渡态和反应热的零点能校正？（菜鸟暂且跳过）"></a>2.2 怎么计算过渡态和反应热的零点能校正？（菜鸟暂且跳过）</h3><p>对一个反应：IS —&gt; TS —&gt; FS</p>
<p>IS: Initial State 反应物</p>
<p>TS: Transition State 过渡态</p>
<p>FS: Final State 产物</p>
<p>记住这几个定义，本书后面 IS, TS, FS 用的时候多着呢！</p>
<p>1）优化反应物 IS 和产物 FS 的结构，获得能量：$E(\textrm{IS})$, $E(\textrm{FS})$;</p>
<p>2）对反应物和产物进行频率计算，获得各自的零点能：$\textrm{ZPE(IS)}, \textrm{ZPE(FS)}$。</p>
<p>3）搜索过渡态，获得结构和能量 $E(\textrm{TS})$;</p>
<p>4）过渡态频率分析，获得零点能 $\textrm{ZPE(TS)}$</p>
<p><strong>不考虑零点能的反应能垒 ($E_a$) 和反应热 ($\Delta E$)：</strong></p>
<script type="math/tex; mode=display">E_a = E(\textrm{TS}) – E(\textrm{IS}) \\
 \Delta E = E(\textrm{FS}) –  E(\textrm{IS})</script><p>考虑零点能校正：</p>
<script type="math/tex; mode=display">
\begin{align}
E{a(\textrm{ZPE})} &= E_{\textrm{ZPE}}(\textrm{TS}) – E_{\textrm{ZPE}}(\textrm{IS}) \\     
     &= E(\textrm{TS}) + \textrm{ZPE(TS}) – E(\textrm{IS}) – \textrm{ZPE(IS}) \\
     &= E_a + \textrm{ZPE(TS)} – \textrm{ZPE(IS)}
\end{align}</script><p>同理:</p>
<p>$ \Delta E(\textrm{ZPE}) = \Delta E + \textrm{ZPE(FS)} – \textrm{ZPE(IS)} $</p>
<p>两个处理方式：</p>
<p>a. 先获取未校正的结果，然后把零点能各自相减；</p>
<p>b. 先将各个物种进行零点能校正，然后在计算反应能垒或者反应热</p>
<p>效果是一样的</p>
<p>2.2 频率计算的时候，是不是体系中所有的原子都放开？</p>
<p>不一定；这取决于你的体系，以及你想要关注的部分:</p>
<hr>
<p><strong>例子A:</strong></p>
<p>乙醇在Cu(111)表面上的吸附，计算吸附热的零点能校正</p>
<script type="math/tex; mode=display">
\ce{CH_3CH_2OH + Cu(111) -> Cu(111)-CH_3CH_2OH}</script><p>此时，Cu(111)表面我们在计算频率的时候是要固定住的！只振动乙醇分子即可。</p>
<hr>
<p><strong>例子B:</strong></p>
<p>计算CO在Cu(111)表面上的吸附：</p>
<p>同A，固定Cu(111) 表面，如果你只关心 CO 在垂直表面上的振动，那么CO的 $x, y$ 方向便可以固定住，在坐标后面为：<code>F F T</code></p>
<hr>
<p><strong>例子C:</strong></p>
<p>苯酚在Cu(111)表面上 O—H 键断裂活化能的零点能校正：</p>
<p>在这里我们拿苯酚作为例子，很多时候，计算的对象比较大，全部频率优化非常耗时，那我们就得选择性地固定住一部分，只关心关键的局域部分。这个例子中我们主要讨论零点能对 O—H 键断裂活化能的影响，因此我们可以把苯环的部分固定住，只放开 O 和 H 原子进行振动。</p>
<p>当然啦，这是一个简化的计算，肯定不如全部振动的结果好，但迫于计算时间的压力，这是一个折中的好办法。此外，由于在反应中苯环部分变化不大，所以即使我们全部放开，它对反应热和反应能垒的影响也很小，零点能部分相减的时候抵消了。在这里你要深刻体会到，意识到，<strong>把握到相对这两个字在理论计算中的巨大作用！！！</strong></p>
<hr>
<p>还有一点要注意的是：<code>IS</code>，<code>TS</code>和<code>FS</code>中，所固定和放开的原子必须一致！！！</p>
<p><strong>不要在<code>IS</code>中固定苯环，而在<code>TS</code>或者<code>FS</code>中放开，</strong> 这样计算出来的结果只能用脑残来形容了。(<em>ps. 本人犯的这种错误太多啦，已经不能用脑残来形容了！</em>)</p>
<hr>
<h2 id="3-影响频率计算的因素测试"><a href="#3-影响频率计算的因素测试" class="headerlink" title="3 影响频率计算的因素测试:"></a>3 影响频率计算的因素测试:</h2><p>前面提到过：<code>ENCUT</code>, <code>KPOINTS</code>, <code>POTIM</code>, <code>EDIFF</code>都会对频率计算产生影响。频率计算很多时候会有小的虚频出现，通俗点说就是数值噪音。我们可能会想到，凡是可以提高精度的办法是不是就可以降低噪音了呢？写到这里，大师兄突然想起初中的一个老师说过一句话：好记性不如烂笔头，意思是让我们多写，这样记得会比较快。还有一句名言：<strong>纸上学来终觉浅，绝知此事要躬行！学习 </strong>VASP<strong>，亲自上手实践及其重要，看遍官网，翻烂本书不去行动也是白搭，好听点说只能是纸上谈兵。</strong></p>
<p>下面的测试主要从零点能和虚频，和时间三个方面来判断：测试的命令为：</p>
<p>获取虚频命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;f/i&#x27;</span>  */OUTCAR | awk <span class="string">&#x27;&#123;print $1 &quot;\t &quot; $2 &quot;\t&quot; $8 &quot;\t &quot; $9 &quot;\t&quot; $10 &quot;\t&quot; $11&#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>获取时间命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep Elapsed */OUTCAR | sort -n</span><br></pre></td></tr></table></figure></p>
<p>获取零点能：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> * ; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span> $(<span class="built_in">cd</span> <span class="variable">$i</span> ; fsum ; <span class="built_in">cd</span> <span class="variable">$OLDPWD</span>);<span class="keyword">done</span>  | sort –n</span><br></pre></td></tr></table></figure></p>
<h3 id="3-1-EDIFFG测试"><a href="#3-1-EDIFFG测试" class="headerlink" title="3.1  EDIFFG测试"></a>3.1  EDIFFG测试</h3><h4 id="3-1-1测试"><a href="#3-1-1测试" class="headerlink" title="3.1.1测试"></a>3.1.1测试</h4><p>$4, 5, 6, 7, 8$ 分别代表 <code>EDIFF=1E-4</code> 到 <code>-8</code> 的测试任务；</p>
<p><img src="/2017/12/18/ex27/ex27-4.jpeg" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> * ; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$i</span> $(<span class="built_in">cd</span> <span class="variable">$i</span> ; fsum ; <span class="built_in">cd</span> <span class="variable">$OLDPWD</span>); <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>零点能的计算结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">EDIFF</th>
<th style="text-align:left">ZPE</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">2.14344</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">2.12494</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">2.11698</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">2.11696</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">2.11696</td>
<td style="text-align:left">eV</td>
</tr>
</tbody>
</table>
</div>
<p>a. 可以看出来在<code>1E=-6</code>以后，零点能变化基本为 <code>0</code>了；我们可以用这个设置；</p>
<p>b. 虽然你测出来一个很好的参数值，很不幸，这是默认的。</p>
<p>c. 从时间上考虑，本人会选择 <code>EDIFF= 1E-5</code>，这比 <code>1E=-6</code> 快了将近一倍；</p>
<p>d. $5$ 和 $6$ 之间的误差为：$ 0.008/2.117 = 0.38\% $；</p>
<p>e. 此外，单个的零点能貌似没有什么用处，一般都是两个结构的零点能相减。这个操作也会抵消一部分的计算误差。</p>
<hr>
<h4 id="3-1-2-虚频"><a href="#3-1-2-虚频" class="headerlink" title="3.1.2 虚频"></a>3.1.2 虚频</h4><p><img src="/2017/12/18/ex27/ex27-5.jpeg" alt=""></p>
<p><strong>（这个命令只展示一次，后面测试结果全部用下面的表格）</strong></p>
<table><tr><th>EDIFF</th><th>Nth</th><th>WN</th><th>Unit</th><th>Energy</th><th>Unit</th></tr><tr><td rowspan="3">4</td><td>25</td><td>10.183435</td><td> cm<sup>-1</sup></td><td>1.262585</td><td>meV</td></tr><tr><td>26</td><td>43.891375</td><td> cm<sup>-1</sup></td><td>5.441839</td><td>meV</td></tr><tr><td>27</td><td>61.646745</td><td> cm<sup>-1</sup></td><td>7.643225</td><td>meV</td></tr><tr><td rowspan="3">5</td><td>25</td><td>6.773094</td><td> cm<sup>-1</sup></td><td>0.839757</td><td>meV</td></tr><tr><td>26</td><td>28.045092</td><td> cm<sup>-1</sup></td><td>3.477149</td><td>meV</td></tr><tr><td>27</td><td>52.28955</td><td> cm<sup>-1</sup></td><td>6.48308</td><td>meV</td></tr><tr><td rowspan="3">6</td><td>25</td><td>6.132037</td><td> cm<sup>-1</sup></td><td>0.760276</td><td>meV</td></tr><tr><td>26</td><td>18.62878</td><td> cm<sup>-1</sup></td><td>2.309675</td><td>meV</td></tr><tr><td>27</td><td>65.657693</td><td> cm<sup>-1</sup></td><td>8.140519</td><td>meV</td></tr><tr><td rowspan="3">7</td><td>25</td><td>6.03848</td><td> cm<sup>-1</sup></td><td>0.748676</td><td>meV</td></tr><tr><td>26</td><td>19.115009</td><td> cm<sup>-1</sup></td><td>2.36996</td><td>meV</td></tr><tr><td>27</td><td>65.726299</td><td> cm<sup>-1</sup></td><td>8.149025</td><td>meV</td></tr><tr><td rowspan="3">8</td><td>25</td><td>6.036457</td><td> cm<sup>-1</sup></td><td>0.748425</td><td>meV</td></tr><tr><td>26</td><td>19.156334</td><td> cm<sup>-1</sup></td><td>2.375084</td><td>meV</td></tr><tr><td>27</td><td>65.711053</td><td> cm<sup>-1</sup></td><td>8.147135</td><td>meV</td></tr></table>

<p>a. 改变收敛标准，并没有消除虚频，测试 $5$ 中，稍微降低了些，其他情况下，最大的仍然都再 <code>1500 px-1</code> 左右</p>
<p>b. $6$, $7$, $8$ 中的虚频基本一致，说明增加收敛标准，并没起到什么好的效果。</p>
<h4 id="3-1-3-时间"><a href="#3-1-3-时间" class="headerlink" title="3.1.3 时间"></a>3.1.3 时间</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">EDIFF</th>
<th style="text-align:left">Time</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">1702.463</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">2295.233</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">4298.571</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">5481.423</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">5998.518</td>
<td style="text-align:left">s</td>
</tr>
</tbody>
</table>
</div>
<p>复习下谁偷走了我的机时中<code>EDIFF</code>的因素；增加<code>EDIFF</code>，计算时间变长了。（离子步数一致，每个离子步的收敛步数增多了） 一般来说<code>EDIFF</code>采用默认值或者<code>1E-5</code>都可以满足情况，任务比较繁重的时候议用<code>1E-5</code>。本节在后面的测试中，都采用 <strong>VASP</strong> 的默认<code>EDIFF</code>值进行（<code>1E-6</code>）</p>
<hr>
<h3 id="3-2-ENCUT测试"><a href="#3-2-ENCUT测试" class="headerlink" title="3.2 ENCUT测试"></a>3.2 ENCUT测试</h3><h4 id="3-2-1-零点能"><a href="#3-2-1-零点能" class="headerlink" title="3.2.1 零点能"></a>3.2.1 零点能</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">ENCU</th>
<th style="text-align:left">ZPE</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">400</td>
<td style="text-align:left">2.11698</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">500</td>
<td style="text-align:left">2.11448</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">600</td>
<td style="text-align:left">2.11880</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">700</td>
<td style="text-align:left">2.11971</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">800</td>
<td style="text-align:left">2.11928</td>
<td style="text-align:left">eV</td>
</tr>
</tbody>
</table>
</div>
<p>从表中可以得出结论：增加<code>ENCUT</code>,对零点能的影响很小；</p>
<p>在计算的过程中，<code>ENCUT</code>要保持一致，一但选定后就不要再轻易改动，这个表的数据告诉我们，即使改动了<code>ENCUT</code>，对零点能的影响也很小，所以<code>ENCUT</code>的影响可以忽略。</p>
<h4 id="3-2-2-虚频："><a href="#3-2-2-虚频：" class="headerlink" title="3.2.2 虚频："></a>3.2.2 虚频：</h4><table><tr><th>ENCUT</th><th>Nth</th><th>WN</th><th>Unit</th><th>energy</th><th>unit</th></tr><tr><td rowspan="3">400</td><td>25</td><td>6.132038</td><td> cm<sup>-1</sup></td><td>0.760276</td><td>meV</td></tr><tr><td>26</td><td>18.62878</td><td> cm<sup>-1</sup></td><td>2.309675</td><td>meV</td></tr><tr><td>27</td><td>65.65769</td><td> cm<sup>-1</sup></td><td>8.140519</td><td>meV</td></tr><tr><td rowspan="4">500</td><td>24</td><td>0.489004</td><td> cm<sup>-1</sup></td><td>0.060629</td><td>meV</td></tr><tr><td>25</td><td>16.7313</td><td> cm<sup>-1</sup></td><td>2.074418</td><td>meV</td></tr><tr><td>26</td><td>23.491849</td><td> cm<sup>-1</sup></td><td>2.912619</td><td>meV</td></tr><tr><td>27</td><td>66.062971</td><td> cm<sup>-1</sup></td><td>8.190767</td><td>meV</td></tr><tr><td rowspan="4">600</td><td>24</td><td>0.288462</td><td> cm<sup>-1</sup></td><td>0.035765</td><td>meV</td></tr><tr><td>25</td><td>4.853849</td><td> cm<sup>-1</sup></td><td>0.601801</td><td>meV</td></tr><tr><td>26</td><td>6.324527</td><td> cm<sup>-1</sup></td><td>0.784142</td><td>meV</td></tr><tr><td>27</td><td>52.075614</td><td> cm<sup>-1</sup></td><td>6.456556</td><td>meV</td></tr><tr><td rowspan="3">700</td><td>25</td><td>0.747158</td><td> cm<sup>-1</sup></td><td>0.092636</td><td>meV</td></tr><tr><td>26</td><td>6.175845</td><td> cm<sup>-1</sup></td><td>0.765708</td><td>meV</td></tr><tr><td>27</td><td>32.540704</td><td> cm<sup>-1</sup></td><td>4.034535</td><td>meV</td></tr><tr><td rowspan="3">800</td><td>25</td><td>0.289332</td><td> cm<sup>-1</sup></td><td>0.035873</td><td>meV</td></tr><tr><td>26</td><td>7.356367</td><td> cm<sup>-1</sup></td><td>0.912074</td><td>meV</td></tr><tr><td>27</td><td>26.44812</td><td> cm<sup>-1</sup></td><td>3.27915</td><td>meV</td></tr></table>

<p>增加<code>ENCUT</code>可以减小虚频；从 $400$ 增加到 $800$ 后，最大的虚频波数从 $65~cm^{-1}$ 减小到 $26~cm^{-1}$， 但 A 中的结果是不是要求我们算频率的时候，必须要把 <code>ENCUT</code>增大呢？ 答：<strong>没必要！！</strong></p>
<p>因为前面零点能变化甚微，且虚频从 $65~cm^{-1}$ 减小到 $26~cm^{-1}$, 只能说是在误差范围内变化，我们是可以承受的，此时<code>ENCUT</code>在减小虚频中的作用，大家记住这一点就可以了。此外，增加<code>ENCUT</code>也会使得计算时间变长（见下图）。但是如果虚频大于$100~cm^{-1}$，且不是反应路径的时候，你就得小心了。</p>
<h4 id="3-2-3-时间"><a href="#3-2-3-时间" class="headerlink" title="3.2.3 时间"></a>3.2.3 时间</h4><p>命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep Elapsed */OUTCAR | sort –n</span><br></pre></td></tr></table></figure></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">ENCUT</th>
<th style="text-align:left">Time</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">400</td>
<td style="text-align:left">1832.405</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">500</td>
<td style="text-align:left">2389.045</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">600</td>
<td style="text-align:left">3019.433</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">700</td>
<td style="text-align:left">4285.491</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">800</td>
<td style="text-align:left">11943.02</td>
<td style="text-align:left">s</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="3-3-PREC"><a href="#3-3-PREC" class="headerlink" title="3.3 PREC"></a>3.3 PREC</h3><p>这里我们设置了三个参数：<code>Normal</code>, <code>Accurate</code>和<code>High</code></p>
<h4 id="3-3-1-零点能变化甚微"><a href="#3-3-1-零点能变化甚微" class="headerlink" title="3.3.1 零点能变化甚微"></a>3.3.1 零点能变化甚微</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">PREC</th>
<th style="text-align:left">ZPE</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">N</td>
<td style="text-align:left">2.11698</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">2.1147</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">H</td>
<td style="text-align:left">2.11363</td>
<td style="text-align:left">eV</td>
</tr>
</tbody>
</table>
</div>
<h4 id="3-3-2-虚频"><a href="#3-3-2-虚频" class="headerlink" title="3.3.2 虚频"></a>3.3.2 虚频</h4><table><tr><th>PREC</th><th>Nth</th><th>Wavenumber</th><th>Unit</th><th>Energy</th><th>Unit</th></tr><tr><td rowspan="3">N</td><td>25</td><td>6.132037</td><td> cm<sup>-1</sup></td><td>0.760276</td><td>meV</td></tr><tr><td>26</td><td>18.62878</td><td> cm<sup>-1</sup></td><td>2.309675</td><td>meV</td></tr><tr><td>27</td><td>65.657693</td><td> cm<sup>-1</sup></td><td>8.140519</td><td>meV</td></tr><tr><td rowspan="3">A</td><td>25</td><td>5.493108</td><td> cm<sup>-1</sup></td><td>0.681059</td><td>meV</td></tr><tr><td>26</td><td>10.478293</td><td> cm<sup>-1</sup></td><td>1.299143</td><td>meV</td></tr><tr><td>27</td><td>65.861524</td><td> cm<sup>-1</sup></td><td>8.165791</td><td>meV</td></tr><tr><td rowspan="4">H</td><td>24</td><td>0.552665</td><td> cm<sup>-1</sup></td><td>0.068522</td><td>meV</td></tr><tr><td>25</td><td>16.954329</td><td> cm<sup>-1</sup></td><td>2.10207</td><td>meV</td></tr><tr><td>26</td><td>29.95621</td><td> cm<sup>-1</sup></td><td>3.714098</td><td>meV</td></tr><tr><td>27</td><td>68.287802</td><td> cm<sup>-1</sup></td><td>8.466611</td><td>meV</td></tr></table>

<p><code>PREC</code>同样对消除虚频不管用！！！！</p>
<h4 id="3-3-3-时间"><a href="#3-3-3-时间" class="headerlink" title="3.3.3 时间"></a>3.3.3 时间</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Prec</th>
<th style="text-align:left">Time</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">N</td>
<td style="text-align:left">4298.571</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">7596.994</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">H</td>
<td style="text-align:left">7962.539</td>
<td style="text-align:left">s</td>
</tr>
</tbody>
</table>
</div>
<p>通过前面的虚频和零点能，结合此时的时间，我们可以得出结论：</p>
<p><code>PREC = Normal</code> 完全够用了。</p>
<hr>
<h3 id="3-4-POTIM-参数"><a href="#3-4-POTIM-参数" class="headerlink" title="3.4  POTIM 参数"></a>3.4  POTIM 参数</h3><p><img src="/2017/12/18/ex27/ex27-6.jpeg" alt=""></p>
<h4 id="3-4-1-零点能："><a href="#3-4-1-零点能：" class="headerlink" title="3.4.1 零点能："></a>3.4.1 零点能：</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">POTIM</th>
<th style="text-align:left">ZPE</th>
<th style="text-align:left">eV</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0.001</td>
<td style="text-align:left">2.17125</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">0.005</td>
<td style="text-align:left">2.12616</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">0.015</td>
<td style="text-align:left">2.11769</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">0.020</td>
<td style="text-align:left">2.11698</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">0.050</td>
<td style="text-align:left">2.11671</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">0.100</td>
<td style="text-align:left">2.12481</td>
<td style="text-align:left">eV</td>
</tr>
</tbody>
</table>
</div>
<p><code>POTIM</code>太小的时候，对零点能影响很大。（$0.001$ 和 $0.005$，$0.015$ 对比）</p>
<h4 id="3-4-2虚频"><a href="#3-4-2虚频" class="headerlink" title="3.4.2虚频"></a>3.4.2虚频</h4><table><tr><th>POTIM</th><th>Nth</th><th>Wavenumber</th><th>Unit</th><th>Energy</th><th>Unit</th></tr><tr><td rowspan="3">0.001</td><td>25</td><td>21.746998</td><td> cm<sup>-1</sup></td><td>2.696285</td><td>meV</td></tr><tr><td>26</td><td>39.656607</td><td> cm<sup>-1</sup></td><td>4.916794</td><td>meV</td></tr><tr><td>27</td><td>56.54809</td><td> cm<sup>-1</sup></td><td>7.011072</td><td>meV</td></tr><tr><td rowspan="4">0.005</td><td>24</td><td>0.675194</td><td> cm<sup>-1</sup></td><td>0.083713</td><td>meV</td></tr><tr><td>25</td><td>12.785399</td><td> cm<sup>-1</sup></td><td>1.585188</td><td>meV</td></tr><tr><td>26</td><td>36.264179</td><td> cm<sup>-1</sup></td><td>4.496187</td><td>meV</td></tr><tr><td>27</td><td>61.287932</td><td> cm<sup>-1</sup></td><td>7.598738</td><td>meV</td></tr><tr><td rowspan="3">0.015</td><td>25</td><td>5.626635</td><td> cm<sup>-1</sup></td><td>0.697614</td><td>meV</td></tr><tr><td>26</td><td>23.117605</td><td> cm<sup>-1</sup></td><td>2.866219</td><td>meV</td></tr><tr><td>27</td><td>59.01173</td><td> cm<sup>-1</sup></td><td>7.316525</td><td>meV</td></tr><tr><td rowspan="3">0.020</td><td>25</td><td>6.132037</td><td> cm<sup>-1</sup></td><td>0.760276</td><td>meV</td></tr><tr><td>26</td><td>18.62878</td><td> cm<sup>-1</sup></td><td>2.309675</td><td>meV</td></tr><tr><td>27</td><td>65.657693</td><td> cm<sup>-1</sup></td><td>8.140519</td><td>meV</td></tr><tr><td rowspan="4">0.050</td><td>24</td><td>0.327964</td><td> cm<sup>-1</sup></td><td>0.040662</td><td>meV</td></tr><tr><td>25</td><td>23.575077</td><td> cm<sup>-1</sup></td><td>2.922938</td><td>meV</td></tr><tr><td>26</td><td>24.337978</td><td> cm<sup>-1</sup></td><td>3.017526</td><td>meV</td></tr><tr><td>27</td><td>95.239085</td><td> cm<sup>-1</sup></td><td>11.80815</td><td>meV</td></tr><tr><td rowspan="5">0.100</td><td>23</td><td>1.574379</td><td> cm<sup>-1</sup></td><td>0.195198</td><td>meV</td></tr><tr><td>24</td><td>5.865037</td><td> cm<sup>-1</sup></td><td>0.727172</td><td>meV</td></tr><tr><td>25</td><td>20.89784</td><td> cm<sup>-1</sup></td><td>2.591003</td><td>meV</td></tr><tr><td>26</td><td>45.241296</td><td> cm<sup>-1</sup></td><td>5.609208</td><td>meV</td></tr><tr><td>27</td><td>168.238904</td><td> cm<sup>-1</sup></td><td>20.85897</td><td>meV</td></tr></table>

<p><code>POTIM</code>太大的时候，会搞出来超大号的虚频（$0.050$ 和 $0.100$）！</p>
<h4 id="3-4-3-时间"><a href="#3-4-3-时间" class="headerlink" title="3.4.3 时间"></a>3.4.3 时间</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">POTIM</th>
<th style="text-align:left">Time</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1530.591</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">2065.911</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">15</td>
<td style="text-align:left">3845.977</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td style="text-align:left">4298.571</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">50</td>
<td style="text-align:left">4829.897</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">100</td>
<td style="text-align:left">5191.23</td>
<td style="text-align:left">s</td>
</tr>
</tbody>
</table>
</div>
<p><code>POTIM</code> 越小，单个离子步收敛的越快，也就是需要更少的电子步！</p>
<p>综合前面的三个因素：<code>POTIM</code>太小或者太大都不好， <code>POTIM = 0.015</code>或者<code>0.020</code> 是很好的选择。 <code>0.015</code>是默认值。</p>
<hr>
<h3 id="3-5-POINTS"><a href="#3-5-POINTS" class="headerlink" title="3.5 POINTS"></a>3.5 POINTS</h3><p>这里用 $1$, $2$, $3$ 来分别代表 $1 \times 1 \times 1$， $2 \times 2 \times 2$ 和 $3 \times 3  \times 3$ 的 K 点。</p>
<h4 id="3-5-1-零点能："><a href="#3-5-1-零点能：" class="headerlink" title="3.5.1 零点能："></a>3.5.1 零点能：</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">KPOINTS</th>
<th style="text-align:left">ZPE</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">2.11698</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">2.11678</td>
<td style="text-align:left">eV</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">2.11689</td>
<td style="text-align:left">eV</td>
</tr>
</tbody>
</table>
</div>
<h4 id="3-5-2-虚频："><a href="#3-5-2-虚频：" class="headerlink" title="3.5.2 虚频："></a>3.5.2 虚频：</h4><table><tr><th>KPOINTS</th><th>Nth</th><th>Wavenumber</th><th>Unit</th><th>Energy</th><th>Unit</th></tr><tr><td rowspan="3">1</td><td>25</td><td>6.132037</td><td> cm<sup>-1</sup></td><td>0.76028</td><td>meV</td></tr><tr><td>26</td><td>18.62878</td><td> cm<sup>-1</sup></td><td>2.30968</td><td>meV</td></tr><tr><td>27</td><td>65.657693</td><td> cm<sup>-1</sup></td><td>8.14052</td><td>meV</td></tr><tr><td rowspan="3">2</td><td>25</td><td>5.726298</td><td> cm<sup>-1</sup></td><td>0.70997</td><td>meV</td></tr><tr><td>26</td><td>19.193163</td><td> cm<sup>-1</sup></td><td>2.37965</td><td>meV</td></tr><tr><td>27</td><td>64.645347</td><td> cm<sup>-1</sup></td><td>8.015</td><td>meV</td></tr><tr><td rowspan="3">3</td><td>25</td><td>4.826986</td><td> cm<sup>-1</sup></td><td>0.59847</td><td>meV</td></tr><tr><td>26</td><td>19.138554</td><td> cm<sup>-1</sup></td><td>2.37288</td><td>meV</td></tr><tr><td>27</td><td>64.83042</td><td> cm<sup>-1</sup></td><td>8.03795</td><td>meV</td></tr></table>

<h4 id="3-5-3-时间"><a href="#3-5-3-时间" class="headerlink" title="3.5.3 时间"></a>3.5.3 时间</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">KPOINTS</th>
<th style="text-align:left">Time</th>
<th style="text-align:left">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">4298.571</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">8997.709</td>
<td style="text-align:left">s</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">13480.847</td>
<td style="text-align:left">s</td>
</tr>
</tbody>
</table>
</div>
<p>综合前面三点： <code>Gamma</code>点足矣！</p>
<hr>
<h2 id="4-扩展阅读："><a href="#4-扩展阅读：" class="headerlink" title="4      扩展阅读："></a>4      扩展阅读：</h2><p>4.1 下载本节的练习，按照本节的顺序操作分析；</p>
<p>4.2 阅读 <strong>VASP</strong> 官网中关于原子和分子的例子，去尝试回答里面的问题；</p>
<p><a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/Atoms_and_Molecules">https://cms.mpi.univie.ac.at/wiki/index.php/Atoms_and_Molecules</a></p>
<h2 id="5-总结："><a href="#5-总结：" class="headerlink" title="5. 总结："></a>5. 总结：</h2><p>分析完前面的测试，我们总结一下高效频率计算的关键点：</p>
<p>5.1 <code>IBRION = 5</code>  （告诉 <strong>VASP</strong> 我们要算频率）</p>
<p>5.2 <code>POTIM = 0.015</code></p>
<p>5.3 <code>NFREE = 2</code></p>
<p>5.4 <code>ENCUT</code>和原来一样</p>
<p>5.5 <code>PREC = Normal</code></p>
<p>5.6 <code>EDIFF = 1E-5</code> 或者 <code>1E-6</code></p>
<p>5.7 <code>KPOINTS</code>  <code>Gamma</code>点即可。</p>
<p>本节内容太多了，原因在于，这是菜鸟篇的最后一节！！！</p>
<p>大师兄本人亲自做了很多测试，原因只有一个，告诉大家如何把握计算结果与时间的关系。在最短的时间获取最多的有价值的结果，这是计算化学的一个精髓所在。体现了你对时间和生命的尊重，也体现了你对高效率生活的追求。在菜鸟的时候，可以尽情地去测试。</p>
<p>大师兄之所以用乙醇这个大分子去给大家展示，很多人直接用 $\rm{O_2}$，$\rm{CO}$ 或者水分子的计算作为例子。那样的简单例子不具有很强的代表性，当你把一个相对复杂的东西搞明白了，这些小分子的计算，就如同小儿科一般了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/17/ex26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/17/ex26/" class="post-title-link" itemprop="url">Ex26 乙醇分子的振动频率计算(四)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-17 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-17T02:06:48-05:00">2017-12-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/17/ex26/" class="post-meta-item leancloud_visitors" data-flag-title="Ex26 乙醇分子的振动频率计算(四)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/17/ex26/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/17/ex26/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面我们学会了通过使用 <strong>Jmol</strong> 查看分子振动。但分子振动频率在<code>OUTCAR</code>是什么样子的呢？今天我们就分析一下<code>OUTCAR</code>文件中的频率信息，以及如何写脚本计算零点能矫正。</p>
<hr>
<h2 id="1-OUTCAR分析"><a href="#1-OUTCAR分析" class="headerlink" title="1 OUTCAR分析"></a>1 OUTCAR分析</h2><h3 id="1-1-回顾一下Jmol中的频率振动"><a href="#1-1-回顾一下Jmol中的频率振动" class="headerlink" title="1.1 回顾一下Jmol中的频率振动"></a>1.1 回顾一下Jmol中的频率振动</h3><p><img src="/2017/12/17/ex26/ex26-1.jpeg" alt=""></p>
<p><strong>Jmol</strong> 提取了<code>OUTCAR</code>中的振动信息，将每个振动模式的频率列了出来。</p>
<h3 id="1-2-OUTCAR中的信息："><a href="#1-2-OUTCAR中的信息：" class="headerlink" title="1.2 OUTCAR中的信息："></a>1.2 OUTCAR中的信息：</h3><p><img src="/2017/12/17/ex26/ex26-2.jpeg" alt=""></p>
<p>对比一下这两个振动频率和·中的前两个。</p>
<hr>
<p>1）<code>1 f =</code> 代表第一个振动模式，细心的你仔细观察，会发现每一行有四个单位的数值：<code>THz</code>, <code>2PiTHz</code>, <code>cm-1</code>,和 <code>meV</code>，这四个是完全等同的；</p>
<p>2）下面一行为坐标 X Y Z和每个原子在 $x, y, z$ 方向上的振动大小；</p>
<p>3）X Y Z下面的数字为结构的坐标信息（Cartesian坐标系），dx dy dz 为振动的具体数值；</p>
<p>4)后面的振动模式的频率和第一个的格式一样。</p>
<hr>
<h2 id="2-频率单位的换算"><a href="#2-频率单位的换算" class="headerlink" title="2 频率单位的换算"></a>2 频率单位的换算</h2><p>我们先讲一下这四个单位的换算公式：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">Relevant    Formulas:</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">$ E =   hc / \lambda $</td>
</tr>
<tr>
<td style="text-align:left">$ \nu = c / \lambda $</td>
</tr>
<tr>
<td style="text-align:left">$\tilde{\nu} = 1 / \lambda $</td>
</tr>
<tr>
<td style="text-align:left">$ T =   1 / \nu $</td>
</tr>
<tr>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><strong>Definitions:</strong></td>
</tr>
<tr>
<td style="text-align:left">$E$ =   energy ($eV$)</td>
</tr>
<tr>
<td style="text-align:left">$\lambda$ =   wavelength  ($m$)</td>
</tr>
<tr>
<td style="text-align:left">$\tilde{\nu}$ =   wavenumber  ($m^{-1}$)</td>
</tr>
<tr>
<td style="text-align:left">$T$ =   period ($s$)</td>
</tr>
<tr>
<td style="text-align:left">$\nu$  =   frequency  ($s^{-1}$ or $\textrm{Hz}$)</td>
</tr>
<tr>
<td style="text-align:left">$h$ = Planck’s constant = $4.135667516 \times 10^{-15}~eV \cdot s$</td>
</tr>
<tr>
<td style="text-align:left">$c$ =   speed of  light = $ 299792458~m/s$</td>
</tr>
</tbody>
</table>
</div>
<p>以第一个振动为例：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">1f   =</th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">111.907</td>
<td style="text-align:right">$\textrm{THz}$</td>
</tr>
<tr>
<td style="text-align:left">703.134</td>
<td style="text-align:right">2PiTHz</td>
</tr>
<tr>
<td style="text-align:left">3732.82</td>
<td style="text-align:right">$cm^{-1} $</td>
</tr>
<tr>
<td style="text-align:left">462.811</td>
<td style="text-align:right">$meV$</td>
</tr>
</tbody>
</table>
</div>
<p>1） THz 和 2PiTHz 的换算： $2\pi$ 的关系：</p>
<script type="math/tex; mode=display">111.907230~(\rm{THz})  \times 2 \pi  = 703.133866~(\rm{2PiTHz})</script><p>2） THz 和 cm-1 的关系：$\nu = c / \lambda = c \tilde{\nu} $， $c$ 是光速，$\lambda$ 是波长，$\tilde{\nu}$ 是波数，单位是 $m^{-1}$。计算前先换算成标准单位： 1 THz = 1012 Hz, 1 $cm^{-1}$ = 100 $m^{-1}$，因此：</p>
<script type="math/tex; mode=display">111.907230 \times 1012~(\textrm{Hz}) = 299792458~(m/s) \times 3732.823294 \times 100 (m^{-1})</script><p>3）THz 和能量 eV 的关系：</p>
<p>$ E = h\nu $， $h$ 为普朗克常数：$4.135667516 \times 10^{-15}~eV \cdot s$ <strong>(注意此时：Plank constant 的单位！！！)</strong></p>
<script type="math/tex; mode=display">462.811270 (meV) = 0.4628 eV = 4.135667516 \times 10^{-15} (eV*s) *  111.907230 \times 1012 (Hz)</script><p>4） 波数（$cm^{-1}$）和能量（$meV$）的关系：<br>$E = hc / \lambda = h \tilde \nu $<br>$ 462.811270~meV = 0.4628~eV<br> = 4.135667516 \times 10^{-15}~(eV*s) \times 299792458~(m/s) \times 3732.823294 \times 100~(m^{-1}) $</p>
<p>大家根据上面的公式自己手动算一遍就明白了，还可以使用下面这个网址进行计算：<a target="_blank" rel="noopener" href="http://halas.rice.edu/conversions">http://halas.rice.edu/conversions</a> 这里就不再多说了。</p>
<hr>
<h2 id="3-OUTCAR频率信息的提取："><a href="#3-OUTCAR频率信息的提取：" class="headerlink" title="3  OUTCAR频率信息的提取："></a>3  OUTCAR频率信息的提取：</h2><p>我们可以使用<code>grep</code>命令提取，有以下两个方式。在进行之前，首先强调一点：下面的解释<strong>只适用于</strong>NWRITE= 0、1或者2 的时候。因为NWRITE = 3 的时候，会额外再输出一次频率的信息。</p>
<h3 id="3-1-使用以下几个命令："><a href="#3-1-使用以下几个命令：" class="headerlink" title="3.1 使用以下几个命令："></a>3.1 使用以下几个命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep THz OUTCAR</span><br><span class="line">grep 2PiTHz OUTCAR</span><br><span class="line">grep cm-1 OUTCAR</span><br><span class="line">grep meV OUTCAR；</span><br></pre></td></tr></table></figure>
<p>这几个命令中，我们分别以振动的不同单位作为提取对象，便可以得到所有的振动信息（这里的所有指的是包含虚频）：以大师兄常用的 <code>grep cm-1 OUTCAR</code> 为例：</p>
<p><img src="/2017/12/17/ex26/ex26-3.jpeg" alt=""></p>
<p>黄色标出来的第一列：$9 \times 3 = 27$ 个振动模式，第二列是以<code>cm-1</code>为单位的振动频率大小，最后三行 <code>f/i=</code> 指的是虚频。</p>
<hr>
<p>前面我们提到过，虚频可以判断结构是否稳定。那这里，我们计算出的乙醇分子结构肯定不稳定喽？不一定。</p>
<p>因为频率计算和软件的数值积分有关（我也不清楚数值积分怎么进行的）；</p>
<p>计算过程中我们的设置对频率计算影响很大，<code>KPOINTS</code>, <code>ENCUT</code>, <code>EDIFF</code>, <code>POTIM</code>等都会影响计算的精度（下一节讨论）；综合这些因素，对于分子的振动频率来说（注意：声子谱不适用）一般低于 $100~cm^{-1}$ 的频率可以忽略。严格点可以降到 $50~cm^{-1}$，也就是说：如果你在计算中发现有个 $50~cm^{-1}$ 左右的虚频，完全可以不考虑。</p>
<hr>
<h3 id="3-2-grep-39-f-39-OUTCAR"><a href="#3-2-grep-39-f-39-OUTCAR" class="headerlink" title="3.2 grep &#39;f  =&#39; OUTCAR"></a>3.2 <code>grep &#39;f  =&#39; OUTCAR</code></h3><p><img src="/2017/12/17/ex26/ex26-4.jpeg" alt=""></p>
<p><strong>注意：图中虚频部分没有显示出来！严格按照我用的这个命令</strong></p>
<p>使用这个命令的时候，不提取虚频部分。查看虚频的时候，可以用之前的方式，也可以用这个命令：</p>
<p><img src="/2017/12/17/ex26/ex26-5.jpeg" alt=""></p>
<p>在零点能的计算时，虚频是不能考虑在内的，因为它不是分子的真实的振动模式。在我们这个例子中，虚频的出现是软件的误差所导致。在过渡态中，虚频代表的是反应方向。从另一个角度去分析：乙醇分子的零点能（下面讲到）为：$2.117~eV$，图中三个虚频对应的能量为：$0.76 + 2.31 + 8.14 = 11.11~meV = 0.01111~ eV$，所占比例为：$0.0111/2.117 = 0.5\% $ 这个可以忽略不计。</p>
<hr>
<h2 id="4-零点能校正"><a href="#4-零点能校正" class="headerlink" title="4 零点能校正"></a>4 零点能校正</h2><h3 id="4-1-明白什么是零点能：回顾频率计算第一节的内容："><a href="#4-1-明白什么是零点能：回顾频率计算第一节的内容：" class="headerlink" title="4.1 明白什么是零点能：回顾频率计算第一节的内容："></a>4.1 明白什么是零点能：回顾频率计算第一节的内容：</h3><p><img src="/2017/12/17/ex26/ex26-6.jpeg" alt=""></p>
<p><img src="/2017/12/17/ex26/ex26-7.jpeg" alt=""></p>
<h3 id="4-2-获取振动能量数据："><a href="#4-2-获取振动能量数据：" class="headerlink" title="4.2 获取振动能量数据："></a>4.2 获取振动能量数据：</h3><p><img src="/2017/12/17/ex26/ex26-8.jpeg" alt=""></p>
<p>分析下结构：</p>
<p><img src="/2017/12/17/ex26/ex26-9.jpeg" alt=""></p>
<p>上图输出共有11列（列之间用空格分开）：我们要的零点能在第10列，使用下面的命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;f  =&#x27;</span> OUTCAR | awk <span class="string">&#x27;&#123;print $10&#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>如果想同时输出第 1 和 10 两列：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;f  =&#x27;</span> OUTCAR | awk<span class="string">&#x27;&#123;print $1 &quot; &quot;$10&#125;&#x27;</span></span><br></pre></td></tr></table></figure><br><code>$1</code> 和 <code>$10</code> 之间有 2个 双引号：<strong>“ “</strong>，两个双引号里面有一个空格用来分开），否则两列会连在一起。</p>
<p><strong>注意！注意！注意！</strong></p>
<p><strong>这里我们提取的能量为：$h\nu$ ！！！</strong></p>
<p><strong>而零点能为 $1/2 h \nu$！！！</strong></p>
<h3 id="4-3-将所有振动的能量求和："><a href="#4-3-将所有振动的能量求和：" class="headerlink" title="4.3 将所有振动的能量求和："></a>4.3 将所有振动的能量求和：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qli@BigBroSci:~/Desktop/freq$ grep <span class="string">&#x27;f  =&#x27;</span> OUTCAR | awk <span class="string">&#x27;&#123;print $10&#125;&#x27;</span> | paste -sd+ | bc</span><br><span class="line">qli@BigBroSci:~/Desktop/freq$ 4233.962325</span><br></pre></td></tr></table></figure>
<p>输出的4233.96就是所有的 hv 之和。</p>
<p>1）不要忘记除以 $2$</p>
<p>2）此时单位是 $meV$，换算成 $eV$ 还需要除以 $1000$。</p>
<p>3）所以，我们的零点能是 $4233.962325/2/1000~ eV= 2.117~eV$</p>
<h3 id="4-4-写脚本"><a href="#4-4-写脚本" class="headerlink" title="4.4 写脚本"></a>4.4 写脚本</h3><p>将前面的命令写到一个文件里面就成为了脚本：怎么写呢？本人平时喜欢使用类似 $4233.962325$ 这个数字，除以 $2000$ 这一步在后面的工作中进行。因此只用到了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;f =&#x27;</span> OUTCAR | awk <span class="string">&#x27;&#123;print $10&#125;&#x27;</span> | paste -sd+ | bc</span><br></pre></td></tr></table></figure><br>这个命令。写脚本的具体操作：</p>
<p><img src="/2017/12/17/ex26/ex26-10.jpeg" alt=""></p>
<p>1）把这行命令写到一个文件中，文件名为 <code>fsum</code> （本人不喜欢 <code>.sh</code> 尾缀，加不加都一样）；</p>
<p>2）赋予可执行权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x ~/bin/fsum</span><br></pre></td></tr></table></figure></p>
<p>3）移到 <code>~/bin</code> 文件夹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv fsum ~/bin</span><br></pre></td></tr></table></figure></p>
<p>4）在任何一个频率计算的目录下运行：敲命令 <code>fsum</code> 即可；</p>
<p>5）不喜欢 <code>fsum</code> 这个命令，将文件名改成你自己喜欢的名字：</p>
<p>如果想在脚本里面直接完成除以 $2000$ 的任务，可以这么写：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hv_sum=$(grep<span class="string">&quot;f  =&quot;</span> OUTCAR | awk <span class="string">&#x27;&#123;print  $10&#125;&#x27;</span>| paste -sd+ | bc)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;scale =6; <span class="variable">$hv_sum</span>/2000&quot;</span> | bc</span><br></pre></td></tr></table></figure>
<p><img src="/2017/12/17/ex26/ex26-11.jpeg" alt=""></p>
<p>此时结果的单位为：$eV$。</p>
<hr>
<h2 id="5-扩展练习："><a href="#5-扩展练习：" class="headerlink" title="5 扩展练习："></a>5 扩展练习：</h2><p>5.1 <code>OUTCAR</code>中的频率输出要看明白是怎么回事；</p>
<p>5.2 频率的各个单位的换算要搞明白；</p>
<p>5.3 怎么提取信息，计算零点能要掌握；</p>
<p>5.4 怎么写脚本，从现在开始要练习了！</p>
<h2 id="6-总结："><a href="#6-总结：" class="headerlink" title="6 总结："></a>6 总结：</h2><p>本节我们主要讨论了一下<code>OUTCAR</code>中的频率结果，能量换算，如何提取振动能量，以及如何计算零点能，最后简单介绍了一下脚本的写法，打消大家对脚本的崇拜心理，自己稍加琢磨也会写出实用的脚本！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/16/ex25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/16/ex25/" class="post-title-link" itemprop="url">Ex25 乙醇分子的振动频率计算(三)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-16 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-16T02:06:48-05:00">2017-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/16/ex25/" class="post-meta-item leancloud_visitors" data-flag-title="Ex25 乙醇分子的振动频率计算(三)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/16/ex25/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/16/ex25/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本节推荐一款可视化程序：<strong>Jmol</strong>，可以用来看分子结构以及振动频率。<strong>Jmol</strong> 是一款<code>Java</code>语言编写的，开源，<code>Linux</code>，<code>Windows</code>均可的使用的可视化软件。还记的我们从<code>ChemSpider</code>获取乙醇分子的情景吗？</p>
<p><img src="/2017/12/16/ex25/ex25-1.jpeg" alt=""></p>
<p><img src="/2017/12/16/ex25/ex25-2.jpeg" alt=""></p>
<p>对了！RSC的网页版中，乙醇分子的3D结构就是通过 <strong>Jmol</strong> 展示给大家的（3D图上方），并且我们下载的结构也是jmol格式的文件！可以通过 <strong>Jmol</strong> 直接打开。现在我们通过在电脑上运行Jmol，并查看分子的结构和振动频率。</p>
<hr>
<h2 id="1-Jmol在windows和linux下的安装："><a href="#1-Jmol在windows和linux下的安装：" class="headerlink" title="1. Jmol在windows和linux下的安装："></a>1. Jmol在windows和linux下的安装：</h2><h3 id="1-1-安装前准备（Java运行环境的安装）"><a href="#1-1-安装前准备（Java运行环境的安装）" class="headerlink" title="1.1 安装前准备（Java运行环境的安装）"></a>1.1 安装前准备（Java运行环境的安装）</h3><p><code>Windows</code>下：直接百度<code>Java Runtime Environment（JRE）</code>，安装软件。</p>
<p><img src="/2017/12/16/ex25/ex25-3.jpeg" alt=""></p>
<p>也可以官网下载：<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html">http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html</a></p>
<p><img src="/2017/12/16/ex25/ex25-4.jpeg" alt=""></p>
<p>注意两点：</p>
<p>1： 接受许可，</p>
<p>2：64位系统下载箭头所指的文件，然后安装即可。</p>
<p><code>Linux</code>下<code>Java</code>运行环境安装移步下方链接：</p>
<p><a target="_blank" rel="noopener" href="https://linux.cn/article-3792-1.html">怎样在Ubuntu 14.04中安装Java</a>： <a target="_blank" rel="noopener" href="https://linux.cn/article-3792-1.html">https://linux.cn/article-3792-1.html</a> </p>
<p>或者直接使用命令：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install default-jre</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="1-2-Jmol软件的下载和安装"><a href="#1-2-Jmol软件的下载和安装" class="headerlink" title="1.2 Jmol软件的下载和安装"></a>1.2 Jmol软件的下载和安装</h3><ul>
<li>Windows：</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/jmol/files/Jmol/">https://sourceforge.net/projects/jmol/files/Jmol/</a></p>
<p>打开链接后，图中箭头指的地方下载最新版的（<code>Linux</code>其实和<code>Windows</code>下载的文件一模一样，见后面说明），也可以任选版本进行下载。</p>
<p><img src="/2017/12/16/ex25/ex25-5.jpeg" alt=""></p>
<p>等待几秒后会弹出下载的窗口，其他浏览器也应该一样。</p>
<p><img src="/2017/12/16/ex25/ex25-6.jpeg" alt=""></p>
<p><img src="/2017/12/16/ex25/ex25-7.jpeg" alt=""></p>
<p>解压缩后就算安装好了，可以直接运行。</p>
<hr>
<p>运行 <strong>Jmol</strong> 程序：</p>
<p><img src="/2017/12/16/ex25/ex25-8.jpeg" alt=""></p>
<p>上图中 <code>箭头1</code>所指为 <code>jmol.bat</code> 文件，<code>箭头2</code>所指为 <code>Java</code>的可执行文件：<code>jmol.jar</code>。在<code>Windows</code>下任选一个双击即可打开 <strong>Jmol</strong> 程序。建议将解压缩之后文件夹中的<code>jmol.bat</code>或者<code>jmol.jar</code> 文件右键发送到桌面快捷方式。打开后如下图：</p>
<p><img src="/2017/12/16/ex25/ex25-9.jpeg" alt=""></p>
<hr>
<ul>
<li><code>Linux</code>下安装 <strong>Jmol</strong> 的方法:</li>
</ul>
<p>在 <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/jmol/files/Jmol/">https://sourceforge.net/projects/jmol/files/Jmol/</a>下载 <strong>Jmol</strong>（和前面介绍的<code>Windows</code>下载的文件一模一样），解压后的文件复制到<code>usr/bin</code>中，打开文件时在命令行输入<code>jmol.sh 文件名</code>即可（<strong>注意</strong>，<code>jmol.sh</code>和<code>文件名</code>之间 <strong>有空格！</strong>）。将解压目录加入<code>.bashrc</code>路径中也可以实现，同时需要给<code>jmol.sh</code>加上可执行权限，即<code>chmod u+x jmol.sh</code>，打开文件的方法仍用<code>jmol.sh 文件名</code>。(QQ群友：连赞提供！)</p>
<p>大师兄在<code>Linux</code>系统下的操作如下：</p>
<p>a）下载和<code>Windows</code>版的过程一样，下载完毕后，解压，</p>
<p>b）终端里面进入解压后的文件夹：</p>
<p><img src="/2017/12/16/ex25/ex25-10.jpeg" alt=""></p>
<p>注意一下几点：</p>
<p>b.1) <code>jmol.sh</code>就是我们在<code>Linux</code>系统下面的命令（<code>Windows</code>里面我们用<code>jmol.bat</code> 和 <code>jmol.jar</code>）；</p>
<p>b.2) 首先赋予它可执行的权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x  jmol.sh</span><br></pre></td></tr></table></figure><br>相反地，取消权限：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u-x jmol.sh</span><br></pre></td></tr></table></figure></p>
<p>b.3) 这里大师兄电脑下，<code>jmol.sh</code>变成绿色的了（不同电脑显示会不同，不要纠结）</p>
<p>b.4) 尝试运行一下： <code>./jmol.sh  OK</code></p>
<p>b.5) 下面设置环境变量：打开 <code>~/.bashrc</code> 文件，并加入这一行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:~/Downloads/jmol-14.20.2:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ul>
<li>等号=前后没有空格, 后面紧跟着<code>$PATH</code>；</li>
<li>再往后是一个冒号，冒号前后也不能有空格，填上Jmol的解压目录！！！</li>
</ul>
<p>b.6) 保存<code>.bashrc</code> 文件并<code>source</code>一下:   <code>.  ~/.bashrc</code>  （注意前面的 <code>.</code> ）或者使用命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span>  ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>c） 进入其他目录，运行 <strong>Jmol</strong> 命令：下图中<code>~/Destkop/freq</code> 目录下有我们关于乙醇频率的计算结果。</p>
<p><img src="/2017/12/16/ex25/ex25-12.jpeg" alt=""></p>
<p>大功告成！！！</p>
<p>此外，<code>sudo apt-get install jmol</code>这样安装的是<strong>旧版本</strong>，强烈不建议，原因如下：</p>
<p><strong>可能图片有些模糊，但不重要！旧版本的不支持 OUTCAR…安了也是白搞！！！</strong></p>
<p><img src="/2017/12/16/ex25/ex25-13.jpeg" alt=""></p>
<hr>
<h2 id="2-使用Jmol可视化分子振动"><a href="#2-使用Jmol可视化分子振动" class="headerlink" title="2 使用Jmol可视化分子振动"></a>2 使用Jmol可视化分子振动</h2><h3 id="2-1-载入振动文件到-Jmol"><a href="#2-1-载入振动文件到-Jmol" class="headerlink" title="2.1 载入振动文件到 Jmol"></a>2.1 载入振动文件到 Jmol</h3><p><code>Windows</code>：直接将频率计算得到的<code>OUTCAR</code>拖到<code>jmol.bat</code>就可以了</p>
<p><code>Linux</code>：直接 <code>jmol 文件名</code></p>
<p>两个系统下面均可使用左上角的 文件à打开à选择<code>OUTCAR</code>导入。</p>
<p>得到如下界面。但是分子并没有开始振动，只是显示了其结构。</p>
<p><img src="/2017/12/16/ex25/ex25-14.jpeg" alt=""></p>
<p>（该结构和<code>ChemSpider</code>上的一样！）</p>
<p>要查看振动模型，需要以下两步，<strong>选中振动模型</strong>和<strong>开启振动</strong>。这两步有多种方法可以实现，总结如下。</p>
<hr>
<h3 id="2-2-选择振动模型"><a href="#2-2-选择振动模型" class="headerlink" title="2.2 选择振动模型"></a>2.2 选择振动模型</h3><p>A）可以在工具—&gt;原子库选择器中选中要查看的振动模型</p>
<p><img src="/2017/12/16/ex25/ex25-15.jpeg" alt=""></p>
<p><strong>注意，先把右边的按钮拉倒底，然后双击Frequencies展开频率信息，</strong> 如下:</p>
<p><img src="/2017/12/16/ex25/ex25-16.jpeg" alt=""></p>
<p>B) 也可以直接右键—&gt;模型中选中</p>
<p><img src="/2017/12/16/ex25/ex25-17.jpeg" alt=""></p>
<hr>
<h3 id="2-3-开启振动"><a href="#2-3-开启振动" class="headerlink" title="2.3 开启振动"></a>2.3 开启振动</h3><p>A) 原子库选择器中<strong>最下方</strong>: <strong>振动—&gt;振动开</strong> 可实现， 点击后，原子就开始振动了。</p>
<p><img src="/2017/12/16/ex25/ex25-18.jpeg" alt=""></p>
<p><img src="/2017/12/16/ex25/ex25-19.jpeg" alt=""></p>
<p>B) 在<strong>菜单栏—&gt;工具—&gt;震动</strong> 中开启（原子库选择器选中时采用这种方式，需要先开启再选中）</p>
<p><img src="/2017/12/16/ex25/ex25-20.jpeg" alt=""></p>
<p>C) 也可以<strong>右键 —&gt; 振动 —&gt; 开启</strong></p>
<p><img src="/2017/12/16/ex25/ex25-21.jpeg" alt=""></p>
<hr>
<h3 id="2-4-查看不同振动"><a href="#2-4-查看不同振动" class="headerlink" title="2.4 查看不同振动"></a>2.4 查看不同振动</h3><p>A) 原子集选择器中的频率列表，双击其中的一个就显示其振动方式了。</p>
<p><img src="/2017/12/16/ex25/ex25-22.jpeg" alt=""></p>
<p>B) 要查看下一个振动还可以通过点击向右的这个箭头就可以了。</p>
<p><img src="/2017/12/16/ex25/ex25-23.jpeg" alt=""></p>
<p>以上就是本节关于 <strong>Jmol</strong> 可视化的介绍了，更多信息，请查看 <strong>Jmol</strong> 的<code>wiki</code>：<br><a target="_blank" rel="noopener" href="http://wiki.jmol.org/index.php/Main_Page">http://wiki.jmol.org/index.php/Main_Page</a></p>
<h2 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h2><p>3.1 熟练掌握 <strong>Jmol</strong> 的软件安装，查看频率的基本操作。</p>
<p>3.2 通过在<code>Linux</code>系统下面安装 <strong>Jmol</strong>，尝试着安装其他软件；</p>
<p>3.3 分析各项频率值对应的分子或者原子的移动。</p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><p>本节主要介绍给大家一款除了 <strong>p4vasp</strong> 之外的另一款 <strong>VASP</strong> 可视化的软件，不仅仅局限在频率振动分析方面，查看<code>POSCAR</code>，<code>CONTCAR</code>也可以直接使用 <strong>Jmol</strong> 打开。该软件由连赞小朋友推荐，并编辑文中大部分内容，在此表示衷心的感谢。希望大家都可以熟练掌握这款软件。<code>Linux</code>下面可以直接用命令： <code>jmol 文件名</code>，打开查看结构，非常方便。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/15/ex23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/15/ex23/" class="post-title-link" itemprop="url">Ex23 乙醇分子的振动频率计算(一)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-15 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-15T02:06:48-05:00">2017-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/15/ex23/" class="post-meta-item leancloud_visitors" data-flag-title="Ex23 乙醇分子的振动频率计算(一)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/15/ex23/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/15/ex23/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/2017/12/15/ex23/ex23-0.jpeg" alt=""></p>
<p>大师兄在本节开头放上这张图片的意思是，请大家再仔细体会<code>Rubbish in， Rubbish out</code>这句话，只有对我们要研究的体系有一定的理解，明白我们具体要计算什么内容，设置好输入文件的参数，才能得到我们需要的合理结果。接下来的几节会涉及到分子的振动频率计算，振动频率的可视化等内容，请大家跟着大师兄一起练习，掌握振动频率的基本计算和分析方法。</p>
<hr>
<h2 id="1-分子的振动"><a href="#1-分子的振动" class="headerlink" title="1 分子的振动"></a>1 分子的振动</h2><p>我们首先看回顾一下振动相关的基本知识，这里大师兄不具体解释，引用 $9$ 版 $Atkins$ 的《物理化学》书中的内容，书已上传至<strong>QQ群文件</strong>中，也可百度网盘下载: <a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1o8HlyOi">http://pan.baidu.com/s/1o8HlyOi</a>  全是英文，大家耐心阅读下。</p>
<hr>
<p>简谐振子、胡克定律、体系势能随着振动距离 $x$ 的关系</p>
<p><img src="/2017/12/15/ex23/ex23-1.jpeg" alt=""></p>
<p>简谐振动的薛定谔方程描述:</p>
<p><img src="/2017/12/15/ex23/ex23-2.jpeg" alt=""></p>
<p><img src="/2017/12/15/ex23/ex23-3.jpeg" alt=""></p>
<p>薛定谔方程的解：振动的量子化，振动频率</p>
<p><img src="/2017/12/15/ex23/ex23-4.jpeg" alt=""></p>
<p><img src="/2017/12/15/ex23/ex23-5.jpeg" alt=""></p>
<p>零点能的数学和物理两个方面的解释:</p>
<p><img src="/2017/12/15/ex23/ex23-6.jpeg" alt=""></p>
<hr>
<h2 id="2-频率计算的作用"><a href="#2-频率计算的作用" class="headerlink" title="2 频率计算的作用"></a>2 频率计算的作用</h2><p><strong>频率计算有什么用？为什么要算频率?</strong> 大师兄稍微总结了一下频率计算的意义，大体有以下几个方面，没有提到的用处，烦请大家指出来，以便补充。</p>
<p>2.1 确定结构是否稳定;</p>
<p>2.2 看振动方式和大小，用来和实验对比，棋博士最新的文章就是一个非常好的例子;</p>
<p>2.3 反应热，反应能垒，吸附能等的零点能矫正;</p>
<p>2.4  确认过渡态(有一个振动的虚频)</p>
<p>2.5 热力学中计算<code>entropy</code>，用于计算化学势，微观动力学中的指前因子和反应能垒。</p>
<hr>
<h2 id="3-怎么用VASP计算频率"><a href="#3-怎么用VASP计算频率" class="headerlink" title="3  怎么用VASP计算频率?"></a>3  怎么用VASP计算频率?</h2><p>3.1首先进行结构优化，获取稳定的构型，这个我们前面已经讲过了;</p>
<p>3.2 将原来的<code>CONTCAR</code>复制成<code>POSCAR</code> :<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp CONTCAR  POSCAR</span><br></pre></td></tr></table></figure></p>
<p>3.3 修改<code>INCAR</code></p>
<p><img src="/2017/12/15/ex23/ex23-7.jpeg" alt=""></p>
<p>修改后如下:  </p>
<p><img src="/2017/12/15/ex23/ex23-8.jpeg" alt=""></p>
<p>频率计算的<code>INCAR</code></p>
<ul>
<li><p><code>IBRION</code>的值改成<code>5</code></p>
</li>
<li><p><code>POTIM</code>用一个更小的值，我们这里用的 <code>0.02</code>，默认值是 <code>0.015</code></p>
</li>
<li><p><code>NSW</code> 设置成1，这个可以直接不管，继续采用优化时的<code>NSW</code>值，因为你设置成 <code>1， 2， 3， 4， 5， …， 1000</code> 都不会影响计算；但不能不设置（因为默认值是<code>0</code>，这时算个单点后任务便停止了。）</p>
</li>
<li><p><code>NFREE=2</code> 添加这一个参数，表明原子在某一方向上正反两个方向移动；</p>
</li>
<li><p><code>NCORE=4</code>这一项要注释掉！大师兄这边的服务器，并行计算频率时 VASP 会罢工，只进行一步静态计算，注释掉就正常进行了；</p>
</li>
<li><p>此外，<code>EDIFF</code>也要设置一个严格的值（频率计算时，默认值为<code>1E-6</code>，足够了！下一节会讲到）</p>
</li>
</ul>
<p>小结一下频率分析关键的参数:</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IBRION=5</span><br><span class="line">NFREE=2</span><br><span class="line">POTIM=0.02</span><br></pre></td></tr></table></figure></h2><h2 id="4-扩展练习"><a href="#4-扩展练习" class="headerlink" title="4 扩展练习"></a>4 扩展练习</h2><p>4.1 按照本节的流程新建一个文件夹 <code>freq</code> : 该文件夹中包含乙醇分子优化后的结构 (将<code>CONTCAR</code>复制成<code>POSCAR</code>)，以及优化时的<code>POTCAR</code>，<code>INCAR</code>， <code>KPOINTS</code>以及提交命令的脚本文件;</p>
<p>4.2 修改乙醇分子优化的<code>INCAR</code>为频率计算的<code>INCAR</code>；需要修改哪些参数心里要清楚；</p>
<p>4.3 运行乙醇分子频率计算，并查看频率分析的<code>OUTCAR</code>，<code>OSZICAR</code>等输出文件；</p>
<p>4.4 查看 <strong>VASP</strong> 官网对于<code>IBRION=5</code> 的解释，搜索网上相关频率计算的文章，帖子，初步了解<code>NFREE</code>，<code>POTIM</code>所代表的含义；</p>
<p><a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/IBRION">https://cms.mpi.univie.ac.at/wiki/index.php/IBRION</a></p>
<p>4.5 查找官网中频率计算的例子:</p>
<p>A) <a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/CO_vibration">https://cms.mpi.univie.ac.at/wiki/index.php/CO_vibration</a></p>
<p>B) <a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/H2O_vibration">https://cms.mpi.univie.ac.at/wiki/index.php/H2O_vibration</a></p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结:"></a>5 总结:</h2><p>5.1 熟悉频率计算初始文件的准备过程；</p>
<p>5.2 频率计算<code>INCAR</code>中的三个重要参数；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IBRION = 5</span><br><span class="line">NFREE = 2</span><br><span class="line">POTIM = 0.02</span><br></pre></td></tr></table></figure>
<p>5.3 初步了解频率计算中各个参数的含义。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/15/ex24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/15/ex24/" class="post-title-link" itemprop="url">Ex24 乙醇分子的振动频率计算(二)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-15 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-15T02:06:48-05:00">2017-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/15/ex24/" class="post-meta-item leancloud_visitors" data-flag-title="Ex24 乙醇分子的振动频率计算(二)" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/15/ex24/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/15/ex24/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>按照前面一节介绍的方法，结构优化过程完毕后，准备频率计算的输入文件，提交任务等待结束。然后我们介绍一下频率计算的输出与POSCAR原子的固定。</p>
<h2 id="1-查看结果"><a href="#1-查看结果" class="headerlink" title="1 查看结果"></a>1 查看结果</h2><h3 id="1-1-查看OSZICAR，你会发现一共计算了55步。"><a href="#1-1-查看OSZICAR，你会发现一共计算了55步。" class="headerlink" title="1.1 查看OSZICAR，你会发现一共计算了55步。"></a>1.1 查看OSZICAR，你会发现一共计算了55步。</h3><p><img src="/2017/12/15/ex24/ex24-1.jpeg" alt=""></p>
<p>下面我们分析一下这$55$步是怎么回事：</p>
<p>A）乙醇分子$\rm{CH<em>{3}CH</em>{2}OH}$ 含有 $9$ 个原子，每个原子在 $x, y, z$三个方向上均有一个自由度，共 $9 \times 3 = 27$ 个</p>
<p>B）我们设置的<code>NFREE=2</code> ，也就是在每个方向上 <code>+POTIM</code> 和 <code>–POTIM</code>都移动并算一下，这样就有了 $27 \times 2 = 54$ 步：官网原文如下：大家自己去查阅<code>IBRION</code>和<code>NFREE</code>的相关内容。</p>
<blockquote>
<p>The parameter NFREEdetermines how many displacements are used for each direction and ion, andPOTIM determines the step size. The step size is defaulted to 0.015 ? (startingfrom VASP.5.1), if too large values are supplied in the input file. Expertiseshows that this is a very reasonable compromise.`</p>
<p>NFREE=2 usescentral differences, i.e., each ion is displaced by a small positive andnegative displacement, ±POTIM, along each of the cartesian directions.`</p>
</blockquote>
<p>C）还有一步：$55  -54 = 1$, 这一步指的是第一个离子步，为频率计算前的单点计算。</p>
<p>所以当你设置了<code>NFREE=2</code>的时候，频率计算需要 $1+N \times 6$ 步。$N$ 为体系中的振动的原子数。</p>
<h2 id="2-固定原子"><a href="#2-固定原子" class="headerlink" title="2 固定原子"></a>2 固定原子</h2><p>默认的是所有的原子在$x, y, z$三个方向上均可移动。但很多时候，我们只需要振动感兴趣的原子或者某一特定的方向就可以了，也就是说选择性计算频率。比如我们只想算乙醇的羟基振动峰，那么其他的原子就可以固定。VASP可以通过设置POSCAR来实现这个功能？首先我们看一下当前的<code>POSCAR</code>：</p>
<p><img src="/2017/12/15/ex24/ex24-2.jpeg" alt=""></p>
<p>左下角的<code>:set nu</code>  显示文本的行数，取消行数可以通过 <code>:set nonu</code></p>
<hr>
<p>如果想要选择性地固定某些原子，我们需要以下几个步骤：</p>
<p>1） 在第七行和第8行之间插入一行，内容为 <code>Selective Dynamics</code> ，前面讲过 <strong>VASP</strong> 只认第一个字母，也就是<code>S</code>是必须的，<code>Selective Dynamics</code> 和 <code>See</code>, <code>Sea</code>….等其他<code>S</code>开头的都是一个效果的。</p>
<p>2）  加入<code>Selective</code>之后，我们需要在每一行的坐标后面加上 <code>T</code> 或者<code>F</code>表示允许和禁止移动。这里我们需要加三个<code>T</code>或者<code>F</code>，表示在 $x, y, z$ 三个方向上选择性固定原子的移动，</p>
<p>三个方向都允许：<code>T T T</code></p>
<p>三个方向上都不允许: <code>F F F</code>  </p>
<p>$x$ 移动，$y$ 和 $z$ 方向上固定为： <code>T F F</code></p>
<p>$x$ 和 $y$ 方向上固定，$z$ 方向振动： <code>F F T</code></p>
<p>以此类推，其他的大家根据自己的情况固定。</p>
<hr>
<p>师兄，那么我们要做的就是在<code>POSCAR</code>中逐行写上<code>T T T</code>或者<code>F F F</code>就行了吧? </p>
<p>是的，下面大师兄教给你的是通过 <strong>Vim</strong> 的命令或者 <strong>p4vasp</strong> 实现这个功能。</p>
<hr>
<h3 id="2-1-通过-Vim-实现原子的固定和选择"><a href="#2-1-通过-Vim-实现原子的固定和选择" class="headerlink" title="2.1 通过 Vim 实现原子的固定和选择"></a>2.1 通过 <strong>Vim</strong> 实现原子的固定和选择</h3><p><strong>第一步</strong>：加入 <code>Select</code> 的关键字母<code>S</code>，并在坐标后面全部加上 <code>T T T</code></p>
<p><img src="/2017/12/15/ex24/ex24-3.jpeg" alt=""></p>
<p>图中<code>箭头1</code>：插入一行，告诉 <strong>VASP</strong> 我们要选择性的固定某些原子或者在某些方向上；</p>
<p>图中<code>方块2</code> <code>:10,18s</code>  中 <code>s</code> 代表替换（<code>substitute</code>）的意思，这里表示我们选中了第 $10$ 到 $18$ 行，$10$ 和 $18$ 之间有个逗号表示连续；<code>10,18s</code>后面用一个 <code>/</code> 分开，紧跟着你我们要替换的内容；</p>
<p><code>$</code> 在这里是末尾的意思，<code>$/T T T</code>我们要把每一行的最后替换成 <code>T T T</code></p>
<p>后面再用一个<code>/</code>分开，加上<code>g</code> 表示 global 全部替换的意思。</p>
<p>输入完毕后，回车，效果如下：</p>
<p><img src="/2017/12/15/ex24/ex24-4.jpeg" alt=""></p>
<p>每一行的末尾都加入了 <code>T T T</code>  箭头指的地方告诉我们：$9$ 行中的 $9$ 个地方发生了替换。</p>
<p>（自己复习下<code>sed</code>的用法，比较两者的区别）</p>
<hr>
<p><strong>第二步</strong>，下面我们要把OH之外的原子全部固定住：</p>
<p>通过 <strong>p4vasp</strong> 我们可以知道，OH 的两个原子为第一个（O）和最后一个（H），因此我们把第 $11$ 行到 $17$ 行中的所有<code>T</code>替换成<code>F</code>就可以了。我们可以使用 <code>:11,17s/T/F/g</code>来实现。最后效果如下：</p>
<p><img src="/2017/12/15/ex24/ex24-5.jpeg" alt=""></p>
<p>C）扩展：</p>
<p>如果所有的原子后面为： <code>T T T</code>，这与我们之前的计算效果是一样的（第 $8$ 行没有<code>S</code>，坐标后面没有<code>T T T</code>）。此外，固定之前要先找到哪些原子我们希望固定的，以及它们在坐标中的顺序。</p>
<hr>
<h3 id="2-2-使用p4vasp实现上述功能"><a href="#2-2-使用p4vasp实现上述功能" class="headerlink" title="2.2 使用p4vasp实现上述功能:"></a>2.2 使用p4vasp实现上述功能:</h3><p>基于 <strong>p4vasp</strong> 的可视化特性，直接用鼠标操作是很多<code>linux</code> 小白最喜欢看到的，下面我们主要讲解一下 <strong>p4vasp</strong> 的操作，请务必将 <strong>Vim</strong> 和 <strong>p4vasp</strong> 的操作关联起来，这样你会就会发现可视化和命令之间的微妙关系了。</p>
<h4 id="1）-打开p4vasp，导入POSCAR；"><a href="#1）-打开p4vasp，导入POSCAR；" class="headerlink" title="1） 打开p4vasp，导入POSCAR；"></a>1） 打开p4vasp，导入<code>POSCAR</code>；</h4><p><img src="/2017/12/15/ex24/ex24-6.jpeg" alt=""></p>
<p><code>System</code> 显示 ethanol 说明数据已导入。</p>
<h4 id="2）-鼠标系列操作"><a href="#2）-鼠标系列操作" class="headerlink" title="2）   鼠标系列操作"></a>2）   鼠标系列操作</h4><p>A）点一下 <code>Show</code> 按钮，显示乙醇分子结构；</p>
<p>B）  点击<code>Build</code>按钮：显示分子的坐标信息：这里的坐标顺序和<code>POSCAR</code>完全一致：</p>
<p><img src="/2017/12/15/ex24/ex24-7.jpeg" alt=""></p>
<p>C）  选择乙醇的羟基（使用空格键选择原子），下图中可以知道 O 和 H 在坐标顺序中为第一个和最后一个；</p>
<p><img src="/2017/12/15/ex24/ex24-8.jpeg" alt=""></p>
<p>D）选中右上角的<code>Selective Dynamics</code>，效果如图中箭头2指出来的部分，这个动作和我们之前在第八行插入<code>Selective Dynamics</code> 以及在坐标每一行加入<code>T T T</code>是等效的</p>
<p><img src="/2017/12/15/ex24/ex24-9.jpeg" alt=""></p>
<p>E）选中第二行坐标，摁住shift键，然后再点一下倒数第二行，选中整个区域后，点击右上方的 <code>Unselect</code> ， 这个动作等效于我们将 $11$ 到 $17$ 行中的<code>T</code>全部替换为<code>F</code>。</p>
<p><img src="/2017/12/15/ex24/ex24-10.jpeg" alt=""></p>
<p>F）操作完成后，左上角： <code>File --&gt; Save System As</code> 保存新的<code>POSCAR</code>即可。</p>
<hr>
<h2 id="4-扩展练习："><a href="#4-扩展练习：" class="headerlink" title="4 扩展练习："></a>4 扩展练习：</h2><p>4.1 掌握本节的两个<code>POSCAR</code>处理方法；</p>
<p>4.2 学会计算频率分析所需的步数；</p>
<p>4.3 浏览<code>OUTCAR</code>，查找频率输出结果</p>
<h2 id="5-总结："><a href="#5-总结：" class="headerlink" title="5 总结："></a>5 总结：</h2><p>通过对比手动敲命令修改<code>POSCAR</code>和使用 <strong>p4vasp</strong> 进行鼠标操作，这里大师兄希望大家能掌握以下三点：</p>
<p>1） 学会 <strong>Vim</strong> 的使用技巧，当然了，<strong>Vim</strong> 及其强大，完全掌握基本不可能，但最基本的操作要了解；</p>
<p>2） <strong>p4vasp</strong> 的操作要熟悉，不知道怎么操作的，导入一个计算文件，随便点点，找找感觉；</p>
<p>3） 在使用 <strong>p4vasp</strong> 的操作中，你要学会思考：怎么将鼠标操作转化为命令语言来实现，为将来写脚本做好准备，毕竟很多时候，我们用不了可视化界面，就只能手动修改格式了，结合命令，比可视化操作更快，还可以批量进行。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/14/ex22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/14/ex22/" class="post-title-link" itemprop="url">Ex22 乙醇气相分子的优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-14 02:06:48" itemprop="dateCreated datePublished" datetime="2017-12-14T02:06:48-05:00">2017-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/14/ex22/" class="post-meta-item leancloud_visitors" data-flag-title="Ex22 乙醇气相分子的优化" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/14/ex22/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/14/ex22/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面我们终于讲完了 $\rm{O_2}$ 分子优化的例子。相信大家对 <strong>VASP</strong> 计算已经有了一个初步的理解。这一节我们继续学习气相分子的优化。为了让大家进一步了解计算的过程，我们选取一个稍微复杂的分子作为例子：乙醇（$\rm{CH_3CH_2OH}$）。</p>
<hr>
<p>问：把大象装进冰箱需要几步？</p>
<p><img src="/2017/12/14/ex22/ex22-1.jpeg" alt=""></p>
<p>大师兄，这个问题我早就知道答案了。为啥还问这样低智商的问题？</p>
<p>大师兄要求的不是让你回答开冰箱门，装进去，关门的这三步。而是让你尝试回想一下：当你第一次接触这个问题的时候，你的反应是什么？</p>
<p>大师兄比较笨，我的第一反应是，这怎么可能？  冰箱那么点，大象那么大。</p>
<p><img src="/2017/12/14/ex22/ex22-2.jpeg" alt=""></p>
<p>当朋友告诉我答案的时候，才恍然大悟，这跟大小没关系。</p>
<p><img src="/2017/12/14/ex22/ex22-3.jpeg" alt=""></p>
<hr>
<p>同样的，怎么用 <strong>VASP</strong> 计算乙醇分子？很多童鞋就如同第一次被问到大象这个问题一样不知所措。答，也是三步！</p>
<p>1） 打开冰箱：准备 <strong>VASP</strong> 文件</p>
<p>2） 把大象塞进去：准备乙醇分子模型</p>
<p>3）关上冰箱：运行 <strong>VASP</strong></p>
<h2 id="1-打开冰箱："><a href="#1-打开冰箱：" class="headerlink" title="1. 打开冰箱："></a>1. 打开冰箱：</h2><p>我们可以直接用O$_2$分子计算的输入文件，</p>
<h3 id="1-1-复习一下前面学到的INCAR和KPOINTS的内容："><a href="#1-1-复习一下前面学到的INCAR和KPOINTS的内容：" class="headerlink" title="1.1 复习一下前面学到的INCAR和KPOINTS的内容："></a>1.1 复习一下前面学到的<code>INCAR</code>和<code>KPOINTS</code>的内容：</h3><p>1）乙醇分子是闭壳层的分子，没有磁性，不需要<code>ISPIN=2</code></p>
<p>2）气相分子计算，我们要用<code>ISMEAR=0</code>，<code>SIGMA</code>取值要小，<code>SIGMA=0.02</code>；</p>
<p><img src="/2017/12/14/ex22/ex22-4.jpeg" alt=""></p>
<p> <strong>#</strong> 表示注释，这个符号后面的内容，VASP在运行的时候不考虑。</p>
<hr>
<p><strong>示例 1 ：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENCUT = 400</span><br><span class="line"><span class="comment"># ENCUT = 500</span></span><br></pre></td></tr></table></figure><br>和<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENCUT = 400</span><br></pre></td></tr></table></figure><br>效果是一样的。</p>
<hr>
<p><strong>示例 2：# 的用法：</strong></p>
<p><img src="/2017/12/14/ex22/ex22-5.jpeg" alt=""></p>
<p><strong>VASP</strong> 计算中一些常见的错误，以及注意事项，你可以通过 # 写在<code>INCAR</code>里面，方便计算的时候进行设置。可以 # 开头，单起一行，也可以在参数的最后面加上注释。新手们刚刚开始，可以结合 <strong>VASP</strong> 官网参考书，把用到的INCAR参数注释下来，时间长了慢慢就掌握了。</p>
<p>3）气相分子计算，<code>K</code>点使用<code>Gamma</code>点就够了；</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">K-POINTS</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="built_in">Gamma</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">1</span> </span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> </span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-把大象塞到冰箱里面-POSCAR的准备（本节重点）"><a href="#2-把大象塞到冰箱里面-POSCAR的准备（本节重点）" class="headerlink" title="2 把大象塞到冰箱里面 :POSCAR的准备（本节重点）"></a>2 把大象塞到冰箱里面 :POSCAR的准备（本节重点）</h2><p>前面我们学习到，一个好的初始结构会加快计算，获取准确的计算结果。因此我们需要去找一个合理的模型。对于气相分子的结构，一是手动搭建，大师兄推荐用 <code>GaussView</code>，另一个办法就是找数据库，大师兄推荐英国皇家学会的 <strong>ChemScpider</strong>。网址：<a target="_blank" rel="noopener" href="http://www.chemspider.com">http://www.chemspider.com</a> </p>
<p><img src="/2017/12/14/ex22/ex22-7.jpeg" alt=""></p>
<p>下面我们把手动搭建乙醇分子的模型具体解释一下：</p>
<h3 id="2-1-打开网站"><a href="#2-1-打开网站" class="headerlink" title="2.1 打开网站"></a>2.1 打开网站</h3><p><img src="/2017/12/14/ex22/ex22-8.jpeg" alt=""></p>
<p>搜索框中输入： 分子名称<code>Ethanol</code> 或者 分子式<code>C2H6O</code>…. 点击搜索，等待结果：</p>
<p><img src="/2017/12/14/ex22/ex22-9.jpeg" alt=""></p>
<p>上面箭头指的两个地方随便点，效果是一样的，如下：</p>
<p><img src="/2017/12/14/ex22/ex22-10.jpeg" alt=""></p>
<p>分子默认显示 <code>2D</code> 的结构，点击箭头指的 <code>3D</code>，切换。第二个箭头所指的有对应结构的维基百科链接，翻墙的筒子们可以查阅下相关结构的知识。选择<code>3D</code>后，如下：</p>
<p><img src="/2017/12/14/ex22/ex22-11.jpeg" alt=""></p>
<p>点击箭头指的地方保存，浏览器会下载对应的 .mol 文件，文件名为该结构在数据库中的编号。</p>
<hr>
<p><code>.mol</code>文件也是纯文本，使用<code>Notepad++</code> 打开如下：看到这么多内容，不要害怕！</p>
<p><img src="/2017/12/14/ex22/ex22-12.jpeg" alt=""></p>
<p><strong>注： 不仅仅是 <code>.mol</code> 文件，很多结构文件都是文本格式，直接打开就是。</strong></p>
<p>从里面找到乙醇结构的 $x, y, z$ 坐标信息</p>
<p><img src="/2017/12/14/ex22/ex22-13.jpeg" alt=""></p>
<p>删除上图中除红色框之外的所有行，1-4行，以及 14 至最后一行，只保留 $x, y, z$ 坐标信息的那几行。</p>
<p><img src="/2017/12/14/ex22/ex22-14.jpeg" alt=""></p>
<p>手动写<code>POSCAR</code>，首先你要熟记的格式，知道<code>POSCAR</code>从头开始，往下每一行代表的内容。</p>
<p>我们的模型是把乙醇分子放到一个 $ 20 \times 20 \times 20~A^3 $ 的格子里面。输入完之后，坐标后面的元素符号以及那些 $0$ $0$ $0$ 可以删掉，也可以不管。</p>
<p><img src="/2017/12/14/ex22/ex22-15.jpeg" alt=""></p>
<p><strong>关键点1： .mol文件中，坐标那几行中的第 4 列写到<code>POSCAR</code>中的第 6, 7行！</strong></p>
<p><strong>关键点2： 注意坐标为 <code>Cartesian</code> 或者是 <code>Direct</code>. <code>Direct</code> 是分数坐标，其 $x, y, z$ 值都小于 1.</strong></p>
<hr>
<p>如果你想删掉图中坐标第3列后面的内容：大师兄推荐notepad++里面的列块模式：如下：</p>
<p><img src="/2017/12/14/ex22/ex22-16.jpeg" alt=""></p>
<p>点击之后，可能会弹出对话框，告诉你如何使用，列块模式</p>
<p><img src="/2017/12/14/ex22/ex22-17.jpeg" alt=""></p>
<hr>
<p><strong>方法1：</strong></p>
<p> 摁住 <code>Alt</code> 键，然后用鼠标选择文本，不同电脑可能不一样，大师兄这边同时摁住 <code>Ctrl</code> 和 <code>Alt</code> 两个键，然后用鼠标选择的。</p>
<hr>
<p><strong>方法2：</strong></p>
<p>同时摁住 <code>Alt</code>和<code>Shift</code>键，通过键盘上前后左右的箭头选择文本</p>
<p>大家可以尝试下，选中效果如图：</p>
<p><img src="/2017/12/14/ex22/ex22-18.jpeg" alt=""></p>
<p>然后点键盘上的<code>Delete</code>键删除.</p>
<p><img src="/2017/12/14/ex22/ex22-19.jpeg" alt=""></p>
<p>然后另存为<code>POSCAR</code>即可。</p>
<hr>
<p>我们可以使用 <strong>p4vasp</strong> 来查看一下模型的结构：如下图</p>
<p><img src="/2017/12/14/ex22/ex22-20.jpeg" alt=""></p>
<p>我靠，师兄，结构怎么跑到格子外面啦？前面 $\rm{O_2}$ 分子的学习中，你已经知道了这是因为周期性导致的显示问题。对计算不会产生影响。这个结构可以拿来直接用。</p>
<p>如果感觉不爽，想把结构放到中间，可以这么做：</p>
<p>数学上，把 $x, y, z$ 坐标<strong>统统加上 $10$ 即可</strong>；</p>
<p>软件使用上，我们讲一下 <strong>p4vasp</strong> 的操作方法：</p>
<p><img src="/2017/12/14/ex22/ex22-21.jpeg" alt=""></p>
<p>选择 <code>edit</code> –&gt; <code>Move atoms</code></p>
<p><img src="/2017/12/14/ex22/ex22-22.jpeg" alt=""></p>
<p><code>Move group</code> 是你要移动的原子，这里大师兄直接输入了 C H O 三个元素符号（中间有空格）表示选择所有元素的原子。然后在 <code>Vector</code> 中选择 $x, y, z$ 三个方向上移动的大小。你也可以写 $1$ $1$ $1$，然后点击 <code>Move</code> 按钮 $10$ 次。</p>
<p>如果你想通过选择原子来实现移动的话(不直接在 <code>Move group</code> 里面输入 C H O)，需要按照大师兄说的步骤走：</p>
<p><img src="/2017/12/14/ex22/ex22-23.jpeg" alt=""></p>
<p>1) 空格键结合鼠标选中所有的原子；鼠标指到原子上就点一下空格键</p>
<p>2) 选中原子后，主界面会显示一些数字，这些数字和 <code>POSCAR</code> 中元素的顺序是一致的；</p>
<p>3) 所有原子选中后，左下角的框中点击 <code>Get group</code>，会显示选择的那些原子；</p>
<p>4) 在 <code>Vector</code> 中选择 $x, y, z$ 三个方向上移动的大小，然后点击 <code>Move</code> 按钮。</p>
<p>上面一堆废话就此打住，结果就是这样子的：</p>
<p><img src="/2017/12/14/ex22/ex22-24.jpeg" alt=""></p>
<p>然后点击 file -&gt; Save system as -&gt; 选择目录 -&gt; 保存成<code>POSCAR</code></p>
<hr>
<h4 id="POTCAR"><a href="#POTCAR" class="headerlink" title="POTCAR"></a>POTCAR</h4><p><strong>POSCAR</strong> 讲完了，我们就要按照里面的元素顺序制备<code>POTCAR</code>了。</p>
<p>首先: 我们要准备 O C H 三个元素的<code>POTCAR</code>，去<code>POTCAR</code>的数据库中去找：</p>
<p>然后复制到当前目录下，三个元素的<code>POTCAR</code>分别命名为：<code>POTCAR-O</code>, <code>POTCAR-C</code>和 <code>POTCAR-H</code>， 把三个元素的<code>POTCAR</code>合并在一起，命令就是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat POTCAR-O POTCAR-C POTCAR-H &gt;&gt; POTCAR</span><br></pre></td></tr></table></figure>
<h2 id="3-提交任务"><a href="#3-提交任务" class="headerlink" title="3 提交任务"></a>3 提交任务</h2><p>提交任务之前，需要再次检查自己的输入文件一遍，没有问题，提交直至结束。</p>
<h2 id="4-扩展练习："><a href="#4-扩展练习：" class="headerlink" title="4 扩展练习："></a>4 扩展练习：</h2><p>4.1 从头到尾，认真重复本节中大师兄的操作；</p>
<p>4.2 记住本节讲解的内容，自己重复一遍操作，直至自己通过文本编辑器会搭建结构模型；</p>
<p>4.3 运行乙醇计算的例子；</p>
<p>4.4 尝试使用 <strong>GaussView</strong>，<strong>Materials Studio (MS)</strong>，以及其他可视化界面搭建模型；</p>
<p>4.5 学会使用 <strong>VESTA</strong> 导出<code>POTCAR</code>格式的结构数据。</p>
<h2 id="5-总结："><a href="#5-总结：" class="headerlink" title="5 总结："></a>5 总结：</h2><p>本节，我们主要讨论了一下分子模型的数据库搜索和搭建工作。希望大家能够完全掌握本节的所有内容和细节。在计算中，你会遇到各种各样的结构文件，其实都是$xyz$坐标的衍生物而已。不要害怕，直接打开它们，学会提取里面有价值的信息。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/11/ex19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/11/ex19/" class="post-title-link" itemprop="url">Ex19 谁偷走的我的机时？（四）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-11 15:30:16" itemprop="dateCreated datePublished" datetime="2017-12-11T15:30:16-05:00">2017-12-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/11/ex19/" class="post-meta-item leancloud_visitors" data-flag-title="Ex19 谁偷走的我的机时？（四）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/11/ex19/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/11/ex19/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="模型对计算时间的影响"><a href="#模型对计算时间的影响" class="headerlink" title="模型对计算时间的影响"></a>模型对计算时间的影响</h3><hr>
<p>上一节介绍的KPOINTS对计算的影响，相信大家已经认真阅读参考书的第三章部分了。本季我们讨论一下模型的大小对计算的影响。主要体现在晶胞的尺寸，对称性以及对K点的影响上。</p>
<hr>
<h3 id="1-测试工作："><a href="#1-测试工作：" class="headerlink" title="1 测试工作："></a>1 测试工作：</h3><p> 为了方便处理，我们把O$_2$计算的格子设置为长宽高均为8.0 $\AA$。</p>
<p><img src="/2017/12/11/ex19/ex19-1.jpeg" alt=""><br>重复之前KPOINTS的批处理操作，我们可以获得一系列不同大小格子的文件夹。如下图：<br><img src="/2017/12/11/ex19/ex19-2.jpeg" alt=""></p>
<p>命令：  <code>for i in $(seq 10 2 20); do cp 8 $i; sed –i &quot;3,5s/8.0/$i/g&quot; $i/POSCAR ;done</code></p>
<hr>
<h3 id="2-测试结果分析"><a href="#2-测试结果分析" class="headerlink" title="2 测试结果分析"></a>2 测试结果分析</h3><h3 id="2-1-模型大小对计算时间的影响"><a href="#2-1-模型大小对计算时间的影响" class="headerlink" title="2.1 模型大小对计算时间的影响"></a>2.1 模型大小对计算时间的影响</h3><p><img src="/2017/12/11/ex19/ex19-3.jpeg" alt=""></p>
<p>注意：在后面加入 <code>sort –n</code> 后输出的变化。</p>
<hr>
<p><img src="/2017/12/11/ex19/ex19-4.jpeg" alt=""></p>
<p><img src="/2017/12/11/ex19/ex19-5.jpeg" alt=""></p>
<p>从图中可以看出来，计算时间随着格子的大小，需要的计算时间增加的很快。</p>
<p>注意：在测试中，KPOINTS一直保持不变（因为只有一个Gamma点）。而在我们实际的计算操作中，使用1x1x1 KPOINTS的机会并不多。如果格子在某个方向增加了2倍，那么对应的改方向的K点就需要除以2。重复一下上节的经验指导。也就是在计算过程中，保持k<em>a保持不变。当然，k</em>a是我们提前测试好的。</p>
<p><img src="/2017/12/11/ex19/ex19-6.jpeg" alt=""></p>
<p>举例：</p>
<p>一个<code>10x10x10</code> $\AA^3$的体相材料，我们计算的时候K点设置为：<code>6x6x6</code>。</p>
<p>当我们将材料在x方向增加1倍，变为<code>20x10x10</code>  $\AA^3$。为保持一致的精确度，那么我们的K点需要设置为：<code>3x6x6</code>。</p>
<hr>
<p>这是因为倒易晶格矢量和实际的晶格矢量之间存在着倒数的关系：</p>
<p><img src="/2017/12/11/ex19/ex19-7.jpeg" alt=""></p>
<p>注： 类似的图，不加说明，均出自我们的参考书。也就是说，我们选取的晶格越大，倒易晶格矢量越小。用同等数目的K点分布到倒易晶格中，网格的密度也会越大，从而造成计算量的增加。</p>
<hr>
<h4 id="2-2-体系的对称性对计算速度的影响："><a href="#2-2-体系的对称性对计算速度的影响：" class="headerlink" title="2.2 体系的对称性对计算速度的影响："></a>2.2 体系的对称性对计算速度的影响：</h4><h5 id="2-2-1-K点保持不变："><a href="#2-2-1-K点保持不变：" class="headerlink" title="2.2.1 K点保持不变："></a>2.2.1 K点保持不变：</h5><p>这一点前面关于氧原子的计算就已经介绍到了，降低体系的对称性会增加额外的计算时间。如图：将<code>12x12x12</code> $\AA^3$ （计算需要186.86 s）的格子修改如下：</p>
<p><img src="/2017/12/11/ex19/ex19-8.jpeg" alt=""></p>
<p>计算结束后，查看时间，为194.9 s, 计算时间增加了8秒。</p>
<p><img src="/2017/12/11/ex19/ex19-9.jpeg" alt=""></p>
<h4 id="2-2-2-对称性对K点的影响："><a href="#2-2-2-对称性对K点的影响：" class="headerlink" title="2.2.2 对称性对K点的影响："></a>2.2.2 对称性对K点的影响：</h4><p>体系的对称性不仅仅提现在前面的计算中，更可以在计算中极大地减少K点的数目，从而加快计算，节省时间。这一点我们引用参考书中的一段话：</p>
<p><img src="/2017/12/11/ex19/ex19-10.jpeg" alt=""></p>
<h5 id="2-3-3-模型对称性与K点对称性的关系"><a href="#2-3-3-模型对称性与K点对称性的关系" class="headerlink" title="2.3.3 模型对称性与K点对称性的关系"></a>2.3.3 模型对称性与K点对称性的关系</h5><p>在这里，体系的对称性与K点对称性的匹配问题，尤其是对于hexagonal的结构来说，必须要使用 gamma centered points. 也就是第三行的第一个字母必须为G或者g。我们看一下官网的原话：</p>
<blockquote>
<p>We strongly recommend to use only Gamma centered grids forhexagonal lattices. Many tests we have performed indicate that the energy convergessignificantly faster with centered grids than with standard Monkhorst Pack grids. Grids generated with the “M” setting in the third line, in fact do not have full hexagonal symmerty.</p>
</blockquote>
<p>如果你不确定自己的体系，直接用G就可以了。</p>
<blockquote>
<p>For reasons of safety it might be a good choice to use only meshes with theirorigin at (switch “G” or “g” on third line or odd divisions) if the tetrahedron method is used.</p>
</blockquote>
<h3 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h3><p> 1 认真阅读： Density Functional Theory: A Practical Introduction: 第三章的前两节；</p>
<p>2 VASP官网查找K点相关的说明。</p>
<h3 id="4-总结："><a href="#4-总结：" class="headerlink" title="4 总结："></a>4 总结：</h3><p> 学习完本节，大家应该掌握的内容有： </p>
<p>4.1 晶格大小对计算时间的影响；</p>
<p>4.2 体系的对称性对计算时间的影响；</p>
<p>4.3 掌握K点和晶格大小的经验规则；</p>
<p>4.4 晶格对称性和K点对称性的一致性。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/11/ex20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/11/ex20/" class="post-title-link" itemprop="url">Ex20 谁偷走的我的机时？（五）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-11 15:30:16" itemprop="dateCreated datePublished" datetime="2017-12-11T15:30:16-05:00">2017-12-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/11/ex20/" class="post-meta-item leancloud_visitors" data-flag-title="Ex20 谁偷走的我的机时？（五）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/11/ex20/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/11/ex20/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="并行"><a href="#并行" class="headerlink" title="并行"></a>并行</h3><hr>
<p>前面几节讨论的都是一些涉及到模型以及计算细节对时间的影响。本节我们讨论一下服务器节点设置（并行）的影响。从字面上不难理解，并行就是多个节点同时计算同一个任务。好比之前用一匹马拉车，现在改用两匹，三匹或者更多的马拉同一辆车。一匹马拉车的时候，对马的要求是足够强壮，能拉得动还要跑得快。但你想跑的更快，就需要驾驭两匹或者多匹马，但这个时候对于驾驶马车的你就需要提出技术要求了：如何控制马儿之间的节奏。控制好了，并驾齐驱，得儿驾得儿驾，爽歪歪。控制不好结构，你跑你的，我跑我的，整体下来，马儿也累，马车行驶的反而更慢了，搞不好还会栽跟头。</p>
<hr>
<p>同样的道理，如果想加快计算速度，或者在最短的时间内获取最多的计算数据，我们就需要知道并行在计算中的作用。首先我们先测试一下，不同节点同时运行O$_2$分子计算所需要的时间。注意：本练习讨论的是多个节点下的并行！</p>
<hr>
<h3 id="1-测试活动："><a href="#1-测试活动：" class="headerlink" title="1 测试活动："></a>1 测试活动：</h3><p>为了观测更加明显，我们使用<code>8x8x8</code> $\AA^3$的格子，K点使用<code>3x3x3</code>， <code>ENCUT = 400</code> 。</p>
<p><img src="/2017/12/11/ex20/ex20-1.jpeg" alt=""></p>
<p>测试的服务器每个节点有4个核，每个核有两个进程。</p>
<p>文件夹用核数命名，4,8,12,16 分别代表使用了1,2,3,4个节点进行计算。</p>
<p>在这里，每个节点可以看成1匹马，4个核可以看作马的四条腿。每个核的两个进程可以看做每条腿的上下两部分。</p>
<hr>
<h4 id="1-1-设置计算的节点数目"><a href="#1-1-设置计算的节点数目" class="headerlink" title="1.1 设置计算的节点数目"></a>1.1 设置计算的节点数目</h4><p>使用多少个节点进行计算，在提交任务的脚本里面设置。每个课题组可能不太一样，也有通过命令设置的，不过都大同小异。大师兄晒一晒自己组里提交命令的脚本，如果和你们的不一样，不要纠结：</p>
<p><img src="/2017/12/11/ex20/ex20-2.jpeg" alt=""></p>
<p>这个任务的脚本里面，我们使用32个核（32条腿），也就是8个节点（8匹马）同时计算。提交所有的测试任务后，等待结束。</p>
<h3 id="2-测试结果分析："><a href="#2-测试结果分析：" class="headerlink" title="2  测试结果分析："></a>2  测试结果分析：</h3><h4 id="2-1-提取结果"><a href="#2-1-提取结果" class="headerlink" title="2.1 提取结果"></a>2.1 提取结果</h4><p><img src="/2017/12/11/ex20/ex20-3.jpeg" alt=""></p>
<p><code>for i in *; do echo -e $i &quot;\t&quot; $(grep Elapsed $i/OUTCAR  | awk &#39;&#123;print $4&#125;&#39;); done</code></p>
<p>这里复习上一节： <code>sort –n</code> 命令的用法，将数列从小到大排列。</p>
<p>注意：这里我们没有用之前的<code>User time</code>提取时间, 而是用的<code>Elapsed time</code>。这一项是计算真正花费的时间。所有的时间里面：<code>Total CPU time = User Time + System time</code>，一般来说， Elapsed time 总会比 Total CPU time 多上那么几秒。</p>
<p><code>User time</code> 和 <code>System time</code> 是干嘛的？怎么的出来的？大师兄也不知道具体的含义。希望知道的童鞋们给大师兄上上课。之前几节中，用<code>User time</code>的分析结果可靠吗？ 没问题的，大师兄检查了一下，前面的<code>System time</code>均为 2s左右，<code>Elapsed Time</code> 中绝大部分由<code>User time</code>来贡献。</p>
<hr>
<h4 id="2-2-作图分析"><a href="#2-2-作图分析" class="headerlink" title="2.2 作图分析"></a>2.2 作图分析</h4><p><img src="/2017/12/11/ex20/ex20-4.jpeg" alt=""></p>
<p>核数的单位为 个 ， 对应图中的拼音 ge（个数）</p>
<p>1  从4核到8核，计算时间并没有减少，反而增加了15s</p>
<p>2  从4核到12核，计算时间也仅仅减少了20s</p>
<p>3  从12核以后，增加核数，计算时间反而增加了。</p>
<p>从12核开始，增加的核数白白占了你的任务，缺丝毫没有提高计算速度。因此，增加核数反而成了计算的负担。这是因为并行计算的时候，不同核之间的数据传输浪费了大量的计算时间。这好比是你多安排了几匹马来拉车，但马儿们却彼此交流，各跑各的，不愿意拉车了。</p>
<hr>
<h4 id="2-3-既然是这样，VASP并行还有个卵用？"><a href="#2-3-既然是这样，VASP并行还有个卵用？" class="headerlink" title="2.3 既然是这样，VASP并行还有个卵用？"></a>2.3 既然是这样，VASP并行还有个卵用？</h4><p>答：并行是有用的，只不过我们需要调教这些不听话的马儿们，让他们服从我们的命令。这里我们就会需要一些其他的参数，NCORE和NPAR。 </p>
<p>NCORE：控制多少个核同时计算；<br>NPAR：如何把计算任务分配到计算资源上面计算。</p>
<p>它们之间的关系是：NCORE= 计算使用的核数 / NPAR</p>
<p>注意：这两个参数只能选取一个来使用:</p>
<hr>
<p>测试数据结果（给喜欢看表格的人准备的）</p>
<p><img src="/2017/12/11/ex20/ex20-5.jpeg" alt=""></p>
<p><img src="/2017/12/11/ex20/ex20-6.jpeg" alt=""></p>
<p>图中红色部分为前面计算的结果，</p>
<ul>
<li>蓝色为NCORE=4的结果（测试的服务器每个节点有4个核，所有的计算军用NCORE=4）；</li>
<li>绿色为NPAR=4的结果（所有的计算中均用的NPAR=4）；</li>
<li>黄色为NPAR=Core/4的结果，</li>
</ul>
<p>根据NPAR和NCORE的关系，该设置与NCORE=4等同，但是实际测试中蓝色和黄色为什么没有完全一样，我也说不清楚。</p>
<hr>
<p>1）使用NCORE以后，单节点运行也加快了；（单匹马儿被你调教的更听话了）</p>
<p>2）加入NCORE和NPAR参数后，计算时间明显提高了。在20核以后的计算中尤为明显；</p>
<p>3）如果你想用多个节点计算，NCORE或者NPAR，不要忘了加（二者选其一）。</p>
<p>４）可以肯定的是：NPAR和NCORE的乘积就是我们计算所用的核数，这一点大家要记在心里。</p>
<p>5) 在本测试中（这是前提！！），增加节点个数并未实现 1+1 = 2 的效果，1+N = 2 的效果也没有实现。但在多个节点的计算中，加入NCORE或者NPAR，节点数越多，效果越明显。</p>
<p>手册上解释说NPAR，或者NCORE的取值可以为总核数的开方值。很多人对此会有疑虑，大师兄的建议是：</p>
<ul>
<li><p><strong>测试，测试，测试!….</strong>测试一下自己的体系这是主要的，不要完全相信本测试的结果，体系不同，结果可能会差很多！！；</p>
</li>
<li><p>NPAR的取值可以设置为节点的数目，（默认值为计算的核数！）</p>
</li>
<li><p>NPAR实在不懂的话，直接设置NCORE=单节点的核数，单节点的核数/2，单节点的核数/4…….</p>
</li>
<li><p>个人使用经验是：NCORE = 单个节点核数 / 2 的时候，运行最省时间，设置也最方便。</p>
</li>
</ul>
<h3 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h3><p>1 阅读VASP官网关于NCORE，NPAR的内容；</p>
<p>2 对于自己的计算体系，测试这两个参数；</p>
<p>3 总结前面关于计算时间的影响因素</p>
<hr>
<h3 id="4-总结："><a href="#4-总结：" class="headerlink" title="4 总结："></a>4 总结：</h3><p>关于VASP计算时间的影响，我们暂且告一段落了，希望大家能在前面几节的学习中熟练掌握影响计算时间的这些因素，在实际的计算过程中合理把握，提高计算效率，节约机时。浪费的机时不仅仅属于你自己，也属于组里其他人的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/10/ex18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/10/ex18/" class="post-title-link" itemprop="url">Ex18 谁偷走的我的机时？（三）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-10 15:30:16" itemprop="dateCreated datePublished" datetime="2017-12-10T15:30:16-05:00">2017-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/10/ex18/" class="post-meta-item leancloud_visitors" data-flag-title="Ex18 谁偷走的我的机时？（三）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/10/ex18/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/10/ex18/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="KPOINTS对计算时间的影响"><a href="#KPOINTS对计算时间的影响" class="headerlink" title="KPOINTS对计算时间的影响"></a>KPOINTS对计算时间的影响</h3><hr>
<p>继续前面的学习，本节讨论<code>KPOINTS</code>文件中K点的设置对计算时间的影响。本节图中的Linux命令不再详细介绍，大师兄默认大家已经基本掌握了其中的原理和窍门。VASP官网上还有其他的批量测试的脚本，大家现在也可以差不多能看懂了。比如Si计算的例子：<a target="_blank" rel="noopener" href="https://cms.mpi.univie.ac.at/wiki/index.php/Fcc_Si">https://cms.mpi.univie.ac.at/wiki/index.php/Fcc_Si</a> </p>
<hr>
<h3 id="1-KPOINTS测试"><a href="#1-KPOINTS测试" class="headerlink" title="1 KPOINTS测试"></a>1 KPOINTS测试</h3><h4 id="1-1-准备测试模板"><a href="#1-1-准备测试模板" class="headerlink" title="1.1 准备测试模板"></a>1.1 准备测试模板</h4><p>新建文件夹: 3，将之前的文件夹0复制过来后重命名为 1。</p>
<h4 id="1-2-批量制备测试文件："><a href="#1-2-批量制备测试文件：" class="headerlink" title="1.2 批量制备测试文件："></a>1.2 批量制备测试文件：</h4><p><img src="/2017/12/10/ex18/ex18-1.jpeg" alt=""></p>
<p>命令： <code>for i in &#123;2..6&#125;; do cp 1 $i ; sed -i&quot;s/1 1 1/$i $i $i/g&quot; $i/KPOINTS ; done</code></p>
<p>文件夹1 代表KPOINTS为<code>1 1 1</code> ,6 代表KPOINTS为 <code>6 6 6</code>  其他的类推。</p>
<hr>
<h4 id="1-3-批量提交任务："><a href="#1-3-批量提交任务：" class="headerlink" title="1.3 批量提交任务："></a>1.3 批量提交任务：</h4><p><img src="/2017/12/10/ex18/ex18-2.jpeg" alt=""></p>
<p>备注：这里的qsuball 命令是把前面的批量命令放到 .bashrc 文件中了。不懂的请看Ex17的批量操作命令和Ex13中.bashrc文件中alias的使用方法。</p>
<hr>
<h3 id="2-测试结果分析"><a href="#2-测试结果分析" class="headerlink" title="2 测试结果分析"></a>2 测试结果分析</h3><h4 id="2-1-查看OUTCAR-中的K点信息"><a href="#2-1-查看OUTCAR-中的K点信息" class="headerlink" title="2.1 查看OUTCAR 中的K点信息"></a>2.1 查看OUTCAR 中的K点信息</h4><p><img src="/2017/12/10/ex18/ex18-3.jpeg" alt=""></p>
<p>图中，我们找出可以通过grep 查询的字符：irreducible  </p>
<hr>
<h4 id="2-2-批量查看所有测试的K点信息："><a href="#2-2-批量查看所有测试的K点信息：" class="headerlink" title="2.2 批量查看所有测试的K点信息："></a>2.2 批量查看所有测试的K点信息：</h4><p><img src="/2017/12/10/ex18/ex18-4.jpeg" alt=""></p>
<p><strong>命令 <code>grep irreducible 3/OUTCAR</code></strong></p>
<p>从图中可以看出：</p>
<p>1）K点<code>2 2 2</code> 和<code>3 3 3</code> 的计算中，生成的K点数目是一样的；类似地，<code>4 4 4</code> 和<code>5 5 5</code> 具有同样地K点数目；</p>
<p>2）不难理解，相同的K点数目，其计算时间也是一样的；</p>
<p>3）计算时间随K点数目的增加也增加了。</p>
<hr>
<p>师兄，为什么K点数目会存在奇数和偶数相同的关系？</p>
<p>原因在于K点生成的方法。当KPOINTS为偶数的时候，K点都在布里渊区的内部，而为奇数的时候，部分K点处在布里渊区的边界上。引用参考书中的一个表格和一段话：第三章第56-57页：</p>
<p><img src="/2017/12/10/ex18/ex18-5.jpeg" alt=""></p>
<p><img src="/2017/12/10/ex18/ex18-6.jpeg" alt=""></p>
<hr>
<h4 id="2-3-不同K点对能量的影响："><a href="#2-3-不同K点对能量的影响：" class="headerlink" title="2.3 不同K点对能量的影响："></a>2.3 不同K点对能量的影响：</h4><p><img src="/2017/12/10/ex18/ex18-7.jpeg" alt=""><br>先不画图了，直接看能量吧：</p>
<p>当K点为 <code>1 1 1</code> 和 <code>6 6 6</code> 的时候，O$_2$分子的能量差别为： 0.0015 eV。可以忽略不计。在这里，你可以清晰地知道：为什么算气相分子的时候 gamma点（1x1x1）足够了。</p>
<p>对于其他slab或者体相材料的计算，K点怎么选择呢？我们看下面这一段话：<br><img src="/2017/12/10/ex18/ex18-8.jpeg" alt=""></p>
<p>出处： <a target="_blank" rel="noopener" href="https://wiki.fysik.dtu.dk/gpaw/exercises/surface/surface.html">https://wiki.fysik.dtu.dk/gpaw/exercises/surface/surface.html</a></p>
<hr>
<p>再参考一下Quantumwise 网站的说明：<br><img src="/2017/12/10/ex18/ex18-9.jpeg" alt=""><br>出处：<a target="_blank" rel="noopener" href="http://quantumwise.com/forum/index.php?topic=2628.0">http://quantumwise.com/forum/index.php?topic=2628.0</a></p>
<p>再次强调一下：浏览网站说明的时候，要养成这样的一种习惯，凡是看到Note这个单次，就要跟打了鸡血一般！前面的东西看不懂不要紧，Note后面跟的都是重点易出错的地方。</p>
<hr>
<p>以上只是经验参数的说明，给我们提供一个大体的指导。这个参数在使用中，要注意我们前面提到的奇数和偶数的情况。而具体到我们的计算中，需要用什么数值，我们需要认真地测试检查一下，而不能直接就用图中的经验参数。</p>
<p>1）通过测试不同K点对体系能量的变化；（参考书中的例子）<br><img src="/2017/12/10/ex18/ex18-10.jpeg" alt=""></p>
<hr>
<p>2）查找参考文献的取值；</p>
<hr>
<p>3）此外，不同K点之间的数据不能混用。比如计算CO在一个 (3x3) Cu(111)表面上的吸附能：</p>
<script type="math/tex; mode=display">
E_{ads} = E_{CO + slab} – E_{slab} – E_{CO^{gas}}</script><p>等号后面的前两项，必须要用同一个K点下计算出来的能量，如果$E{CO+slab}$ 用<code>5x5x1</code> 的K点， E(slab) 采用 <code>3x3x1</code>的K点能量，得出的结果必然是错的。</p>
<hr>
<h3 id="2-4-来自VASP官方的提醒："><a href="#2-4-来自VASP官方的提醒：" class="headerlink" title="2.4 来自VASP官方的提醒："></a>2.4 来自VASP官方的提醒：</h3><p><img src="/2017/12/10/ex18/ex18-11.jpeg" alt=""></p>
<p>出处： <a target="_blank" rel="noopener" href="https://www.vasp.at/vasp-workshop/slides/accuracy.pdf">https://www.vasp.at/vasp-workshop/slides/accuracy.pdf</a></p>
<p>1）常见错误（一）： 体系中ENCUT的取值不统一；</p>
<p>2）常见错误（二）：采用不同KPOINTS计算出来的结果。</p>
<p>3）在关于Accuracy的这个pdf文件中，最后一行大家要谨记：TEST，TEST，TEST ….</p>
<hr>
<h3 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h3><p>1 下载大师兄分享的压缩文件： 本节中所有的pdf文件和链接；大师兄QQ群文件下载，或者百度网盘：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1eSCGWeA">http://pan.baidu.com/s/1eSCGWeA</a></p>
<p>2 阅读参考书中第三章的内容，掌握K点的基本概念和一些选取的注意事项；</p>
<p>3 浏览本节中所有的网址。</p>
<hr>
<h3 id="4-总结："><a href="#4-总结：" class="headerlink" title="4 总结："></a>4 总结：</h3><p>1 K点数目越多，计算越准确，需要的时间也会相应地越多，大家要把握好准确度和时间的关系；</p>
<p>2 K点的确定，需要经验和测试相结合，经验为辅，测试为主。</p>
<hr>
<h2 id="5-补充："><a href="#5-补充：" class="headerlink" title="5 补充："></a>5 补充：</h2><p> VASP的新版本中，可以直接在INCAR中设置K点。也就是说，没有KPOINTS文件也可以正常计算，但这可能只适用于简单的K点情况，能带结算等需要制定K点路径的计算，我们还是需要KPOINTS文件的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/09/ex17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/09/ex17/" class="post-title-link" itemprop="url">Ex17 谁偷走的我的机时？（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-09 15:30:16" itemprop="dateCreated datePublished" datetime="2017-12-09T15:30:16-05:00">2017-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/09/ex17/" class="post-meta-item leancloud_visitors" data-flag-title="Ex17 谁偷走的我的机时？（二）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/09/ex17/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/09/ex17/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这一节和后面几节，我们会复习一下前面学到的Linux批量操作知识，然后对一些影响计算时间的参数进行测试。 本节主要考虑<code>ENCUT</code>的影响。前面我们一直在说<code>EDIFF</code>和<code>EDIFFG</code>对计算时间的影响。为了给大家一个感性的认识，现在我们用O$_2$分子的计算作为测试例子，将结果展示出来。这两个参数主要是在计算精度上影响计算时间，很容易想到，精度越高，收敛的越慢，需要的时间对应的也会更长。</p>
<hr>
<h3 id="1-调节EDIFF和EDIFFG"><a href="#1-调节EDIFF和EDIFFG" class="headerlink" title="1 调节EDIFF和EDIFFG"></a>1 调节EDIFF和EDIFFG</h3><p><img src="/2017/12/09/ex17/ex17-1.jpeg" alt=""></p>
<p>左侧为之前计算的INCAR，右侧为提高精度后的INCAR。O$_2$的初始距离设置的为1.207$\AA$。提交计算，等待任务结束。前面我们知道VASP计算完成后，OUTCAR最后输出的是计算时间，内存等信息。我们现在查看一下：文件夹 0 对应的是之前的O$_2$计算，文件夹1 中是提高精度后的计算。</p>
<p><img src="/2017/12/09/ex17/ex17-2.jpeg" alt=""></p>
<p><strong>注意：</strong>grep User OUTCAR 后得出的结果被空格分成了4部分，时间信息在第4部分里面。User（1） time（2） （sec：）（3） 44.20 （4）</p>
<hr>
<p>讲解：</p>
<p>1.1）通过<code>tail OUTCAR</code> 这个命令，可以找到用grep命令查看时间的关键词：User 或者 Elapsed，这里我们采用User 后面的时间作为参考；</p>
<p>1.2）右下方黄色图框中的时间表面：提高了精度后，计算时间从44秒增加到78秒。</p>
<p>1.3）我们看一下，改变精度后体系的能量变化：</p>
<p><img src="/2017/12/09/ex17/ex17-3.jpeg" alt=""></p>
<p>从-9.8609降低到-9.8611，变化大小为： -0.0002 eV。 这么小的能量变化，我们可以认为忽略不计。</p>
<p>在这里，我们要认真思考收敛标准对于我们计算体系能量的影响，选取一个合适的标准而又不会浪费太多的机时。一般来说，结构优化的时候，<code>EDIFF=1E-5</code>, <code>EDIFFG =-0.01</code>至 <code>-0.03</code> 都是被认可的。</p>
<hr>
<h3 id="2-ENCUT-测试："><a href="#2-ENCUT-测试：" class="headerlink" title="2 ENCUT 测试："></a>2 ENCUT 测试：</h3><h4 id="2-1-制备ENCUT测试模板"><a href="#2-1-制备ENCUT测试模板" class="headerlink" title="2.1 制备ENCUT测试模板"></a>2.1 制备ENCUT测试模板</h4><p><img src="/2017/12/09/ex17/ex17-4.jpeg" alt=""></p>
<p>解释：  </p>
<p>2.1.1）新建测试目录 2 ，进入后，将前面的文件夹0复制过来，文件夹名为 400</p>
<p>2.1.2）使用sed命令，在INCAR中最后一行加入ENCUT参数，值设置为400</p>
<hr>
<h4 id="2-2-快速制作测试任务"><a href="#2-2-快速制作测试任务" class="headerlink" title="2.2 快速制作测试任务"></a>2.2 快速制作测试任务</h4><p><img src="/2017/12/09/ex17/ex17-5.jpeg" alt=""></p>
<p>图中的命令行为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in &#123;1..8&#125;; do cp 400 $((400+$i*50)); sed -i &quot;s/400/$((400+$i*50))/g&quot;  $((400+$i*50))/INCAR ; done</span><br></pre></td></tr></table></figure>
<p>复习前面学到的linux操作：</p>
<p>2.2.1）明白<code>&#123;1..8&#125;</code> 是怎么回事；</p>
<p>2.2.2） <code>$i</code> 变量的调用；</p>
<p>2.2.3）新学：<code>$((加减乘除))</code>，注意数学运算用2个括号 括起来；</p>
<p>2.2.4）sed 命令进行文本中某一项的替换；</p>
<p>2.2.5）运行完毕后，会获得一系列<code>ENCUT</code>值的文件夹，且每个里面INCAR已经对应地设置完毕。</p>
<hr>
<h4 id="2-3-批量提交任务"><a href="#2-3-批量提交任务" class="headerlink" title="2.3 批量提交任务"></a>2.3 批量提交任务</h4><p><img src="/2017/12/09/ex17/ex17-6.jpeg" alt=""><br>命令：<br><code>for i in *; do cd $i ; qsub sub4; cd $OLDPWD; done</code></p>
<p>讲解：</p>
<p>2.3.1）do后面执行的是，进入for循环中的文件夹，然后提交任务，（大师兄提交任务的命令是 qsub sub4， qsub 是命令，sub4是脚本名），任务提交后，返回原来的目录下（<code>cd $OLDPWD</code>），然后再进入下一个for循环中的文件夹，重复之前的操作，直至遍历所有for循环的变量文件夹；</p>
<p>2.3.2）图中的Single是任务的说明，这个在提交任务的脚本里面自己随意设置：<br><img src="/2017/12/09/ex17/ex17-7.jpeg" alt=""></p>
<hr>
<h4 id="2-4-批量查看结果的命令："><a href="#2-4-批量查看结果的命令：" class="headerlink" title="2.4 批量查看结果的命令："></a>2.4 批量查看结果的命令：</h4><p><img src="/2017/12/09/ex17/ex17-8.jpeg" alt=""></p>
<p>此处需要注意 * 的用法</p>
<p>我们只需要图中方框标出来的信息，其他的结果可以直接扔掉。为简化输出结果，这里大师兄用了另外一个强大的命令： awk</p>
<p><code>for i in *0; do echo -e  $i &quot;\t&quot; $(grep User $i/OUTCAR | awk &#39;&#123;print $4&#125;&#39;); done</code></p>
<p>2.4.1）  学会echo 命令：</p>
<p>2.4.2）  echo –e 后面加上”\t”后（双引号），可以直接输出 tab，方便导入excel；</p>
<p>2.4.3）  本例中，awk 后面用<code>&#123;&#125;</code>将打印的内容括起来；</p>
<p>2.4.4）  <code>print $4</code> 意思是输出前面结果的第4项；</p>
<p>2.4.5）  awk命令极其强大，强烈建议大家尝试着去网上查找资料，主动去学习；</p>
<p>2.4.6）将结果复制到excel里面作图。</p>
<h4 id="2-5-计算时间随着ENCUT增加的变化曲线"><a href="#2-5-计算时间随着ENCUT增加的变化曲线" class="headerlink" title="2.5 计算时间随着ENCUT增加的变化曲线"></a>2.5 计算时间随着ENCUT增加的变化曲线</h4><p><img src="/2017/12/09/ex17/ex17-10.jpeg" alt=""></p>
<p>从图中可以看出，<strong>计算时间随着ENCUT的增加也相应地增加了</strong>。因此，在保证计算准确度和ENCUT的值的选取，你要学会合理取值，加快自己的计算速度。此外，图表的比较形象直观，大家在今后的学习中，多多思考将自己的数据转化为图表的形式！可以很好的表达自己的计算结果。</p>
<p>设想一下，同学A和B把同样的数据结果给老师看，A单纯把数据列到表格里面，B做成了上图的形式，老师会喜欢谁？此外，我们也可以通过写一个简单的python脚本来实现作图的功能。</p>
<hr>
<h4 id="2-6-作图的-Python-脚本："><a href="#2-6-作图的-Python-脚本：" class="headerlink" title="2.6 作图的 Python 脚本："></a>2.6 作图的 Python 脚本：</h4><h5 id="2-6-1-获取数据，并保存成文件"><a href="#2-6-1-获取数据，并保存成文件" class="headerlink" title="2.6.1 获取数据，并保存成文件"></a>2.6.1 获取数据，并保存成文件</h5><p><img src="/2017/12/09/ex17/ex17-11.jpeg" alt=""></p>
<p>注意echo $i 后面的逗号，输出的文件 data.dat 中，逗号用于将两列数据分开。</p>
<p>2.6.1.1）图中圈出来的部分中， &gt; 代表将前面命令的输出保存到 data.dat 文件中；</p>
<p>2.6.1.2） data.dat 后缀可以随便写，<code>data.txt</code>， <code>data.out</code>, <code>data.export</code>, 也可以不写：<code>data</code> 。 因为输出后的都是文本格式，直接可以编辑打开。</p>
<p>2.6.1.3） 查看一下保存的数据结果</p>
<p><img src="/2017/12/09/ex17/ex17-12.jpeg" alt=""></p>
<h5 id="2-6-2-作图-脚本，-名为-plt-py"><a href="#2-6-2-作图-脚本，-名为-plt-py" class="headerlink" title="2.6.2 作图 脚本， 名为 plt.py"></a>2.6.2 作图 脚本， 名为 plt.py</h5><p>vim打开后，内容如下图：</p>
<p><img src="/2017/12/09/ex17/ex17-13.jpeg" alt=""></p>
<p>python程序学习参考书：<strong> learn python the hard way</strong>（免费），网上还有很多学习资料，这里就不介绍了。python读取data.dat 文件，根据 delimiter 后面的参数（此处为逗号）将数据分成若干列。</p>
<hr>
<h5 id="2-6-3-运行脚本：（python-plt-py）"><a href="#2-6-3-运行脚本：（python-plt-py）" class="headerlink" title="2.6.3 运行脚本：（python plt.py）"></a>2.6.3 运行脚本：（python plt.py）</h5><p><img src="/2017/12/09/ex17/ex17-14.jpeg" alt=""></p>
<h4 id="2-7-体系的能量随ENCUT的变化："><a href="#2-7-体系的能量随ENCUT的变化：" class="headerlink" title="2.7 体系的能量随ENCUT的变化："></a>2.7 体系的能量随ENCUT的变化：</h4><p><img src="/2017/12/09/ex17/ex17-15.jpeg" alt=""></p>
<p>获取图上结果的命令行：</p>
<p><code>for i in *0; do echo -e  $i &quot;\t&quot; $(grep User $i/OUTCAR | awk&#39;&#123;print $4&#125;&#39;) &quot;\t&quot; $(grep &#39; without&#39; $i/OUTCAR | tail -n 1 | awk &#39;&#123;print $4&#125;&#39;); done</code></p>
<p>作图过程如下：</p>
<h5 id="2-7-1-生成数据："><a href="#2-7-1-生成数据：" class="headerlink" title="2.7.1 生成数据："></a>2.7.1 生成数据：</h5><p><img src="/2017/12/09/ex17/ex17-16.jpeg" alt=""></p>
<p>前面的命令中， “\t” 改为 逗号，  done 后面 加上 &gt; data.dat， 重新运行一遍。 </p>
<h5 id="2-7-2-修改脚本如下："><a href="#2-7-2-修改脚本如下：" class="headerlink" title="2.7.2 修改脚本如下："></a>2.7.2 修改脚本如下：</h5><p><img src="/2017/12/09/ex17/ex17-17.jpeg" alt=""></p>
<p>增加了 一列（z）</p>
<hr>
<p>2.7.3 选择合适的画图区间：</p>
<p><img src="/2017/12/09/ex17/ex17-18.jpeg" alt=""></p>
<p>图中蓝色的O$_2$分子的能量随ENCUT值增加的变化，为一直线！</p>
<hr>
<p>大师兄问：结果对不对？</p>
<p>答：结果是对的，但不具有任何的合理性。</p>
<p>因为它不能体现出能量变化的趋势：因为 y 轴的取值范围太大了，而我们能量的变化又太小。这也是很多人在做模拟的时候容易犯的错误，看到一个直线，或者平滑的曲线，就如同哥伦布发现了新大陆一番。其实则不然，很多时候，真相往往被我们的粗糙的观测范围给掩盖了。</p>
<p>这个称之为作图骗人的一个Trick！很多人在发文章的时候将这一技巧运用的如火纯情。所以，当你看文献的时候，如果发现别人的结果也是一条直线或者平滑曲线，第一直觉是去看坐标轴的范围，而不是感觉别人的工作是多么地牛逼。</p>
<p>重新作图，这次只用ENCUT和O$_2$分子的能量，如下图：</p>
<p><img src="/2017/12/09/ex17/ex17-19.jpeg" alt=""></p>
<p>能量一直在降低， 结果对不对呢？对的，但变化却被过度放大了！</p>
<hr>
<p>很多新手看到这个图以为能量降低的很快，感觉自己的计算不收敛，因此还要继续往下做或者测试。其实则不然，在这里，我们还是需要主要 y 轴的取值范围。图中整个y轴的变化为0.016 eV。每两个点之间的变化仅仅为0.002 eV。这个变化我们也是可以接受的，虽然图中感觉下降的很厉害的样子。</p>
<p>上面两个图中，走了两个极端，一个极大，一个极小。所以，在我们处理数据时，一定要仔细观察坐标轴的取值范围。</p>
<hr>
<h4 id="2-8-小结一下："><a href="#2-8-小结一下：" class="headerlink" title="2.8 小结一下："></a>2.8 小结一下：</h4><p>但从数据上可以看出来，O$_2$分子的能量随着ENCUT值的增加还是会有些少许的波动。比如，从400到800 eV，能量降低了0.01 eV。大师兄，那我们该取哪个ENCUT值呢？</p>
<p>首先，我们要明确几个要点：</p>
<p>2.8.1）ENCUT值越大，计算的越精确，花费的时间也就越多；</p>
<p>2.8.2）ENCUT的取值仅仅通过一个例子的测试来确定，这是不对的；</p>
<ul>
<li>A)   在VASP的计算中，单个结构的能量所具有的意义不大，也就是说相对能量最重要！</li>
<li>B)   为什么A）中说相对能量最重要：这是因为：没有对比，就没有伤害！设想一下，你把一个O$_2$的能量算的再精确或者能量再低，而不去使用它，它也就是个数字而已，不具有任何的物理化学意义。</li>
<li>C)  B)中要表达的意思是，算出来的数值必须要应用到我们的物理化学概念中，也就是物理化学的概念体现在这些能量的使用过程中，也就是相对能量里面：比如，O$_2$的结合能， O$_2$的吸附能；某一化学反应的能量，反应能垒，表面能，功函数等等，无一不是多个能量的数学运算所的出来的。</li>
<li>D)   O$_2$的结合能示例：</li>
</ul>
<p>公式： EB = E(O$_2$) –2E(O)</p>
<p>O$_2$的结合能随着ENCUT值增加的变化情况：</p>
<p><img src="/2017/12/09/ex17/ex17-20.jpeg" alt=""></p>
<p>第一、二、三、四列分别为ENCUT，O原子能量，O$_2$分子能量和O$_2$分子中O的结合能。从图中，我们可以分析出来，ENCUT在450 eV时，O$_2$的结合能和ENCUT为800 eV的时候差别很小，因此我们可以选取450 eV进行计算。</p>
<p>注： O原子不同ENCUT的单点能，自己根据前面的过程，补充计算。</p>
<hr>
<p>2.8.3）ENCUT的取值与体系中所有的元素有关；</p>
<ul>
<li>A）体系中含有不同元素的时候，查看这些元素POTCAR中的ENMAX值，找出最大的那个；</li>
<li>B）ENCUT的最小值为所有元素中ENMAX的最大值！</li>
<li>C）也就是说，找到最大的ENMAX（max）， ENCUT值大于等于ENMAX（max）。</li>
</ul>
<p><img src="/2017/12/09/ex17/ex17-21.jpeg" alt=""></p>
<p>示例图中，<br>potcar.sh 为生成POTCAR的脚本，可在本书的附录中获取。ENCUT 的取值至少为 400 eV。</p>
<hr>
<p>2.8.4） ENCUT的值，也要查阅相关的参考文献进行确定。你的计算体系大家都用400 eV，你也可以设置该值或者稍微高一些。ENCUT很多人在刚开始做计算的时候，都会测试一个数值。如果不想测试，查找参考文献其实是一个很好的办法。</p>
<hr>
<h3 id="3-扩展练习："><a href="#3-扩展练习：" class="headerlink" title="3 扩展练习："></a>3 扩展练习：</h3><p>3.1 复习前面学到的批量操作方式；</p>
<p>3.2 熟练运用前面的操作，并理解命令的工作原理；</p>
<p>3.3 改变KPOINTS的大小，查看计算时间，能量的变化；</p>
<h3 id="4-总结："><a href="#4-总结：" class="headerlink" title="4 总结："></a>4 总结：</h3><p>1 EDIFF和EDIFFG对计算的影响通过实例强调了一次；</p>
<p>2 ENCUT 测试的操作流程；</p>
<p>3 ENCUT对计算时间和能量的影响结果分析；</p>
<p>4 通过excel 和python作图的两个方法；</p>
<p>5 能量和计算时间随ENCUT的变化；</p>
<p>6 看图时坐标轴的区间范围要注意；</p>
<p>7 总结ENCUT取值的一些注意事项。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.bigbrosci.com/2017/12/08/ex16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="By BigBro(a)s">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learn VASP The Hard Way">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/08/ex16/" class="post-title-link" itemprop="url">Ex16 谁偷走的我的机时？（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-08 15:30:16" itemprop="dateCreated datePublished" datetime="2017-12-08T15:30:16-05:00">2017-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-27 22:15:54" itemprop="dateModified" datetime="2021-12-27T22:15:54-05:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LVASPTHW/" itemprop="url" rel="index"><span itemprop="name">LVASPTHW</span></a>
        </span>
    </span>

  
    <span id="/2017/12/08/ex16/" class="post-meta-item leancloud_visitors" data-flag-title="Ex16 谁偷走的我的机时？（一）" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/12/08/ex16/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/08/ex16/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前面O$_2$初始结构为0.9 $\AA$时，如果使用<code>BRION=2</code>，相对于初始结构为1.07$\AA$的时候，为避免过度矫正，我们需要设置一个更小的POTIM，大师兄尝试过了，<code>POTIM = 0.01</code> 的时候得到了正确的计算结果。到此，O$_2$分子的计算我们暂且告一段落。做计算，机时很重要，尤其是缺钱，捉襟见肘的时候，我们就更加需要珍惜，保证并提高自己的计算成功率，避免重复计算。这一节我们总结下前面讲到的影响计算时间的一些细节。大家在计算的时候知道如何把握时间，在有限的机时内获取更多的有效的计算结果。</p>
<hr>
<h3 id="1-体系的磁性-EX8"><a href="#1-体系的磁性-EX8" class="headerlink" title="1 体系的磁性 (EX8)"></a>1 体系的磁性 (EX8)</h3><p>考虑自旋后（<code>ISPIN=2</code>），VASP计算时会将电子分为两部分处理，一部分是$\alpha$电子，另一部分是$\beta$电子，我们在氧原子的自旋极化计算中提到过了，忘了的可以查看Ex8，Ex11中的内容。</p>
<p>补充一下：如果原子的<code>MAGMOM</code>为负值：应该这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAGMOM = 10*-2 # 有10个原子，每个原子的初始磁矩为 -2</span><br></pre></td></tr></table></figure>
<p>注意： -2 不用括号（）括起来</p>
<hr>
<h3 id="2-对称性-EX8"><a href="#2-对称性-EX8" class="headerlink" title="2 对称性 (EX8)"></a>2 对称性 (EX8)</h3><p>体系的对称性降低，会增加相应的计算量。查看O原子计算时，改变晶胞大小，取消对称性前后的计算时间。</p>
<hr>
<h3 id="3-SIGMA的取值-EX1"><a href="#3-SIGMA的取值-EX1" class="headerlink" title="3  SIGMA的取值 (EX1)"></a>3  SIGMA的取值 (EX1)</h3><p>我们看一下VASP练习手册：handonsession-I 里面的一句话说明：</p>
<p><img src="/2017/12/08/ex16/ex16-1.jpg" alt=""></p>
<p>因此，设置一个较小的SIGMA值会使收敛变慢。大家对于ISMEAR的选择，一定要多看官网的说明！</p>
<hr>
<h4 id="3-1-半导体和绝缘体："><a href="#3-1-半导体和绝缘体：" class="headerlink" title="3.1 半导体和绝缘体："></a>3.1 半导体和绝缘体：</h4><p>1） K点小于4 的时候，用<code>ISMEAR=0</code>, <code>SIGMA</code>取值小一些；比如SIGMA=0.05; 此时用ISMEAR = -5 会出错；</p>
<p>2）K点数目大于4的时候，可以使用<code>ISMEAR= -5</code>；</p>
<p>3） 注意： 我们算的气体分子，是绝缘体，且只用了gamma点，所以我们参数的设置如下： </p>
<hr>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ISMEAR=<span class="number">0</span> </span><br><span class="line">SIGMA=<span class="number">0.01</span> </span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-2-金属体系："><a href="#3-2-金属体系：" class="headerlink" title="3.2 金属体系："></a>3.2 金属体系：</h4><p>ISMEAR一般用<code>ISMEAR=0</code> 或者整数1，2即可。</p>
<p><code>SIGMA =0.1</code> 足够。</p>
<hr>
<h3 id="4-合理的初始结构-（Ex13-15）"><a href="#4-合理的初始结构-（Ex13-15）" class="headerlink" title="4 合理的初始结构 （Ex13-15）"></a>4 合理的初始结构 （Ex13-15）</h3><p>前面我们刚讲到，一个合理的初始结构，可以避免很多意外的错误以及快速得到正确的结果。</p>
<p>如果你的初始结构不合理导致的计算出错，首先应该去调整结构，最后才是去调节参数，比如上一节中<code>IBRION=2</code>时的POTIM值。</p>
<hr>
<h3 id="5-EDIFF-（Ex9）"><a href="#5-EDIFF-（Ex9）" class="headerlink" title="5 EDIFF （Ex9）"></a>5 EDIFF （Ex9）</h3><p>EDIFF 控制了电子迭代的收敛标准，如果你设置的标准比较严格，则每一个离子步需要更多的电子步数，需要的时间也会随着离子步的增加成线性关系增长。</p>
<hr>
<h3 id="6-EDIFFG-（Ex9）"><a href="#6-EDIFFG-（Ex9）" class="headerlink" title="6 EDIFFG （Ex9）"></a>6 EDIFFG （Ex9）</h3><p>EDIFFG控制了结构收敛的标准，同样严格的标准需要更多的结构优化步骤来实现。</p>
<hr>
<h3 id="扩展练习："><a href="#扩展练习：" class="headerlink" title="扩展练习："></a>扩展练习：</h3><p>1 本文所提到的内容，必须去官网查看，并认真阅读，如有不懂的，请在群里自由提问；</p>
<p>2 思考一下，还有其他因素影响我们的机时吗？</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">By BigBro(a)s</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"OWE4jcfK8IWkx4zaWuOloxKU-gzGzoHsz","app_key":"MRBwViAFCsPSOnnRF9LW7bdo","server_url":null,"security":true}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"bigbrosci-com","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({{ JSON.stringify(config) }});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="{{ src }}">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
